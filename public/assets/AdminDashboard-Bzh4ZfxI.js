import{r as i,b as o,j as e,D as b,e as Se}from"./index-C5_jvaoZ.js";import{o as M}from"./offline-CafmH5fM.js";function Qe(){const[l,P]=i.useState([]),[$,B]=i.useState([]),[u,O]=i.useState([]),[S,d]=i.useState([]),[W,H]=i.useState([]),[g,te]=i.useState([]),[j,se]=i.useState({from:"",to:""}),[p,ae]=i.useState({year:"",branch:""}),[a,ie]=i.useState(null),[Y,v]=i.useState(""),[De,N]=i.useState("success"),[G,Me]=i.useState(""),[f,ne]=i.useState({year:"",branch:""}),[z,re]=i.useState(!1),[C,le]=i.useState([]),[h,oe]=i.useState({from:"",to:""}),[_,ce]=i.useState(""),[K,de]=i.useState(!1),[w,U]=i.useState([]),[Pe,q]=i.useState(!1),[$e,me]=i.useState(!1),[y,xe]=i.useState(null),[he,ue]=i.useState(""),[R,pe]=i.useState(!1),[E,ge]=i.useState(!1),[V,ve]=i.useState(!1),[I,Q]=i.useState(!1),m=async()=>{re(!0);try{const[t,s,r,n,x,k,T]=await Promise.all([o.get("/admin/students/pending"),o.get("/admin/security/pending"),o.get("/admin/admins/pending"),o.get("/admin/students"),o.get("/admin/logs",{params:j.from||j.to?{...j}:{}}),o.get("/admin/users",{params:{role:"security",approvedOnly:!0}}),o.get("/admin/overstays")]);P(t.data),B(s.data),O(r.data),d(n.data),te(x.data),H(k.data),le(T.data||[]),M.saveStudents(n.data).catch(()=>{}),M.saveLogs(x.data).catch(()=>{});try{const D=(await o.get("/admin/visitors")).data;M.saveVisitors(D).catch(()=>{})}catch{}}catch{const[s,r]=await Promise.all([M.loadStudents().catch(()=>[]),M.loadLogs().catch(()=>[])]);s.length&&d(s),r.length&&te(r),v("Offline mode: showing cached data"),N("error")}re(!1)};i.useEffect(()=>{(async()=>{try{const{data:t}=await o.get("/auth/me");ie(t),t!=null&&t.isApproved&&await m()}catch{}})()},[]),i.useEffect(()=>{if(!(a!=null&&a.isApproved))return;const t=setInterval(()=>{J().catch(()=>{})},6e4);return()=>clearInterval(t)},[a==null?void 0:a.isApproved,h.from,h.to]),i.useEffect(()=>{if(!Y)return;const t=setTimeout(()=>v(""),2e3);return()=>clearTimeout(t)},[Y]);const Oe=async t=>{await o.post(`/admin/students/${t}/approve`),await m()},Fe=async t=>{await o.post(`/admin/students/${t}/decline`),await m()},Be=async t=>{await o.post(`/admin/security/${t}/approve`),await m()},ze=async t=>{await o.post(`/admin/security/${t}/decline`),await m()},Re=async t=>{await o.post(`/admin/admins/${t}/approve`),await m()},Ee=async t=>{await o.post(`/admin/admins/${t}/decline`),await m()},Ve=async()=>{var r;if(!confirm("Approve all pending students (filtered)? Pins and QR will be generated automatically."))return;const t={batchYear:f.year?Number(f.year):void 0,branch:f.branch||void 0},s=await o.post("/admin/students/approve-all",t);v(`${((r=s.data)==null?void 0:r.approved)||0} students approved`),N("success"),await m()},Ie=async()=>{var r;if(!confirm("Reject all pending students (filtered)?"))return;const t={batchYear:f.year?Number(f.year):void 0,branch:f.branch||void 0},s=await o.post("/admin/students/decline-all",t);v(`${((r=s.data)==null?void 0:r.declined)||0} students rejected`),N("success"),await m()},F=async(t,s)=>{try{const r={type:s};s==="overstays"?(r.from=h.from||void 0,r.to=h.to||void 0):(r.from=j.from||void 0,r.to=j.to||void 0),await Se(`/api/export/${t}`,r,`${s}-logs.${t}`)}catch(r){v(r.message||"Export failed"),N("error")}},fe=async t=>{try{const s={type:"student-details",batchYear:p.year||void 0,branch:p.branch||void 0},r=`student-details${p.year?"-"+p.year:""}${p.branch?"-"+p.branch:""}.${t}`;await Se(`/api/export/${t}`,s,r)}catch(s){v(s.message||"Export failed"),N("error")}},Te=async()=>{if(!confirm("This will permanently delete logs and visitors older than the cutoff. Continue?"))return;const t=G?{before:G}:{months:3},{data:s}=await o.post("/admin/purge-old",t);v(`Deleted ${s.deletedLogs} logs and ${s.deletedVisitors} visitors (<= ${new Date(s.cutoff).toLocaleDateString()})`),N("success"),await m()},He=async t=>{confirm("Delete this student permanently?")&&(await o.delete(`/admin/students/${t}`),await m())},Ye=async t=>{confirm("Delete this security user permanently?")&&(await o.delete(`/admin/security/${t}`),await m())},J=async()=>{const t={refresh:!0};h.from&&(t.from=h.from),h.to&&(t.to=h.to);const{data:s}=await o.get("/admin/overstays",{params:t});le(s),v("Overstay list updated"),N("success")},_e=async t=>{await o.post(`/admin/overstays/${t}/resolve`),await J()},Ue=async()=>{const{year:t,branch:s}=p;if(!t)return alert("Select a batch year");confirm(`Delete all students from batch ${t}${s?" ("+s+")":""}?`)&&(await o.post("/admin/students/batch-delete",{batchYear:Number(t),branch:s||void 0}),await m())},ye=async()=>{var s,r;const t=(_||"").trim();if(U([]),q(!1),!!t)try{de(!0);const{data:n}=await o.get("/admin/students/search",{params:{q:t}});U(Array.isArray(n)?n:[])}catch(n){U([]),v(((r=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:r.message)||"Search failed"),N("error")}finally{de(!1)}},be=async t=>{var s,r;if(t){ue(""),xe(null),q(!0);try{me(!0);const{data:n}=await o.get(`/admin/students/${encodeURIComponent(t)}/details`);xe(n)}catch(n){ue(((r=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to load details")}finally{me(!1)}}},qe=()=>{ce(""),U([]),Q(!1)},A=i.useMemo(()=>{const t=Array.isArray(S)?[...S]:[],s=(_||"").trim().toLowerCase();if(!s)return t.sort((n,x)=>{const k=String(n.registrationNo||""),T=String(x.registrationNo||""),D=k.localeCompare(T,void 0,{numeric:!0,sensitivity:"base"});return D!==0?D:String(n.name||"").localeCompare(String(x.name||""),void 0,{sensitivity:"base"})});const r=n=>{const x=String(n.name||"").toLowerCase(),k=String(n.registrationNo||"").toLowerCase();return k===s?0:x===s?.1:k.startsWith(s)?.2:x.startsWith(s)?.3:k.includes(s)?.4:x.includes(s)?.5:1};return t.map(n=>({it:n,s:r(n)})).sort((n,x)=>{if(n.s!==x.s)return n.s-x.s;const k=String(n.it.registrationNo||""),T=String(x.it.registrationNo||""),D=k.localeCompare(T,void 0,{numeric:!0,sensitivity:"base"});return D!==0?D:String(n.it.name||"").localeCompare(String(x.it.name||""),void 0,{sensitivity:"base"})}).map(({it:n})=>n)},[S,_]),je=i.useMemo(()=>R?C:C.slice(0,50),[C,R]),Ne=i.useMemo(()=>E?A:A.slice(0,50),[A,E]),we=i.useMemo(()=>V?g:g.slice(0,50),[g,V]),ke=i.useMemo(()=>I?w:w.slice(0,50),[w,I]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Admin Dashboard"}),a&&!a.isApproved&&!a.requestedApproval&&e.jsxs("div",{className:"rounded border border-red-200 bg-red-50 text-red-800 p-4 flex items-start gap-3",children:[e.jsx("div",{className:"font-semibold",children:"Application was rejected"}),e.jsx("div",{className:"ml-auto",children:e.jsx("button",{className:"btn",onClick:async()=>{await o.post("/auth/admin/request-approval"),ie({...a,requestedApproval:!0}),v("Request sent"),N("success")},children:"Send request again"})})]}),a&&!a.isApproved&&a.requestedApproval&&e.jsx("div",{className:"rounded border border-blue-200 bg-blue-50 text-blue-800 p-3",children:"Application submitted — please wait for admin approval."}),Y&&e.jsx("div",{role:"alert",className:`fixed top-4 right-4 z-50 shadow-lg rounded px-4 py-3 transition-opacity duration-300 ${De==="error"?"bg-red-600 text-white":"bg-green-600 text-white"}`,children:Y}),(a==null?void 0:a.isApproved)&&l.length>0&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-3 mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Pending Student Approvals"}),e.jsxs("div",{className:"flex flex-wrap items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Batch Year"}),e.jsxs("select",{className:"input",value:f.year,onChange:t=>ne({...f,year:t.target.value}),children:[e.jsx("option",{value:"",children:"All"}),Array.from({length:31},(t,s)=>2020+s).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Branch"}),e.jsxs("select",{className:"input",value:f.branch,onChange:t=>ne({...f,branch:t.target.value}),children:[e.jsx("option",{value:"",children:"All"}),["CSE","Civil","Mechanical","EEE","FPP"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx(c,{color:"teal",onClick:Ve,title:"Approve all",icon:e.jsx(Ae,{className:"h-4 w-4"}),children:"Approve All"}),e.jsx(c,{color:"rose",onClick:Ie,title:"Reject all",icon:e.jsx(Le,{className:"h-4 w-4"}),children:"Reject All"})]})]}),e.jsx(b,{maxHeight:"60vh",containerClassName:"scroll-thin",columns:[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"action",title:"Action",render:(t,s)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{onClick:()=>Oe(s.id)}),e.jsx(ee,{onClick:()=>Fe(s.id)})]})}],data:l})]}),(a==null?void 0:a.isApproved)&&$.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Pending Security Approvals"}),e.jsx(b,{maxHeight:"40vh",containerClassName:"scroll-thin",columns:[{key:"name",title:"Name"},{key:"registrationNo",title:"Identifier"},{key:"action",title:"Action",render:(t,s)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{onClick:()=>Be(s.id)}),e.jsx(ee,{onClick:()=>ze(s.id)})]})}],data:$})]}),(a==null?void 0:a.isApproved)&&u.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Pending Admin Approvals"}),e.jsx(b,{maxHeight:"40vh",containerClassName:"scroll-thin",columns:[{key:"name",title:"Name"},{key:"registrationNo",title:"Identifier"},{key:"action",title:"Action",render:(t,s)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{onClick:()=>Re(s.id)}),e.jsx(ee,{onClick:()=>Ee(s.id)})]})}],data:u})]}),(a==null?void 0:a.isApproved)&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-3 mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Overstay Alerts"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"From"}),e.jsx("input",{type:"datetime-local",className:"input",value:h.from,onChange:t=>oe({...h,from:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"To"}),e.jsx("input",{type:"datetime-local",className:"input",value:h.to,onChange:t=>oe({...h,to:t.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{color:"teal",size:"sm",onClick:J,title:"Refresh overstay list",children:"Filter"}),e.jsx(c,{color:"indigo",size:"sm",onClick:()=>F("pdf","overstays"),icon:e.jsx(L,{className:"h-4 w-4"}),children:"PDF"}),e.jsx(c,{color:"indigo",size:"sm",variant:"outline",onClick:()=>F("docx","overstays"),icon:e.jsx(L,{className:"h-4 w-4"}),children:"DOCX"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mt-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:je.length}),C.length>50&&!R&&e.jsxs(e.Fragment,{children:[" ","of ",e.jsx("span",{className:"font-medium",children:C.length}),e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest"})]}),R&&C.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),C.length>50&&e.jsx("div",{className:"flex gap-2",children:R?e.jsx("button",{type:"button",onClick:()=>pe(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"}):e.jsxs("button",{type:"button",onClick:()=>pe(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",C.length-50]})]})})]}),e.jsx(b,{maxHeight:"50vh",containerClassName:"scroll-thin",columns:[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"purpose",title:"Purpose"},{key:"checkOutTime",title:"Checked-out",render:t=>t?new Date(t).toLocaleString():"-"},{key:"flaggedAt",title:"Flagged",render:t=>t?new Date(t).toLocaleString():"-"},{key:"durationHours",title:"Hours",render:(t,s)=>e.jsx("span",{title:typeof s.hoursOutsideAtFlag=="number"?`At flag: ${s.hoursOutsideAtFlag}h`:"",children:typeof t=="number"?t:typeof s.hoursOutsideAtFlag=="number"?s.hoursOutsideAtFlag:"-"})},{key:"resolved",title:"Status",render:(t,s)=>t?`Resolved${s.checkInTime?" at "+new Date(s.checkInTime).toLocaleString():""}`:"Open"},{key:"action",title:"Action",render:(t,s)=>s.resolved?e.jsx("span",{className:"text-green-500",children:"—"}):e.jsx(c,{color:"amber",size:"xs",onClick:()=>_e(s._id),children:"Mark Resolved"})}],data:je})]}),(a==null?void 0:a.isApproved)&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-2",children:[e.jsx("div",{className:"font-semibold",children:"Students"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Batch Year"}),e.jsxs("select",{className:"input",value:p.year,onChange:t=>ae({...p,year:t.target.value}),children:[e.jsx("option",{value:"",children:"Select year"}),Array.from({length:31},(t,s)=>2020+s).map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Branch (optional)"}),e.jsxs("select",{className:"input",value:p.branch,onChange:t=>ae({...p,branch:t.target.value}),children:[e.jsx("option",{value:"",children:"All"}),["CSE","Civil","Mechanical","EEE","FPP"].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx(c,{color:"amber",onClick:Ue,title:"Batch delete",icon:e.jsx(X,{className:"h-4 w-4"}),children:"Batch Delete"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{color:"indigo",size:"sm",onClick:()=>fe("pdf"),icon:e.jsx(L,{className:"h-4 w-4"}),children:"Students PDF"}),e.jsx(c,{color:"indigo",variant:"outline",size:"sm",onClick:()=>fe("docx"),icon:e.jsx(L,{className:"h-4 w-4"}),children:"Students DOCX"})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end gap-2 mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm",children:"Search student"}),e.jsx("input",{type:"text",className:"input w-full",placeholder:"Enter registration no or name",value:_,onChange:t=>ce(t.target.value),onKeyDown:t=>{t.key==="Enter"&&ye()}})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{color:"teal",onClick:ye,disabled:K,children:K?"Searching…":"Search"}),e.jsx(c,{color:"rose",variant:"outline",onClick:qe,disabled:K,children:"Clear"})]})]}),w.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mb-1",children:"Search results"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-1",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:ke.length}),w.length>50&&!I&&e.jsxs(e.Fragment,{children:[" ","of ",e.jsx("span",{className:"font-medium",children:w.length}),e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest"})]}),I&&w.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),w.length>50&&e.jsx("div",{className:"flex gap-2",children:I?e.jsx("button",{type:"button",onClick:()=>Q(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"}):e.jsxs("button",{type:"button",onClick:()=>Q(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",w.length-50]})]})})]}),e.jsx(b,{maxHeight:"40vh",containerClassName:"scroll-thin",columns:[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"action",title:"Action",render:(t,s)=>e.jsx(c,{color:"indigo",size:"xs",onClick:()=>be(s.registrationNo),children:"View"})}],data:ke})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:Ne.length}),A.length>50&&!E&&e.jsxs(e.Fragment,{children:[" ","of ",e.jsx("span",{className:"font-medium",children:A.length}),e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest"})]}),E&&A.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),A.length>50&&e.jsx("div",{className:"flex gap-2",children:E?e.jsx("button",{type:"button",onClick:()=>ge(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"}):e.jsxs("button",{type:"button",onClick:()=>ge(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",A.length-50]})]})})]}),e.jsx(b,{maxHeight:"60vh",containerClassName:"scroll-thin",columns:[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"action",title:"Action",render:(t,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{color:"indigo",size:"xs",onClick:()=>be(s.registrationNo),children:"Details"}),e.jsx(c,{color:"rose",size:"xs",onClick:()=>He(s.id),title:"Delete student",icon:e.jsx(X,{className:"h-4 w-4"}),children:"Delete"})]})}],data:Ne})]}),(a==null?void 0:a.isApproved)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("div",{className:"font-semibold",children:"Security Users"})}),e.jsx(b,{maxHeight:"50vh",containerClassName:"scroll-thin",columns:[{key:"registrationNo",title:"Identifier"},{key:"name",title:"Name"},{key:"action",title:"Action",render:(t,s)=>e.jsx(c,{color:"rose",size:"xs",onClick:()=>Ye(s.id),title:"Delete security user",icon:e.jsx(X,{className:"h-4 w-4"}),children:"Delete"})}],data:W})]}),(a==null?void 0:a.isApproved)&&e.jsxs("div",{className:"card space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"From"}),e.jsx("input",{type:"datetime-local",className:"input",value:j.from,onChange:t=>se({...j,from:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"To"}),e.jsx("input",{type:"datetime-local",className:"input",value:j.to,onChange:t=>se({...j,to:t.target.value})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{color:"teal",disabled:z,onClick:m,icon:e.jsx(We,{className:"h-4 w-4"}),children:z?"Loading…":"Filter"}),e.jsx(c,{color:"indigo",disabled:z,onClick:()=>F("pdf","students"),icon:e.jsx(L,{className:"h-4 w-4"}),children:"PDF"}),e.jsx(c,{color:"indigo",variant:"outline",disabled:z,onClick:()=>F("docx","students"),icon:e.jsx(L,{className:"h-4 w-4"}),children:"DOCX"})]})]}),z?e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsxs("svg",{className:"h-5 w-5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 3v3",strokeLinecap:"round"}),e.jsx("path",{d:"M12 18v3",strokeLinecap:"round"}),e.jsx("path",{d:"M3 12h3",strokeLinecap:"round"}),e.jsx("path",{d:"M18 12h3",strokeLinecap:"round"})]}),"Loading data…"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:we.length}),g.length>50&&!V&&e.jsxs(e.Fragment,{children:[" ","of ",e.jsx("span",{className:"font-medium",children:g.length}),e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest"})]}),V&&g.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),g.length>50&&e.jsx("div",{className:"flex gap-2",children:V?e.jsx("button",{type:"button",onClick:()=>ve(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"}):e.jsxs("button",{type:"button",onClick:()=>ve(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",g.length-50]})]})})]}),e.jsx(b,{maxHeight:"60vh",containerClassName:"scroll-thin",columns:[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"action",title:"Action"},{key:"purpose",title:"Purpose"},{key:"checkInTime",title:"Check-in",render:t=>t?new Date(t).toLocaleString():"-"},{key:"checkOutTime",title:"Check-out",render:t=>t?new Date(t).toLocaleString():"-"}],data:we})]})]}),(a==null?void 0:a.isApproved)&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Visitor Logs"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx(c,{color:"indigo",size:"sm",onClick:()=>F("pdf","visitors"),icon:e.jsx(L,{className:"h-4 w-4"}),children:"PDF"}),e.jsx(c,{color:"indigo",size:"sm",variant:"outline",onClick:()=>F("docx","visitors"),icon:e.jsx(L,{className:"h-4 w-4"}),children:"DOCX"})]}),e.jsx(Xe,{})]}),(a==null?void 0:a.isApproved)&&e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Purge Old Data"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Delete student check-in/out logs and visitor logs older than 3 months (or a custom date)."})]}),e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"Custom cutoff (optional)"}),e.jsx("input",{type:"date",className:"input",value:G,onChange:t=>Me(t.target.value)})]}),e.jsx(c,{color:"rose",onClick:Te,title:"Permanently delete old data",icon:e.jsx(X,{className:"h-4 w-4"}),children:"Purge Old Data"})]})]})})]}),Pe&&e.jsxs("div",{className:"fixed inset-0 z-[999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>q(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-[96vw] max-w-5xl max-h-[88vh] overflow-auto bg-white dark:bg-gray-900 rounded-xl shadow-2xl border border-black/10 dark:border-white/10 p-3 sm:p-4",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 dark:border-gray-800 pb-2 sm:pb-3",children:[e.jsx("div",{className:"font-semibold",children:"Student Details"}),e.jsx("button",{type:"button",className:"text-sm px-2 py-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800",onClick:()=>q(!1),children:"Close"})]}),e.jsxs("div",{className:"pt-3 space-y-3",children:[$e&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Loading…"}),he&&e.jsx("div",{className:"text-sm text-red-600",children:he}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Profile"}),e.jsxs("div",{children:["Reg No: ",y.student.registrationNo]}),e.jsxs("div",{children:["Name: ",y.student.name||"-"]}),e.jsxs("div",{children:["Branch: ",y.student.branch||"-"]}),e.jsxs("div",{children:["Batch: ",y.student.batchYear||"-"]}),e.jsxs("div",{className:"mt-1 text-sm",children:["Student UID: ",e.jsx("span",{className:"font-mono",children:y.student.studentUid||"-"})]}),e.jsxs("div",{className:"mt-1 text-sm",children:["PIN: ",e.jsx("span",{className:"font-mono",children:y.student.pinCode||"-"})]})]}),y.student.profilePhotoUrl&&e.jsx("div",{className:"card flex items-center justify-center",children:e.jsx("img",{src:y.student.profilePhotoUrl,alt:"Profile photo",className:"w-28 h-28 sm:w-36 sm:h-36 md:w-48 md:h-48 object-cover rounded-md"})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Check-in/Out Logs"}),e.jsx(b,{maxHeight:"50vh",columns:[{key:"action",title:"Action"},{key:"purpose",title:"Purpose"},{key:"checkInTime",title:"Check-in",render:t=>t?new Date(t).toLocaleString():"-"},{key:"checkOutTime",title:"Check-out",render:t=>t?new Date(t).toLocaleString():"-"}],data:y.logs||[]})]})]})]})]})})]})]})}function Xe(){const[l,P]=i.useState([]),[$,B]=i.useState(!0),[u,O]=i.useState(!1);i.useEffect(()=>{(async()=>{try{const d=await o.get("/admin/visitors");P(d.data),M.saveVisitors(d.data).catch(()=>{})}catch{const d=await M.loadVisitors().catch(()=>[]);P(d)}finally{B(!1)}})()},[]);const S=i.useMemo(()=>u?l:l.slice(0,50),[l,u]);return $?e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsxs("svg",{className:"h-5 w-5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M12 3v3",strokeLinecap:"round"}),e.jsx("path",{d:"M12 18v3",strokeLinecap:"round"}),e.jsx("path",{d:"M3 12h3",strokeLinecap:"round"}),e.jsx("path",{d:"M18 12h3",strokeLinecap:"round"})]}),"Loading visitors…"]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:S.length}),l.length>50&&!u&&e.jsxs(e.Fragment,{children:[" ","of ",e.jsx("span",{className:"font-medium",children:l.length}),e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest"})]}),u&&l.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),l.length>50&&e.jsx("div",{className:"flex gap-2",children:u?e.jsx("button",{type:"button",onClick:()=>O(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"}):e.jsxs("button",{type:"button",onClick:()=>O(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",l.length-50]})]})})]}),e.jsx(b,{maxHeight:"50vh",columns:[{key:"name",title:"Name"},{key:"vehicleNo",title:"Vehicle"},{key:"purpose",title:"Purpose"},{key:"entryTime",title:"Entry",render:d=>new Date(d).toLocaleString()},{key:"exitTime",title:"Exit",render:d=>d?new Date(d).toLocaleString():"-"}],data:S})]})}function Z({onClick:l}){return e.jsx(c,{color:"teal",size:"xs",onClick:l,icon:e.jsx(Ae,{className:"h-4 w-4"}),children:"Approve"})}function ee({onClick:l}){return e.jsx(c,{color:"rose",size:"xs",onClick:l,icon:e.jsx(Le,{className:"h-4 w-4"}),children:"Reject"})}const Ce={teal:{solid:"from-cyan-500 via-teal-500 to-emerald-500 text-white shadow-cyan-500/30",outline:"text-cyan-300 border border-cyan-400/30 hover:bg-cyan-500/10"},rose:{solid:"from-rose-500 via-fuchsia-500 to-pink-500 text-white shadow-rose-500/30",outline:"text-rose-300 border border-rose-400/30 hover:bg-rose-500/10"},amber:{solid:"from-amber-500 via-orange-500 to-yellow-500 text-white shadow-amber-500/30",outline:"text-amber-300 border border-amber-400/30 hover:bg-amber-500/10"},indigo:{solid:"from-indigo-500 via-violet-500 to-fuchsia-500 text-white shadow-indigo-500/30",outline:"text-violet-300 border border-violet-400/30 hover:bg-violet-500/10"}};function c({children:l,color:P="teal",variant:$="solid",size:B="md",icon:u,className:O="",...S}){const d={xs:"text-xs px-2.5 py-1.5",sm:"text-sm px-3 py-1.5",md:"text-sm px-4 py-2",lg:"text-base px-5 py-2.5"},W="relative inline-flex items-center gap-1.5 rounded-lg font-medium tracking-wide focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-gray-900 transition disabled:opacity-50 disabled:cursor-not-allowed",H=Ce[P]||Ce.teal,g=$==="solid"?`bg-gradient-to-r ${H.solid} hover:brightness-110 shadow-sm`:`bg-slate-800/40 hover:bg-slate-700/50 backdrop-blur border ${H.outline}`;return e.jsxs("button",{type:"button",className:`${W} ${d[B]} ${g} ${O}`,...S,children:[u&&e.jsx("span",{className:"relative z-10",children:u}),e.jsx("span",{className:"relative z-10",children:l})]})}function Ae({className:l=""}){return e.jsx("svg",{className:l,viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M16.704 5.29a1 1 0 010 1.42l-7.5 7.5a1 1 0 01-1.414 0l-3-3a1 1 0 111.414-1.42l2.293 2.293 6.793-6.793a1 1 0 011.414 0z",clipRule:"evenodd"})})}function Le({className:l=""}){return e.jsx("svg",{className:l,viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}function X({className:l=""}){return e.jsxs("svg",{className:l,viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:[e.jsx("path",{d:"M6 7a1 1 0 011 1v7a1 1 0 11-2 0V8a1 1 0 011-1zm4 0a1 1 0 011 1v7a1 1 0 11-2 0V8a1 1 0 011-1zm4 0a1 1 0 011 1v7a1 1 0 11-2 0V8a1 1 0 011-1z"}),e.jsx("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2h8a2 2 0 012 2v1H4V5zm2-1a1 1 0 00-1 1v1h10V5a1 1 0 00-1-1H6z",clipRule:"evenodd"})]})}function L({className:l=""}){return e.jsxs("svg",{className:l,viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:[e.jsx("path",{d:"M9 2a1 1 0 012 0v8.586l2.293-2.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4A1 1 0 016.707 8.293L9 10.586V2z"}),e.jsx("path",{d:"M3 14a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1v-2z"})]})}function We({className:l=""}){return e.jsx("svg",{className:l,viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{d:"M3 5a2 2 0 012-2h10a2 2 0 012 2v1a2 2 0 01-.586 1.414L12 11.828V16a1 1 0 01-1.447.894l-2-1A1 1 0 018 15v-3.172L3.586 7.414A2 2 0 013 6V5z"})})}export{Qe as default};
