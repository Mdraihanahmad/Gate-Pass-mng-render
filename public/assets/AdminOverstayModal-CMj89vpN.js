import{ap as e}from"./vendor-CFsy__N8.js";import{D as j}from"./index-CWqtKnlK.js";import{R as p,B as v,C as f,X as N,Y as y,T as k,L as w,a as C}from"./vendor-recharts-ClFrvCmH.js";import"./vendor-router-CySAd55F.js";import"./vendor-axios-NIGUFBhG.js";import"./vendor-icons-B9ONrHs4.js";function F({charts:a,overstays:x,overstaysFilter:i,setOverstaysFilter:d,overstayOpen:u,setOverstayOpen:n,exportOverstays:o,loadOverstaysAndCharts:h,overstaysLoading:c,resolveOverstay:g}){var m;return u?e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md animate-fade-in",onClick:()=>n(!1)}),e.jsxs("div",{className:"relative glass rounded shadow-xl w-[96vw] max-w-6xl max-h-[88vh] p-4 overflow-auto animate-scale-in text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Overstay Alerts"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn",onClick:()=>o("pdf"),children:"PDF"}),e.jsx("button",{className:"btn",onClick:()=>o("docx"),children:"DOCX"}),e.jsx("button",{className:"btn",onClick:()=>n(!1),children:"Close"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-3",children:[e.jsx("div",{className:"space-y-2 md:col-span-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-end gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"From"}),e.jsx("input",{type:"datetime-local",className:"input",value:i.from,onChange:s=>d({...i,from:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"To"}),e.jsx("input",{type:"datetime-local",className:"input",value:i.to,onChange:s=>d({...i,to:s.target.value})})]}),e.jsx("button",{className:"btn",onClick:h,disabled:c,children:c?"Loading…":"Filter"})]})}),e.jsxs("div",{className:"bg-white/60 dark:bg-gray-800/60 rounded border border-gray-200 dark:border-white/10 p-2",children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Currently Outside"}),e.jsx("div",{className:"text-2xl font-semibold",children:a.currentOutside.count}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Avg hours: ",(m=a.currentOutside.avgHours)!=null&&m.toFixed?a.currentOutside.avgHours.toFixed(1):a.currentOutside.avgHours," • Max: ",a.currentOutside.maxHours]}),e.jsx("div",{className:"mt-2 max-h-28 overflow-y-auto text-xs scroll-thin pr-1",children:a.currentOutside.top.length===0?e.jsx("div",{className:"text-gray-500",children:"No one currently outside (in range)"}):e.jsx("ul",{className:"space-y-1",children:a.currentOutside.top.map(s=>e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:s.name||s.registrationNo}),e.jsxs("span",{children:[s.hours,"h"]})]},s.registrationNo))})})]}),e.jsxs("div",{className:"bg-white/60 dark:bg-gray-800/60 rounded border border-gray-200 dark:border-white/10 p-2",children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Overstays — Open vs Resolved"}),e.jsx("div",{className:"flex items-end gap-2 h-28",children:["Open","Resolved"].map((s,t)=>{const r=s==="Open"?a.openResolved.open:a.openResolved.resolved,l=Math.max(1,a.openResolved.open,a.openResolved.resolved),b=Math.round(r/l*100);return e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-end",children:[e.jsx("div",{className:`w-8 rounded-t ${t===0?"bg-amber-500":"bg-emerald-500"}`,style:{height:`${b}%`}}),e.jsx("div",{className:"text-xs mt-1",children:s}),e.jsx("div",{className:"text-xs font-medium",children:r})]},s)})})]}),e.jsxs("div",{className:"bg-white/60 dark:bg-gray-800/60 rounded border border-gray-200 dark:border-white/10 p-2",children:[e.jsx("div",{className:"text-sm font-medium mb-1",children:"Busiest Exit Hours"}),e.jsx("div",{className:"h-40",children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(v,{data:a.byHour,margin:{top:5,right:10,left:0,bottom:0},children:[e.jsx(f,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"hour",tick:{fontSize:12}}),e.jsx(y,{allowDecimals:!1,width:30}),e.jsx(k,{formatter:s=>[`${s}`,"Exits"],labelFormatter:s=>`Hour ${s}:00`}),e.jsx(w,{}),e.jsx(C,{dataKey:"count",fill:"#06b6d4",name:"Exits"})]})})}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:(()=>{const s=a.byHour||[];if(!s.length)return"No data";const t=s.reduce((r,l)=>l.count>((r==null?void 0:r.count)||0)?l:r,null);return t?`Peak: ${String(t.hour).padStart(2,"0")}:00 — ${t.count} exits`:"No data"})()})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(j,{maxHeight:"38vh",containerClassName:"scroll-thin",columns:[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"purpose",title:"Purpose"},{key:"checkOutTime",title:"Checked-out",render:s=>s?new Date(s).toLocaleString():"-"},{key:"flaggedAt",title:"Flagged",render:s=>s?new Date(s).toLocaleString():"-"},{key:"durationHours",title:"Hours",render:(s,t)=>e.jsx("span",{title:typeof t.hoursOutsideAtFlag=="number"?`At flag: ${t.hoursOutsideAtFlag}h`:"",children:typeof s=="number"?s:typeof t.hoursOutsideAtFlag=="number"?t.hoursOutsideAtFlag:"-"})},{key:"resolved",title:"Status",render:(s,t)=>s?`Resolved${t.checkInTime?" at "+new Date(t.checkInTime).toLocaleString():""}`:"Open"},{key:"action",title:"Action",render:(s,t)=>t.resolved?e.jsx("span",{className:"text-green-500",children:"—"}):e.jsx("button",{className:"btn",onClick:()=>g(t._id),children:"Mark Resolved"})}],data:x})})]})]}):null}export{F as default};
