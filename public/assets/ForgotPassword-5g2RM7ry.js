import{r as n,j as e,L as S,b as g}from"./index-8S67HhOF.js";function R(){const[i,f]=n.useState("student"),[h,p]=n.useState(1),[a,x]=n.useState({registrationNo:"",pinCode:""}),[r,N]=n.useState({registrationNo:"",name:""}),[j,m]=n.useState(""),[o,w]=n.useState({p1:"",p2:""}),[b,u]=n.useState(""),[y,d]=n.useState(""),v=async t=>{var l,c;t.preventDefault(),d(""),u("");try{if(i==="student"){if(!/^[0-9]{6}$/.test(a.pinCode))throw new Error("PIN must be 6 digits");const{data:s}=await g.post("/auth/forgot-password",{role:i,registrationNo:a.registrationNo,pinCode:a.pinCode});m(s.token),p(2)}else{const{data:s}=await g.post("/auth/forgot-password",{role:i,registrationNo:r.registrationNo,name:r.name});m(s.token),p(2)}}catch(s){d(((c=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:c.message)||s.message||"Request failed")}},C=async t=>{var l,c;t.preventDefault(),d(""),u("");try{if(o.p1.length<6)throw new Error("Password must be at least 6 characters");if(o.p1!==o.p2)throw new Error("Passwords do not match");const s={role:i,token:j,newPassword:o.p1},k=i==="student"?{...s,registrationNo:a.registrationNo}:{...s,registrationNo:r.registrationNo,name:r.name};await g.post("/auth/reset-password",k),u("Password reset successful. You can login now.")}catch(s){d(((c=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:c.message)||s.message||"Reset failed")}};return e.jsx("div",{className:"min-h-screen p-6 flex items-center justify-center",children:e.jsxs("div",{className:"glass auth-card max-w-md w-full mx-auto rounded-2xl p-6 shadow-xl",children:[e.jsx("h1",{className:"text-xl font-semibold mb-2",children:"Reset your password"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 bg-gray-200/60 dark:bg-gray-800/70 rounded-lg p-1 mb-4",children:["student","security"].map(t=>e.jsxs("button",{type:"button",onClick:()=>{f(t),p(1),m(""),u(""),d("")},className:`text-sm font-medium rounded-md py-2 transition ${i===t?"bg-white dark:bg-gray-900 text-gray-900 dark:text-white shadow":"text-gray-700/80 dark:text-gray-300/80 hover:bg-white/70 dark:hover:bg-gray-900/50"}`,children:[" ",t[0].toUpperCase()+t.slice(1)," "]},t))}),y&&e.jsx("div",{className:"mb-3 rounded-md border border-rose-300 bg-rose-50/80 text-rose-800 px-3 py-2 text-sm",children:y}),b&&e.jsx("div",{className:"mb-3 rounded-md border border-emerald-300 bg-emerald-50/80 text-emerald-800 px-3 py-2 text-sm",children:b}),h===1&&e.jsxs("form",{className:"space-y-3",onSubmit:v,children:[i==="student"?e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"input",placeholder:"Registration No",value:a.registrationNo,onChange:t=>x({...a,registrationNo:t.target.value})}),e.jsx("input",{className:"input",placeholder:"6-digit PIN",value:a.pinCode,onChange:t=>x({...a,pinCode:t.target.value}),maxLength:6,inputMode:"numeric"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{className:"input",placeholder:"Security Name",value:r.name,onChange:t=>N({...r,name:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Registration No",value:r.registrationNo,onChange:t=>N({...r,registrationNo:t.target.value})})]}),e.jsx("button",{className:"btn w-full",children:"Get reset token"})]}),h===2&&e.jsxs("form",{className:"space-y-3",onSubmit:C,children:[e.jsx("input",{className:"input",placeholder:"New password",type:"password",value:o.p1,onChange:t=>w({...o,p1:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Confirm password",type:"password",value:o.p2,onChange:t=>w({...o,p2:t.target.value})}),e.jsx("button",{className:"btn w-full",children:"Reset password"})]}),e.jsx("div",{className:"mt-4 text-center text-sm",children:e.jsx(S,{className:"underline",to:"/login",children:"Back to login"})})]})})}export{R as default};
