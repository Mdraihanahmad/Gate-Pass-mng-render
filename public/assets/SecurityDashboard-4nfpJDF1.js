const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CWqtKnlK.js","assets/vendor-CFsy__N8.js","assets/vendor-router-CySAd55F.js","assets/vendor-axios-NIGUFBhG.js","assets/vendor-icons-B9ONrHs4.js","assets/index-BoLim9Ki.css"])))=>i.map(i=>d[i]);
import{_ as st,a as A,D as He,b as at}from"./index-CWqtKnlK.js";import{r as n,R as Ue,ap as e,aq as $e,as as it}from"./vendor-CFsy__N8.js";import{o as T}from"./offline-CafmH5fM.js";import{m as rt,n as be,L as ve,o as Ie,k as ie,P as Me,p as fe,q as ye,r as qe,s as we,d as nt,t as ot,R as ct,D as Fe,X as Be,u as lt,v as dt,H as ut}from"./vendor-icons-B9ONrHs4.js";import"./vendor-router-CySAd55F.js";import"./vendor-axios-NIGUFBhG.js";const ze={teal:{solid:"from-cyan-500 via-teal-500 to-emerald-500 text-white shadow-cyan-500/30",outline:"text-cyan-300 border border-cyan-400/30 hover:bg-cyan-500/10"},indigo:{solid:"from-indigo-500 via-violet-500 to-fuchsia-500 text-white shadow-indigo-500/30",outline:"text-violet-300 border border-violet-400/30 hover:bg-violet-500/10"},amber:{solid:"from-amber-500 via-orange-500 to-yellow-500 text-white shadow-amber-500/30",outline:"text-amber-300 border border-amber-400/30 hover:bg-amber-500/10"},rose:{solid:"from-rose-500 via-fuchsia-500 to-pink-500 text-white shadow-rose-500/30",outline:"text-rose-300 border border-rose-400/30 hover:bg-rose-500/10"}};function O({children:h,color:P="teal",variant:f="solid",size:E="sm",icon:c,className:k="",...S}){const i={xs:"text-xs px-2.5 py-1.5",sm:"text-sm px-3 py-1.5",md:"text-sm px-4 py-2",lg:"text-base px-5 py-2.5"},x="relative inline-flex items-center gap-1.5 rounded-lg font-medium tracking-wide focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-gray-900 transition disabled:opacity-50 disabled:cursor-not-allowed",l=ze[P]||ze.teal,v=f==="solid"?`bg-gradient-to-r ${l.solid} hover:brightness-110 shadow-sm`:`bg-slate-800/40 hover:bg-slate-700/50 backdrop-blur border ${l.outline}`;return e.jsxs("button",{type:"button",className:`${x} ${i[E]} ${v} ${k}`,...S,children:[c&&e.jsx("span",{className:"relative z-10",children:c}),e.jsx("span",{className:"relative z-10",children:h})]})}function vt(){const[h,P]=n.useState([]),[f,E]=n.useState({from:"",to:""}),[c,k]=n.useState({pinCode:"",sid:"",action:"check-in",purpose:"fooding",otherPurpose:""}),[S,i]=n.useState(""),[x,l]=n.useState("success"),[v,C]=n.useState(2e3),[J,W]=n.useState("default"),[j,je]=n.useState(""),[F,Qe]=n.useState("fooding"),[re,Ye]=n.useState(""),[Ne,B]=n.useState(!1),[y,z]=n.useState({name:"",vehicleNo:"",purpose:""}),[_,X]=n.useState(null),[ne,Z]=n.useState(""),[H,ke]=n.useState(!1),U=n.useRef(null),oe=n.useRef(null),[Q,ee]=n.useState(!1),ce=n.useRef(null),[le,de]=n.useState(""),[$,ue]=n.useState(null),[Y,te]=n.useState(""),[R,Ce]=n.useState(null),[me,Se]=n.useState(typeof navigator<"u"?navigator.onLine:!0),[Te,pe]=n.useState(!1),[b,Pe]=n.useState({action:"",time:"",purpose:"",registrationNo:"",prevAction:"",prevTime:""}),[Ae,Ge]=n.useState(!1),[I,Le]=n.useState(!1),[Ke,G]=n.useState(!1),[M,Oe]=n.useState({reason:"",sid:"",pin:""}),[L,De]=n.useState("students"),se=n.useRef(null),he=n.useRef(null),[N,ae]=n.useState(()=>{try{const t=localStorage.getItem("security:haptics");return!t||t==="on"?"both":t==="off"?"off":["both","sound","vibration","off"].includes(t)?t:"both"}catch{return"both"}}),[K,xe]=n.useState(!1);n.useEffect(()=>{if(!K)return;const t=a=>{he.current&&(he.current.contains(a.target)||xe(!1))},s=a=>{a.key==="Escape"&&xe(!1)};return document.addEventListener("mousedown",t,!0),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",t,!0),document.removeEventListener("keydown",s)}},[K]);const Ee=async()=>{if(N!=="off"){if(N==="both"||N==="vibration")try{navigator!=null&&navigator.vibrate&&navigator.vibrate([10,30,10])}catch{}if(N==="both"||N==="sound")try{const t=window.AudioContext||window.webkitAudioContext;if(!t)return;let s=se.current;if(s||(s=new t,se.current=s),s.state==="suspended")try{await s.resume()}catch{}const a=s.createOscillator(),r=s.createGain();a.type="sine",a.frequency.setValueAtTime(880,s.currentTime),r.gain.setValueAtTime(1e-4,s.currentTime),r.gain.exponentialRampToValueAtTime(.08,s.currentTime+.01),r.gain.exponentialRampToValueAtTime(1e-4,s.currentTime+.12),a.connect(r).connect(s.destination),a.start(),a.stop(s.currentTime+.14)}catch{}}},V=async()=>{if(N!=="off"){if(N==="both"||N==="vibration")try{navigator!=null&&navigator.vibrate&&navigator.vibrate([40,60,40])}catch{}if(N==="both"||N==="sound")try{const t=window.AudioContext||window.webkitAudioContext;if(!t)return;let s=se.current;if(s||(s=new t,se.current=s),s.state==="suspended")try{await s.resume()}catch{}const a=s.createOscillator(),r=s.createGain();a.type="sawtooth",a.frequency.setValueAtTime(660,s.currentTime),a.frequency.exponentialRampToValueAtTime(440,s.currentTime+.12),r.gain.setValueAtTime(1e-4,s.currentTime),r.gain.exponentialRampToValueAtTime(.09,s.currentTime+.01),r.gain.exponentialRampToValueAtTime(1e-4,s.currentTime+.14),a.connect(r).connect(s.destination),a.start(),a.stop(s.currentTime+.16)}catch{}}};n.useEffect(()=>{try{localStorage.setItem("security:haptics",N)}catch{}},[N]);const q=async()=>{var t,s,a;try{const{data:r}=await A.get("/security/logs",{params:f.from||f.to?{...f}:{}}),u=(()=>{if(!Array.isArray(r))return[];const g=p=>new Date(p.timestamp||p.checkOutTime||p.checkInTime||p.createdAt||0).getTime(),m=[...r].sort((p,d)=>g(d)-g(p));return m.length>200?m.slice(0,200):m})();P(u),T.saveLogs(u).catch(()=>{})}catch(r){const u=(t=r==null?void 0:r.response)==null?void 0:t.status;if(u===401||u===403){te(((a=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:a.message)||"You are not security anymore.");return}const g=await T.loadLogs().catch(()=>[]);if(g.length){const m=d=>new Date(d.timestamp||d.checkOutTime||d.checkInTime||d.createdAt||0).getTime(),p=[...g].sort((d,o)=>m(o)-m(d));P(p.slice(0,200))}}};n.useEffect(()=>{try{const a=localStorage.getItem("token");a&&st(()=>import("./index-CWqtKnlK.js").then(r=>r.c),__vite__mapDeps([0,1,2,3,4,5])).then(r=>r.api.setToken(a))}catch{}q(),(async()=>{var a,r,u;try{try{const m=localStorage.getItem("user");if(m){const p=JSON.parse(m);p&&p.role==="security"&&ue(p)}}catch{}if(!navigator.onLine)return;const{data:g}=await A.get("/auth/me");ue(g)}catch(g){const m=(a=g==null?void 0:g.response)==null?void 0:a.status;(m===401||m===403)&&te(((u=(r=g==null?void 0:g.response)==null?void 0:r.data)==null?void 0:u.message)||"You are not security anymore.")}})();const t=()=>Se(!0),s=()=>Se(!1);return window.addEventListener("online",t),window.addEventListener("offline",s),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}},[]),n.useEffect(()=>{if(!S)return;const t=setTimeout(()=>i(""),v||2e3);return()=>clearTimeout(t)},[S,v]);const Je=async t=>{var s,a,r,u;try{if(!j)return;const m=JSON.parse(t).sid;if(!m)return;const p=j==="check-out"&&(F==="other"?re||"Other":F)||void 0,d=new Date().toISOString();if(!navigator.onLine){await T.queueAction({type:"scan",payload:{sid:m,action:j,purpose:p,clientTimestamp:d}}),i(`Queued scan for ${m} (${j}) — will sync when online`),l("success");return}const o=await A.post("/security/scan",{sid:m,action:j,purpose:p,clientTimestamp:d}).catch(w=>(w==null?void 0:w.response)||{status:0,data:{message:w==null?void 0:w.message}});if(o&&o.status===403){te(((s=o.data)==null?void 0:s.message)||"You are not security anymore."),V();return}if(!o||o.status===0){await T.queueAction({type:"scan",payload:{sid:m,action:j,purpose:p,clientTimestamp:d}}),i(`Queued scan for ${m} (${j}) — will sync when online`),l("success");return}if(o.status===404){Oe({reason:"Deleted/Banned ID",sid:m,pin:""}),G(!0),i("Scan blocked: deleted/banned ID"),l("error"),V();return}if(o.status===400||o.status===429){i(((a=o==null?void 0:o.data)==null?void 0:a.message)||"Scan not allowed"),l("error"),V();return}if(o.status>=400){i(((r=o==null?void 0:o.data)==null?void 0:r.message)||"Scan failed"),l("error"),V();return}if((u=o==null?void 0:o.data)!=null&&u.student){const w=j==="check-out"?F==="other"?re||"Other":F:"";Ce(o.data.student);const D=h.find(tt=>tt.registrationNo===o.data.student.registrationNo);Pe({action:j,time:d,purpose:w,registrationNo:o.data.student.registrationNo,prevAction:(D==null?void 0:D.action)||"",prevTime:(D==null?void 0:D.timestamp)||""}),pe(!0),B(!1),Ee()}i(`Scanned ${m} (${j})`),l("success"),await q()}catch{i("Scan failed"),l("error"),V()}};n.useEffect(()=>{if(me){const t=setTimeout(async()=>{try{const s=await T.listPendingActions();let a=0,r=0;for(const u of s)try{u.type==="scan"?await A.post("/security/scan",u.payload):u.type==="manual"?await A.post("/security/manual",u.payload):u.type==="visitor:create"?await A.post("/visitors",u.payload):u.type==="visitor:exit"&&await A.patch(`/visitors/${u.payload.id}/exit`,{exitTime:u.payload.exitTime}),await T.removePendingAction(u.id),a++}catch{r++}a>0&&(i(`Synced ${a} action${a>1?"s":""}${r?`, ${r} pending`:""}`),l("success"))}catch{}await q().catch(()=>{});try{window.dispatchEvent(new CustomEvent("refresh-visitors"))}catch{}},800);return()=>clearTimeout(t)}},[me]);const We=async t=>{var a,r,u,g,m;t.preventDefault();const s={...c};c.action==="check-out"?s.purpose=c.purpose==="other"?c.otherPurpose:c.purpose:delete s.purpose,delete s.otherPurpose;try{const p=new Date().toISOString();if(!navigator.onLine){await T.queueAction({type:"manual",payload:{...s,clientTimestamp:p}}),i("Queued manual log — will sync when online"),l("success"),k({pinCode:"",sid:"",action:"check-in",purpose:"fooding",otherPurpose:""});return}const d=await A.post("/security/manual",{...s,clientTimestamp:p}).catch(o=>(o==null?void 0:o.response)||{status:0,data:{message:o==null?void 0:o.message}});if(!d||d.status===0){await T.queueAction({type:"manual",payload:{...s,clientTimestamp:p}}),i("Queued manual log — will sync when online"),l("success"),k({pinCode:"",sid:"",action:"check-in",purpose:"fooding",otherPurpose:""});return}if(d&&d.status===403){te(((a=d.data)==null?void 0:a.message)||"You are not security anymore."),V();return}if(d.status===404){const o=s.sid||"",w=s.pinCode||"";Oe({reason:"Deleted/Banned ID",sid:o,pin:w}),G(!0),i("Log blocked: deleted/banned ID"),l("error"),V();return}if(d.status===400||d.status===429||d.status>=400){i(((r=d==null?void 0:d.data)==null?void 0:r.message)||"Failed to log"),l("error"),V();return}if((u=d==null?void 0:d.data)!=null&&u.student){const o=c.action==="check-out"?c.purpose==="other"?c.otherPurpose||"Other":c.purpose:"";Ce(d.data.student);const w=h.find(D=>D.registrationNo===d.data.student.registrationNo);Pe({action:c.action,time:p,purpose:o,registrationNo:d.data.student.registrationNo,prevAction:(w==null?void 0:w.action)||"",prevTime:(w==null?void 0:w.timestamp)||""}),pe(!0),B(!1),Ee()}i(`Logged (${c.action})`),l("success"),k({pinCode:"",sid:"",action:"check-in",purpose:"fooding",otherPurpose:""}),await q()}catch(p){i(((m=(g=p==null?void 0:p.response)==null?void 0:g.data)==null?void 0:m.message)||"Failed to log"),l("error"),V()}},Xe=async t=>{var g;t.preventDefault();const s=new Date().toISOString(),a=(g=y.purpose==="Other"?le:y.purpose)==null?void 0:g.trim();if(!a){i("Please select a purpose"),l("error");return}if(H&&!_){i("Please capture a photo"),l("error"),C(2500),W("default");return}if(!navigator.onLine){await T.queueAction({type:"visitor:create",payload:{...y,purpose:a,entryTime:s}}),z({name:"",vehicleNo:"",purpose:""}),X(null),Z(""),de(""),i("Queued visitor (photo not saved offline) — will sync when online"),l("success"),C(2500),W("default");return}const r=new FormData;r.append("name",y.name),r.append("vehicleNo",y.vehicleNo),r.append("purpose",a),r.append("entryTime",s),_&&r.append("photo",_);const u=await A.post("/visitors",r,{headers:{"Content-Type":"multipart/form-data"}}).catch(m=>(m==null?void 0:m.response)||{status:0});!u||u.status===0||u.status>=400?(await T.queueAction({type:"visitor:create",payload:{...y,purpose:a,entryTime:s}}),i("Queued visitor (photo not saved) — will sync when online"),l("success"),C(2500),W("default")):(i("Visitor registered"),l("success"),C(5e3),W("fancy")),z({name:"",vehicleNo:"",purpose:""}),X(null),Z(""),de("")},Ze=async()=>{var t;try{if(!((t=navigator.mediaDevices)!=null&&t.getUserMedia)){i("Camera not supported on this device"),l("error");return}const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});oe.current=s,ke(!0),requestAnimationFrame(()=>{U.current&&(U.current.srcObject=s,U.current.play().catch(()=>{}))})}catch{i("Failed to open camera"),l("error")}},ge=()=>{try{const t=oe.current;if(t)for(const s of t.getTracks())s.stop()}catch{}oe.current=null,ke(!1)},et=async()=>{try{const t=U.current;if(!t)return;const s=1024,a=t.videoWidth||640,r=t.videoHeight||480,u=Math.min(1,s/Math.max(a,r)),g=Math.round(a*u),m=Math.round(r*u),p=document.createElement("canvas");p.width=g,p.height=m,p.getContext("2d").drawImage(t,0,0,g,m);const o=await new Promise(D=>p.toBlob(D,"image/jpeg",.7));if(!o)return;const w=new File([o],"visitor.jpg",{type:"image/jpeg"});X(w),Z(URL.createObjectURL(o)),ge(),i("Photo captured"),l("success")}catch{i("Failed to capture photo"),l("error")}};n.useEffect(()=>{L!=="visitorEntry"&&H&&ge()},[L]),n.useEffect(()=>{if(!Q)return;const t=a=>{ce.current&&(ce.current.contains(a.target)||ee(!1))},s=a=>{a.key==="Escape"&&ee(!1)};return document.addEventListener("mousedown",t,!0),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",t,!0),document.removeEventListener("keydown",s)}},[Q]);const Ve=async(t,s)=>{try{await at(`/api/export/${t}`,{type:s,from:f.from||void 0,to:f.to||void 0},`${s}-logs.${t}`)}catch(a){i(a.message||"Export failed"),l("error")}},Re=Ue.useMemo(()=>{if(!Array.isArray(h))return[];const t=a=>new Date(a.timestamp||a.checkOutTime||a.checkInTime||a.createdAt||0).getTime(),s=[...h].sort((a,r)=>t(r)-t(a));return I?s:s.slice(0,50)},[h,I]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 md:p-6 space-y-6 pb-28 sm:pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Security Dashboard"}),e.jsxs("div",{className:"relative",ref:he,children:[e.jsxs("button",{type:"button",className:`inline-flex items-center gap-2 px-3 py-1 rounded-md ${K?"text-emerald-300 bg-emerald-400/10":"text-sky-200"} hover:text-white hover:bg-sky-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition`,onClick:()=>xe(t=>!t),"aria-expanded":K,title:"Settings",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Settings"})]}),K&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded shadow-xl p-2 text-sm animate-scale-in bg-gray-900/95 text-gray-100 border border-white/10 z-50",children:[e.jsx("div",{className:"font-semibold mb-1 text-gray-200",children:"Feedback"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-800 rounded px-2 py-1",children:[e.jsx("input",{type:"radio",name:"haptics-mode",value:"both",checked:N==="both",onChange:()=>ae("both")})," Both (sound + vibration)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-800 rounded px-2 py-1",children:[e.jsx("input",{type:"radio",name:"haptics-mode",value:"sound",checked:N==="sound",onChange:()=>ae("sound")})," Sound only"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-800 rounded px-2 py-1",children:[e.jsx("input",{type:"radio",name:"haptics-mode",value:"vibration",checked:N==="vibration",onChange:()=>ae("vibration")})," Vibration only"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-800 rounded px-2 py-1",children:[e.jsx("input",{type:"radio",name:"haptics-mode",value:"off",checked:N==="off",onChange:()=>ae("off")})," Off"]})]})]})]})]}),!me&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-amber-600/20 text-amber-200 px-3 py-1 text-xs border border-amber-400/30",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-amber-400 animate-pulse"}),"Offline — showing cached data"]}),Y&&e.jsx("div",{className:"rounded border border-amber-200 bg-amber-50 text-amber-800 p-4",children:Y||"You are not security anymore."}),$&&!$.isApproved&&!$.requestedApproval&&e.jsxs("div",{className:"rounded border border-red-200 bg-red-50 text-red-800 p-4 flex items-start gap-3",children:[e.jsx("div",{className:"font-semibold",children:"Application was rejected"}),e.jsx("div",{className:"ml-auto",children:e.jsx("button",{className:"btn",onClick:async()=>{await A.post("/security/request-approval"),ue({...$,requestedApproval:!0}),i("Request sent")},children:"Send request again"})})]}),$&&!$.isApproved&&$.requestedApproval&&e.jsx("div",{className:"rounded border border-blue-200 bg-blue-50 text-blue-800 p-3",children:"Application submitted — please wait for admin approval."}),S&&J==="default"&&e.jsx("div",{role:"alert",className:`fixed top-4 right-4 z-50 shadow-lg rounded px-4 py-3 transition-opacity duration-300 ${x==="error"?"bg-red-600 text-white":"bg-green-600 text-white"}`,children:S}),S&&J==="fancy"&&e.jsx("div",{className:"fixed inset-x-0 bottom-6 z-[9999] flex justify-center px-4",children:e.jsxs("div",{className:"relative inline-flex items-center gap-3 px-5 py-3 rounded-2xl border border-white/10 shadow-2xl bg-gradient-to-r from-emerald-500/20 via-teal-500/20 to-cyan-500/20 backdrop-blur-md text-white",children:[e.jsx("span",{className:"absolute -inset-2 -z-10 blur-2xl bg-gradient-to-r from-emerald-500/20 via-teal-500/20 to-cyan-500/20","aria-hidden":"true"}),e.jsx("svg",{className:"h-5 w-5 text-emerald-300",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M20 6L9 17l-5-5",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"font-semibold tracking-wide",children:S})]})}),!Y&&L==="students"&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scan Student QR"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm mr-2 block",children:"Action"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{je("check-in"),B(!0)},"aria-pressed":j==="check-in",className:`relative inline-flex items-center gap-2 px-5 py-2.5 text-sm font-medium rounded-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-cyan-400/60 focus-visible:ring-offset-gray-900 group ${j==="check-in"?"text-white bg-gradient-to-r from-cyan-500 via-teal-500 to-emerald-500 shadow-sm border border-transparent":"text-cyan-300 bg-slate-800/40 hover:bg-slate-700/50 border border-cyan-500/30"} `,children:[j==="check-in"&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-white/10 group-hover:bg-white/15 transition","aria-hidden":"true"}),e.jsx(be,{className:"relative h-4 w-4"}),e.jsx("span",{className:"relative tracking-wide",children:"Check In"})]}),e.jsxs("button",{type:"button",onClick:()=>{je("check-out"),B(!0)},"aria-pressed":j==="check-out",className:`relative inline-flex items-center gap-2 px-5 py-2.5 text-sm font-medium rounded-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-violet-400/60 focus-visible:ring-offset-gray-900 group ${j==="check-out"?"text-white bg-gradient-to-r from-indigo-500 via-violet-500 to-fuchsia-500 shadow-sm border border-transparent":"text-violet-300 bg-slate-800/40 hover:bg-slate-700/50 border border-violet-500/30"} `,children:[j==="check-out"&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-white/10 group-hover:bg-white/15 transition","aria-hidden":"true"}),e.jsx(ve,{className:"relative h-4 w-4"}),e.jsx("span",{className:"relative tracking-wide",children:"Check Out"})]})]})]}),j==="check-out"&&e.jsx("div",{className:"mb-3",children:e.jsx(_e,{label:"Purpose",value:F,onChange:Qe,otherValue:re,onOtherChange:Ye,layout:"row"})}),Ne?e.jsx("div",{className:"max-w-full sm:max-w-sm",children:e.jsx(it,{width:320,height:240,onUpdate:(t,s)=>{Te||s!=null&&s.text&&Je(s.text)}},Ne?"on":"off")}):e.jsx("div",{className:"text-sm text-gray-400",children:j?"Select the action again to start scanning.":"Select Check In or Check Out to start scanning."})]}),!Y&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"hidden sm:flex items-center gap-2 mb-3",role:"tablist","aria-label":"Security dashboard sections",children:[{key:"students",label:"Student Logs",icon:e.jsx(Ie,{className:"h-4 w-4"})},{key:"visitors",label:"Visitor Logs",icon:e.jsx(ie,{className:"h-4 w-4"})},{key:"manual",label:"Manual Entry",icon:e.jsx(Me,{className:"h-4 w-4"})},{key:"visitorEntry",label:"Visitor Entry",icon:e.jsx(fe,{className:"h-4 w-4"})}].map(t=>e.jsxs("button",{type:"button",role:"tab","aria-selected":L===t.key,onClick:()=>De(t.key),className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition border focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 ${L===t.key?"bg-gradient-to-r from-cyan-500/20 to-violet-500/20 text-white border-cyan-400/40":"bg-slate-800/40 text-gray-300 border-white/10 hover:bg-slate-700/50"}`,children:[t.icon,t.label]},t.key))}),L==="manual"&&e.jsxs("div",{role:"tabpanel","aria-label":"Manual Entry",className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Manual Entry"}),e.jsxs("form",{className:"flex flex-col lg:flex-row gap-2 lg:items-end",onSubmit:We,children:[e.jsx("input",{className:"input",placeholder:"QR sid (optional)",value:c.sid,onChange:t=>k({...c,sid:t.target.value})}),e.jsx("input",{className:"input",placeholder:"6-digit PIN (optional)",value:c.pinCode,onChange:t=>k({...c,pinCode:t.target.value})}),e.jsxs("div",{className:"flex flex-col min-w-[200px] lg:min-w-[230px]",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-400 mb-1 hidden lg:inline",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>k({...c,action:"check-in"}),"aria-pressed":c.action==="check-in",className:`relative inline-flex flex-1 items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-[13px] lg:text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-cyan-400/60 focus-visible:ring-offset-gray-900 transition-colors ${c.action==="check-in"?"text-white bg-gradient-to-r from-cyan-500 via-teal-500 to-emerald-500 border border-transparent shadow-sm":"text-cyan-300 bg-slate-800/40 hover:bg-slate-700/50 border border-cyan-500/30"} `,children:[c.action==="check-in"&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-white/10"}),e.jsx(be,{className:"h-4 w-4 relative"}),e.jsx("span",{className:"relative",children:"Check In"})]}),e.jsxs("button",{type:"button",onClick:()=>k({...c,action:"check-out"}),"aria-pressed":c.action==="check-out",className:`relative inline-flex flex-1 items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-[13px] lg:text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-violet-400/60 focus-visible:ring-offset-gray-900 transition-colors ${c.action==="check-out"?"text-white bg-gradient-to-r from-indigo-500 via-violet-500 to-fuchsia-500 border border-transparent shadow-sm":"text-violet-300 bg-slate-800/40 hover:bg-slate-700/50 border border-violet-500/30"} `,children:[c.action==="check-out"&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-white/10"}),e.jsx(ve,{className:"h-4 w-4 relative"}),e.jsx("span",{className:"relative",children:"Check Out"})]})]})]}),c.action==="check-out"&&e.jsx("div",{className:"min-w-[260px]",children:e.jsx(_e,{label:"Purpose",value:c.purpose,onChange:t=>k({...c,purpose:t}),otherValue:c.otherPurpose,onOtherChange:t=>k({...c,otherPurpose:t}),layout:"column"})}),e.jsx(O,{color:"teal",type:"submit",icon:e.jsx(be,{className:"h-4 w-4"}),children:"Log"})]})]}),L==="visitorEntry"&&e.jsxs("div",{role:"tabpanel","aria-label":"Visitor Entry",className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Visitor Registration"}),e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-5 gap-2",onSubmit:Xe,children:[e.jsx("input",{className:"input",placeholder:"Name",value:y.name,onChange:t=>z({...y,name:t.target.value}),required:!0}),e.jsx("input",{className:"input",placeholder:"Vehicle No",value:y.vehicleNo,onChange:t=>z({...y,vehicleNo:t.target.value})}),e.jsxs("div",{className:"relative",ref:ce,children:[e.jsxs("button",{type:"button",className:`w-full inline-flex items-center justify-between gap-2 px-3 py-2 rounded-lg bg-slate-800/50 border border-white/10 text-sm ${y.purpose?"text-gray-100":"text-gray-400"} hover:bg-slate-700/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50`,onClick:()=>ee(t=>!t),"aria-haspopup":"menu","aria-expanded":Q,children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[y.purpose==="Food Delivery"&&e.jsx(ye,{className:"h-4 w-4"}),y.purpose==="Courier"&&e.jsx(qe,{className:"h-4 w-4"}),y.purpose==="Guest"&&e.jsx(ie,{className:"h-4 w-4"}),y.purpose==="Other"&&e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:y.purpose==="Other"?le||"Other":y.purpose||"Purpose"})]}),e.jsx("svg",{className:`h-4 w-4 transition ${Q?"rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"})})]}),Q&&e.jsx("div",{role:"menu",className:"absolute z-50 mt-1 w-full rounded-lg bg-gray-900/95 border border-white/10 shadow-xl overflow-hidden",children:[{label:"Food Delivery",icon:ye},{label:"Courier",icon:qe},{label:"Guest",icon:ie},{label:"Other",icon:we}].map(t=>{const s=t.icon,a=y.purpose===t.label;return e.jsxs("button",{type:"button",role:"menuitemradio","aria-checked":a,className:`w-full text-left px-3 py-2 text-sm inline-flex items-center gap-2 hover:bg-white/10 ${a?"bg-white/5 text-white":"text-gray-200"}`,onClick:()=>{z({...y,purpose:t.label}),ee(!1)},children:[e.jsx(s,{className:"h-4 w-4"}),e.jsx("span",{children:t.label})]},t.label)})})]}),y.purpose==="Other"&&e.jsx("input",{className:"input md:col-span-2",placeholder:"Type custom purpose",value:le,onChange:t=>de(t.target.value)}),e.jsx("div",{className:"flex items-center gap-2",children:H?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{color:"amber",type:"button",onClick:et,children:"Capture"}),e.jsx(O,{color:"rose",type:"button",variant:"outline",onClick:ge,children:"Close"})]}):e.jsx(O,{color:"teal",type:"button",onClick:Ze,icon:e.jsx(nt,{className:"h-4 w-4"}),children:"Open Camera"})}),!H||ne?e.jsx(O,{color:"teal",type:"submit",icon:e.jsx(fe,{className:"h-4 w-4"}),children:"Add Visitor"}):e.jsx("div",{className:"text-xs text-gray-400 self-center",children:"Capture a photo to enable"}),ne&&e.jsxs("div",{className:"col-span-1 md:col-span-5 flex items-center gap-3",children:[e.jsx("img",{src:ne,alt:"Visitor preview",className:"h-28 w-28 rounded-lg border border-white/10 object-cover"}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Compressed to ~",_?Math.ceil(_.size/1024):"?"," KB"]}),e.jsx(O,{color:"amber",type:"button",variant:"outline",onClick:()=>{X(null),Z("")},children:"Retake"})]})]}),H&&e.jsx("div",{className:"mt-2",children:e.jsx("video",{ref:U,className:"w-full max-w-xs rounded-lg border border-white/10",playsInline:!0,muted:!0})})]}),L==="students"&&e.jsxs("div",{role:"tabpanel","aria-label":"Student Logs",className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"From"}),e.jsx("input",{type:"datetime-local",className:"input",value:f.from,onChange:t=>E({...f,from:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"To"}),e.jsx("input",{type:"datetime-local",className:"input",value:f.to,onChange:t=>E({...f,to:t.target.value})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(O,{color:"teal",onClick:q,title:"Filter logs",icon:e.jsx(ot,{className:"h-4 w-4"}),children:"Filter"}),e.jsx(O,{color:"amber",variant:"outline",onClick:()=>q(),title:"Refresh now",icon:e.jsx(ct,{className:"h-4 w-4"}),children:"Refresh"}),e.jsx(O,{color:"indigo",onClick:()=>Ve("pdf","students"),icon:e.jsx(Fe,{className:"h-4 w-4"}),children:"PDF"}),e.jsx(O,{color:"indigo",variant:"outline",onClick:()=>Ve("docx","students"),icon:e.jsx(Fe,{className:"h-4 w-4"}),children:"DOCX"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mt-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:Re.length}),h.length>50&&!I&&e.jsxs(e.Fragment,{children:[" of ",e.jsx("span",{className:"font-medium",children:h.length})]}),h.length>50&&!I&&e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest"}),I&&h.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),h.length>50&&e.jsxs("div",{className:"flex gap-2",children:[!I&&e.jsxs("button",{type:"button",onClick:()=>Le(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",h.length-50]})]}),I&&e.jsx("button",{type:"button",onClick:()=>Le(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"})]})]}),e.jsx(He,{maxHeight:"60vh",columns:[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"action",title:"Action"},{key:"purpose",title:"Purpose"},{key:"checkInTime",title:"Check-in",render:t=>t?new Date(t).toLocaleString():"-"},{key:"checkOutTime",title:"Check-out",render:t=>t?new Date(t).toLocaleString():"-"}],data:Re})]}),L==="visitors"&&e.jsx("div",{role:"tabpanel","aria-label":"Visitor Logs",className:"overflow-auto",children:e.jsx(mt,{})})]}),!Y&&e.jsx("div",{className:"sm:hidden fixed bottom-0 inset-x-0 z-40 bg-gray-900/85 backdrop-blur-md border-t border-white/10 shadow-[0_-8px_16px_rgba(0,0,0,0.35)]",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:e.jsx("div",{className:"grid grid-cols-4 h-16",children:[{key:"students",label:"Students",icon:e.jsx(Ie,{className:"h-5 w-5"})},{key:"visitors",label:"Visitors",icon:e.jsx(ie,{className:"h-5 w-5"})},{key:"manual",label:"Manual",icon:e.jsx(Me,{className:"h-5 w-5"})},{key:"visitorEntry",label:"Add Visitor",icon:e.jsx(fe,{className:"h-5 w-5"})}].map(t=>e.jsxs("button",{type:"button","aria-label":t.label,onClick:()=>De(t.key),className:`relative flex flex-col items-center justify-center gap-1 h-16 text-sm font-medium ${L===t.key?"text-white":"text-gray-300"} focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50`,children:[e.jsx("span",{className:`absolute inset-x-8 top-0 h-1 rounded-full ${L===t.key?"bg-gradient-to-r from-cyan-400 to-violet-400":"bg-transparent"}`}),t.icon,e.jsx("span",{children:t.label})]},t.key))})})]}),Te&&R&&$e.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm animate-fade-in"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative w-[88vw] max-w-xl rounded-2xl shadow-2xl border border-white/10 bg-gray-900/95 text-gray-100 animate-scale-in overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("button",{type:"button",onClick:()=>{pe(!1),B(!1)},"aria-label":"Close",className:"group absolute top-2 right-2",children:[e.jsx("span",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-emerald-500/40 to-sky-500/40 blur-md opacity-0 group-hover:opacity-100 transition"}),e.jsx("span",{className:"relative inline-flex h-10 w-10 items-center justify-center rounded-full bg-gray-900/90 text-white border border-white/10 shadow-lg ring-1 ring-white/10 hover:scale-105 transition",children:e.jsx(Be,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-0",children:[e.jsx("div",{className:"p-3 sm:p-4 flex items-center justify-center bg-gray-800/60",children:e.jsx("img",{src:R.profilePhotoUrl||R.profilePhotoThumbUrl||"https://placehold.co/512x512?text=No+Photo",alt:"Student",className:"w-full max-w-[360px] aspect-square object-cover rounded-xl border border-white/10",loading:"eager",decoding:"async"})}),e.jsxs("div",{className:"p-3 sm:p-4 space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Student Details"}),(b==null?void 0:b.action)&&e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs ${b.action==="check-in"?"bg-emerald-500/15 text-emerald-300 border border-emerald-400/20":"bg-sky-500/15 text-sky-300 border border-sky-400/20"}`,children:b.action==="check-in"?"Checked in":"Checked out"})]}),(b==null?void 0:b.time)&&e.jsx("div",{className:"text-[12px] text-gray-400 -mt-1",children:new Date(b.time).toLocaleString()}),(b==null?void 0:b.purpose)&&e.jsxs("div",{className:"text-[12px] text-gray-300",children:["Purpose: ",e.jsx("span",{className:"font-medium",children:b.purpose})]}),e.jsxs("div",{className:"text-[12px] text-gray-300",children:["Current status: ",e.jsx("span",{className:"font-medium",children:b.action==="check-in"?"Inside campus":"Outside campus"})]}),(b==null?void 0:b.prevAction)&&(b==null?void 0:b.prevTime)&&e.jsxs("div",{className:"text-[12px] text-gray-400",children:["Previous: ",b.prevAction," at ",new Date(b.prevTime).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Name:"})," ",e.jsx("span",{className:"font-medium",children:R.name||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Reg No:"})," ",e.jsx("span",{className:"font-medium",children:R.registrationNo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Branch:"})," ",e.jsx("span",{className:"font-medium",children:R.branch||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Batch:"})," ",e.jsx("span",{className:"font-medium",children:R.batchYear||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"SID:"})," ",e.jsx("span",{className:"font-medium",children:R.studentUid||"-"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md bg-gray-700/60 px-3 py-1.5 text-xs text-gray-100 border border-white/10 hover:bg-gray-700/80",onClick:()=>Ge(t=>!t),children:Ae?"Hide history":"View recent history"})}),Ae&&e.jsx("div",{className:"mt-2 max-h-48 overflow-auto border border-white/10 rounded",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-800/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2 py-1",children:"Action"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Purpose"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Time"})]})}),e.jsx("tbody",{children:h.filter(t=>t.registrationNo===b.registrationNo).slice(0,8).map(t=>{const s=t.timestamp||t.checkInTime||t.checkOutTime;return e.jsxs("tr",{className:"border-t border-white/10",children:[e.jsx("td",{className:"px-2 py-1 capitalize",children:t.action}),e.jsx("td",{className:"px-2 py-1",children:t.purpose||"-"}),e.jsx("td",{className:"px-2 py-1",children:s?new Date(s).toLocaleString():"-"})]},t._id)})})]})})]})]})]})})]}),document.body),Ke&&$e.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm animate-fade-in",onClick:()=>G(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative w-[88vw] max-w-md rounded-2xl shadow-2xl border border-rose-400/30 bg-gray-900/95 text-gray-100 animate-scale-in overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:()=>G(!1),"aria-label":"Close",className:"group absolute top-2 right-2",children:e.jsx("span",{className:"relative inline-flex h-10 w-10 items-center justify-center rounded-full bg-gray-900/90 text-white border border-white/10 shadow-lg ring-1 ring-white/10 hover:scale-105 transition",children:e.jsx(Be,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-rose-300",children:[e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.5a.75.75 0 00-1.5 0v5a.75.75 0 001.5 0v-5zM10 14.5a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),e.jsx("div",{className:"text-lg font-semibold",children:"Deleted/Banned ID"})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-300",children:"This QR/PIN is not valid. The student may have been deleted or is not approved."}),(M.sid||M.pin)&&e.jsxs("div",{className:"mt-3 text-sm",children:[M.sid&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"SID:"})," ",e.jsx("span",{className:"font-mono",children:M.sid})]}),M.pin&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"PIN:"})," ",e.jsx("span",{className:"font-mono",children:M.pin})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>G(!1),className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-rose-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400/50",children:"Close"})})]})]})})]}),document.body)]})}function mt(){const[h,P]=n.useState([]),[f,E]=n.useState(!1),c=async()=>{try{const i=await A.get("/visitors"),x=(()=>{if(!Array.isArray(i.data))return[];const l=C=>new Date(C.exitTime||C.entryTime||C.createdAt||0).getTime();return[...i.data].sort((C,J)=>l(J)-l(C)).slice(0,200)})();P(x),T.saveVisitors(x).catch(()=>{})}catch{const i=await T.loadVisitors().catch(()=>[]);if(i.length){const x=v=>new Date(v.exitTime||v.entryTime||v.createdAt||0).getTime(),l=[...i].sort((v,C)=>x(C)-x(v));P(l.slice(0,200))}else P([])}};n.useEffect(()=>{c()},[]),n.useEffect(()=>{const i=()=>setTimeout(()=>{c().catch(()=>{})},600);return window.addEventListener("online",i),window.addEventListener("refresh-visitors",i),()=>{window.removeEventListener("online",i),window.removeEventListener("refresh-visitors",i)}},[]);const k=async i=>{const x=new Date().toISOString();if(!navigator.onLine){await T.queueAction({type:"visitor:exit",payload:{id:i,exitTime:x}}),P(l=>l.map(v=>v._id===i?{...v,exitTime:x}:v));return}await A.patch(`/visitors/${i}/exit`,{exitTime:x});try{await c()}catch{}},S=Ue.useMemo(()=>f?h:h.slice(0,50),[h,f]);return e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Visitor Logs"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:S.length}),h.length>50&&!f&&e.jsxs(e.Fragment,{children:[" of ",e.jsx("span",{className:"font-medium",children:h.length})]}),h.length===200&&e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest 200"}),f&&h.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),h.length>50&&e.jsxs("div",{className:"flex gap-2",children:[!f&&e.jsxs("button",{type:"button",onClick:()=>E(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",h.length-50]})]}),f&&e.jsx("button",{type:"button",onClick:()=>E(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"})]})]}),e.jsx(He,{maxHeight:"50vh",columns:[{key:"name",title:"Name"},{key:"vehicleNo",title:"Vehicle"},{key:"purpose",title:"Purpose"},{key:"entryTime",title:"Entry",render:i=>new Date(i).toLocaleString()},{key:"exitTime",title:"Exit",render:(i,x)=>x.exitTime?new Date(x.exitTime).toLocaleString():e.jsx(O,{size:"xs",color:"rose",onClick:()=>k(x._id),icon:e.jsx(ve,{className:"h-3 w-3"}),children:"Mark Exit"})}],data:S})]})}function _e({label:h="Purpose",value:P,onChange:f,otherValue:E,onOtherChange:c,layout:k="row"}){const S=[{key:"fooding",label:"Fooding",color:"emerald",icon:ye,description:"Meal outside campus"},{key:"marketing",label:"Marketing",color:"sky",icon:lt,description:"Purchase / market visit"},{key:"medicine",label:"Medicine",color:"rose",icon:dt,description:"Medical / pharmacy"},{key:"home",label:"Home",color:"amber",icon:ut,description:"Going home"},{key:"other",label:"Other",color:"violet",icon:we,description:"Custom reason"}],i={emerald:{base:"bg-emerald-600/15 text-emerald-300 border-emerald-500/30 hover:bg-emerald-600/25",active:"bg-emerald-500/90 text-white shadow-inner border-emerald-300/60"},sky:{base:"bg-sky-600/15 text-sky-300 border-sky-500/30 hover:bg-sky-600/25",active:"bg-sky-500/90 text-white shadow-inner border-sky-300/60"},rose:{base:"bg-rose-600/15 text-rose-300 border-rose-500/30 hover:bg-rose-600/25",active:"bg-rose-500/90 text-white shadow-inner border-rose-300/60"},amber:{base:"bg-amber-600/15 text-amber-300 border-amber-500/30 hover:bg-amber-600/25",active:"bg-amber-500/90 text-white shadow-inner border-amber-300/60"},violet:{base:"bg-violet-600/15 text-violet-300 border-violet-500/30 hover:bg-violet-600/25",active:"bg-violet-500/90 text-white shadow-inner border-violet-300/60"}};return e.jsxs("div",{children:[h&&e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-400 mb-1",children:h}),e.jsx("div",{className:`flex ${k==="row"?"flex-row flex-wrap gap-2":"flex-col gap-2"} max-w-xl`,role:"radiogroup","aria-label":h,children:S.map(x=>{const l=x.icon,v=P===x.key,C=i[x.color];return e.jsxs("button",{type:"button",role:"radio","aria-checked":v,onClick:()=>f(x.key),className:`group relative px-3 py-2 rounded-lg border text-[12px] font-medium flex items-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/40 transition ${v?C.active:C.base}`,title:x.description,children:[v&&e.jsx("span",{className:"absolute inset-0 animate-pulse bg-white/10 rounded-lg pointer-events-none"}),e.jsx(l,{className:`h-4 w-4 ${v?"opacity-100":"opacity-70 group-hover:opacity-90"}`}),e.jsx("span",{children:x.label})]},x.key)})}),P==="other"&&e.jsx("input",{className:"input mt-2",placeholder:"Type custom purpose",value:E,onChange:x=>c(x.target.value)})]})}export{vt as default};
