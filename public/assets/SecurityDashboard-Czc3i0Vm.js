const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DyhlbA6Q.js","assets/vendor-CFsy__N8.js","assets/vendor-router-CySAd55F.js","assets/vendor-axios-NIGUFBhG.js","assets/vendor-icons-DxUJAirC.js","assets/index-BUlwgRgW.css"])))=>i.map(i=>d[i]);
import{_ as yt,a as O,D as De,b as vt}from"./index-DyhlbA6Q.js";import{r,R as tt,ap as e,aq as Le,as as wt}from"./vendor-CFsy__N8.js";import{o as j}from"./offline-BGNqmuom.js";import{p as jt,q as pe,b as ge,r as Ge,n as xe,P as We,s as Ee,t as Oe,u as Ke,v as Ve,f as Nt,w as kt,R as St,D as Je,X as Xe,x as Ct,y as Tt,z as At}from"./vendor-icons-DxUJAirC.js";import"./vendor-router-CySAd55F.js";import"./vendor-axios-NIGUFBhG.js";const Ze={teal:{solid:"from-cyan-500 via-teal-500 to-emerald-500 text-white shadow-cyan-500/30",outline:"text-cyan-300 border border-cyan-400/30 hover:bg-cyan-500/10"},indigo:{solid:"from-indigo-500 via-violet-500 to-fuchsia-500 text-white shadow-indigo-500/30",outline:"text-violet-300 border border-violet-400/30 hover:bg-violet-500/10"},amber:{solid:"from-amber-500 via-orange-500 to-yellow-500 text-white shadow-amber-500/30",outline:"text-amber-300 border border-amber-400/30 hover:bg-amber-500/10"},rose:{solid:"from-rose-500 via-fuchsia-500 to-pink-500 text-white shadow-rose-500/30",outline:"text-rose-300 border border-rose-400/30 hover:bg-rose-500/10"}};function P({children:m,color:k="teal",variant:f="solid",size:A="sm",icon:n,className:S="",...L}){const c={xs:"text-xs px-2.5 py-1.5",sm:"text-sm px-3 py-1.5",md:"text-sm px-4 py-2",lg:"text-base px-5 py-2.5"},y="relative inline-flex items-center gap-1.5 rounded-lg font-medium tracking-wide focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-gray-900 transition disabled:opacity-50 disabled:cursor-not-allowed",x=Ze[k]||Ze.teal,E=f==="solid"?`bg-gradient-to-r ${x.solid} hover:brightness-110 shadow-sm`:`bg-slate-800/40 hover:bg-slate-700/50 backdrop-blur border ${x.outline}`;return e.jsxs("button",{type:"button",className:`${y} ${c[A]} ${E} ${S}`,...L,children:[n&&e.jsx("span",{className:"relative z-10",children:n}),e.jsx("span",{className:"relative z-10",children:m})]})}function It(){const[m,k]=r.useState([]),[f,A]=r.useState({from:"",to:""}),[n,S]=r.useState({pinCode:"",sid:"",action:"check-in",purpose:"fooding",otherPurpose:""}),[L,c]=r.useState(""),[y,x]=r.useState("success"),[E,$]=r.useState(2e3),[Re,_]=r.useState("default"),[v,$e]=r.useState(""),[F,st]=r.useState("fooding"),[ie,at]=r.useState(""),[Ie,B]=r.useState(!1),[N,W]=r.useState({name:"",vehicleNo:"",purpose:""}),[C,H]=r.useState([]),[re,be]=r.useState([]),[K,Be]=r.useState(!1),J=r.useRef(null),ye=r.useRef(null),[X,ne]=r.useState(!1),ve=r.useRef(null),[we,je]=r.useState(""),[U,Ne]=r.useState(null),[Z,oe]=r.useState(""),[q,ce]=r.useState(null),[ke,qe]=r.useState(typeof navigator<"u"?navigator.onLine:!0),[ze,ee]=r.useState(!1),[p,le]=r.useState({action:"",time:"",purpose:"",registrationNo:"",prevAction:"",prevTime:""}),[Fe,it]=r.useState(!1),[M,Ue]=r.useState(!1),[Q,rt]=r.useState("all"),[nt,te]=r.useState(!1),[Y,Me]=r.useState({reason:"",sid:"",pin:""}),[V,_e]=r.useState("students"),de=r.useRef(null),Se=r.useRef(null),[T,ue]=r.useState(()=>{try{const t=localStorage.getItem("security:haptics");return!t||t==="on"?"both":t==="off"?"off":["both","sound","vibration","off"].includes(t)?t:"both"}catch{return"both"}}),[se,Ce]=r.useState(!1),ot=r.useRef(null),me=r.useRef(null),[ct,lt]=r.useState(!1),[ae,He]=r.useState(!1),Te=r.useRef({text:"",t:0}),[D,he]=r.useState(null);r.useEffect(()=>{if(!D)return;const t=setTimeout(()=>he(null),3e3);return()=>clearTimeout(t)},[D]),r.useEffect(()=>{if(!se)return;const t=a=>{Se.current&&(Se.current.contains(a.target)||Ce(!1))},s=a=>{a.key==="Escape"&&Ce(!1)};return document.addEventListener("mousedown",t,!0),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",t,!0),document.removeEventListener("keydown",s)}},[se]);const Ae=async()=>{if(T!=="off"){if(T==="both"||T==="vibration")try{navigator!=null&&navigator.vibrate&&navigator.vibrate([10,30,10])}catch{}if(T==="both"||T==="sound")try{const t=window.AudioContext||window.webkitAudioContext;if(!t)return;let s=de.current;if(s||(s=new t,de.current=s),s.state==="suspended")try{await s.resume()}catch{}const a=s.createOscillator(),i=s.createGain();a.type="sine",a.frequency.setValueAtTime(880,s.currentTime),i.gain.setValueAtTime(1e-4,s.currentTime),i.gain.exponentialRampToValueAtTime(.08,s.currentTime+.01),i.gain.exponentialRampToValueAtTime(1e-4,s.currentTime+.12),a.connect(i).connect(s.destination),a.start(),a.stop(s.currentTime+.14)}catch{}}},I=async()=>{if(T!=="off"){if(T==="both"||T==="vibration")try{navigator!=null&&navigator.vibrate&&navigator.vibrate([40,60,40])}catch{}if(T==="both"||T==="sound")try{const t=window.AudioContext||window.webkitAudioContext;if(!t)return;let s=de.current;if(s||(s=new t,de.current=s),s.state==="suspended")try{await s.resume()}catch{}const a=s.createOscillator(),i=s.createGain();a.type="sawtooth",a.frequency.setValueAtTime(660,s.currentTime),a.frequency.exponentialRampToValueAtTime(440,s.currentTime+.12),i.gain.setValueAtTime(1e-4,s.currentTime),i.gain.exponentialRampToValueAtTime(.09,s.currentTime+.01),i.gain.exponentialRampToValueAtTime(1e-4,s.currentTime+.14),a.connect(i).connect(s.destination),a.start(),a.stop(s.currentTime+.16)}catch{}}};r.useEffect(()=>{try{localStorage.setItem("security:haptics",T)}catch{}},[T]);const G=async()=>{var t,s,a;try{const{data:i}=await O.get("/security/logs",{params:f.from||f.to?{...f}:{}}),l=(()=>{if(!Array.isArray(i))return[];const d=h=>new Date(h.timestamp||h.checkOutTime||h.checkInTime||h.createdAt||0).getTime(),g=[...i].sort((h,o)=>d(o)-d(h));return g.length>200?g.slice(0,200):g})();k(l),j.saveLogs(l).catch(()=>{})}catch(i){const l=(t=i==null?void 0:i.response)==null?void 0:t.status;if(l===401||l===403){oe(((a=(s=i==null?void 0:i.response)==null?void 0:s.data)==null?void 0:a.message)||"You are not security anymore.");return}const d=await j.loadLogs().catch(()=>[]);if(d.length){const g=o=>new Date(o.timestamp||o.checkOutTime||o.checkInTime||o.createdAt||0).getTime(),h=[...d].sort((o,u)=>g(u)-g(o));k(h.slice(0,200))}}};r.useEffect(()=>{try{const a=localStorage.getItem("token");a&&yt(()=>import("./index-DyhlbA6Q.js").then(i=>i.c),__vite__mapDeps([0,1,2,3,4,5])).then(i=>i.api.setToken(a))}catch{}G(),j.pruneStudentCache(60).catch(()=>{}),(async()=>{var a,i,l;try{try{const g=localStorage.getItem("user");if(g){const h=JSON.parse(g);h&&h.role==="security"&&Ne(h)}}catch{}if(!navigator.onLine)return;const{data:d}=await O.get("/auth/me");Ne(d)}catch(d){const g=(a=d==null?void 0:d.response)==null?void 0:a.status;(g===401||g===403)&&oe(((l=(i=d==null?void 0:d.response)==null?void 0:i.data)==null?void 0:l.message)||"You are not security anymore.")}})();const t=()=>qe(!0),s=()=>qe(!1);return window.addEventListener("online",t),window.addEventListener("offline",s),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}},[]),r.useEffect(()=>{if(!L)return;const t=setTimeout(()=>c(""),E||2e3);return()=>clearTimeout(t)},[L,E]);const dt=()=>{try{const t=me.current;t&&typeof t.getTracks=="function"&&t.getTracks().forEach(s=>{try{s.stop()}catch{}})}catch{}me.current=null,He(!1),B(!1)},ut=async t=>{var s,a,i,l;try{if(!v)return;let d="";try{const u=JSON.parse(t);d=u&&typeof u=="object"?u.sid:""}catch{d=t}if(!d)return;const g=v==="check-out"&&(F==="other"?ie||"Other":F)||void 0,h=new Date().toISOString();if(!navigator.onLine){await j.queueAction({type:"scan",payload:{sid:d,action:v,purpose:g,clientTimestamp:h}}),c(`Queued scan for ${d} (${v}) — will sync when online`),x("success");try{const u=await j.getStudentBySid(d);if(u){const w=v==="check-out"?F==="other"?ie||"Other":F:"";ce({name:u.name,registrationNo:u.registrationNo,branch:u.branch,batchYear:u.batchYear,studentUid:u.sid,profilePhotoUrl:u.profilePhotoUrl,profilePhotoThumbUrl:u.profilePhotoThumbUrl});const b=m.find(z=>z.registrationNo===u.registrationNo);le({action:v,time:h,purpose:w,registrationNo:u.registrationNo,prevAction:(b==null?void 0:b.action)||"",prevTime:(b==null?void 0:b.timestamp)||""}),ee(!0),B(!1)}}catch{}he({action:v,name:"Queued",registrationNo:d,time:h,queued:!0});return}const o=await O.post("/security/scan",{sid:d,action:v,purpose:g,clientTimestamp:h}).catch(u=>(u==null?void 0:u.response)||{status:0,data:{message:u==null?void 0:u.message}});if(o&&o.status===403){oe(((s=o.data)==null?void 0:s.message)||"You are not security anymore."),I();return}if(!o||o.status===0){await j.queueAction({type:"scan",payload:{sid:d,action:v,purpose:g,clientTimestamp:h}}),c(`Queued scan for ${d} (${v}) — will sync when online`),x("success"),he({action:v,name:"Queued",registrationNo:d,time:h,queued:!0});return}if(o.status===404){Me({reason:"Deleted/Banned ID",sid:d,pin:""}),te(!0),c("Scan blocked: deleted/banned ID"),x("error"),I();return}if(o.status===400||o.status===429){c(((a=o==null?void 0:o.data)==null?void 0:a.message)||"Scan not allowed"),x("error"),I();return}if(o.status>=400){c(((i=o==null?void 0:o.data)==null?void 0:i.message)||"Scan failed"),x("error"),I();return}if((l=o==null?void 0:o.data)!=null&&l.student){const u=v==="check-out"?F==="other"?ie||"Other":F:"";ce(o.data.student);const w=m.find(b=>b.registrationNo===o.data.student.registrationNo);le({action:v,time:h,purpose:u,registrationNo:o.data.student.registrationNo,prevAction:(w==null?void 0:w.action)||"",prevTime:(w==null?void 0:w.timestamp)||""}),ee(!0),B(!1),Ae(),he({action:v,name:o.data.student.name||"",registrationNo:o.data.student.registrationNo,time:h});try{await j.saveStudentBySid(o.data.student)}catch{}}c(`Scanned ${d} (${v})`),x("success"),await G()}catch{c("Scan failed"),x("error"),I()}};r.useEffect(()=>{if(ke){const t=setTimeout(async()=>{try{const s=await j.listPendingActions();let a=0,i=0;for(const l of s)try{l.type==="scan"?await O.post("/security/scan",l.payload):l.type==="manual"?await O.post("/security/manual",l.payload):l.type==="visitor:create"?await O.post("/visitors",l.payload):l.type==="visitor:exit"&&await O.patch(`/visitors/${l.payload.id}/exit`,{exitTime:l.payload.exitTime}),await j.removePendingAction(l.id),a++}catch{i++}a>0&&(c(`Synced ${a} action${a>1?"s":""}${i?`, ${i} pending`:""}`),x("success"))}catch{}await G().catch(()=>{});try{await j.pruneStudentCache(60)}catch{}try{window.dispatchEvent(new CustomEvent("refresh-visitors"))}catch{}},800);return()=>clearTimeout(t)}},[ke]);const mt=async t=>{var a,i,l,d,g;t.preventDefault();const s={...n};n.action==="check-out"?s.purpose=n.purpose==="other"?n.otherPurpose:n.purpose:delete s.purpose,delete s.otherPurpose;try{const h=new Date().toISOString();if(!navigator.onLine){await j.queueAction({type:"manual",payload:{...s,clientTimestamp:h}}),c("Queued manual log — will sync when online"),x("success");try{const u=(n.sid||"").trim(),w=(n.pinCode||"").trim();let b=null;if(u?b=await j.getStudentBySid(u):/^\d{6}$/.test(w)&&(b=await j.getStudentByPin(w)),b){const z=n.action==="check-out"?n.purpose==="other"?n.otherPurpose||"Other":n.purpose:"";ce({name:b.name,registrationNo:b.registrationNo,branch:b.branch,batchYear:b.batchYear,studentUid:b.sid,profilePhotoUrl:b.profilePhotoUrl,profilePhotoThumbUrl:b.profilePhotoThumbUrl});const R=m.find(bt=>bt.registrationNo===b.registrationNo);le({action:n.action,time:h,purpose:z,registrationNo:b.registrationNo,prevAction:(R==null?void 0:R.action)||"",prevTime:(R==null?void 0:R.timestamp)||""}),ee(!0),B(!1),Ae()}}catch{}S({pinCode:"",sid:"",action:"check-in",purpose:"fooding",otherPurpose:""});return}const o=await O.post("/security/manual",{...s,clientTimestamp:h}).catch(u=>(u==null?void 0:u.response)||{status:0,data:{message:u==null?void 0:u.message}});if(!o||o.status===0){await j.queueAction({type:"manual",payload:{...s,clientTimestamp:h}}),c("Queued manual log — will sync when online"),x("success"),S({pinCode:"",sid:"",action:"check-in",purpose:"fooding",otherPurpose:""});return}if(o&&o.status===403){oe(((a=o.data)==null?void 0:a.message)||"You are not security anymore."),I();return}if(o.status===404){const u=s.sid||"",w=s.pinCode||"";Me({reason:"Deleted/Banned ID",sid:u,pin:w}),te(!0),c("Log blocked: deleted/banned ID"),x("error"),I();return}if(o.status===400||o.status===429||o.status>=400){c(((i=o==null?void 0:o.data)==null?void 0:i.message)||"Failed to log"),x("error"),I();return}if((l=o==null?void 0:o.data)!=null&&l.student){const u=n.action==="check-out"?n.purpose==="other"?n.otherPurpose||"Other":n.purpose:"";ce(o.data.student);const w=m.find(b=>b.registrationNo===o.data.student.registrationNo);le({action:n.action,time:h,purpose:u,registrationNo:o.data.student.registrationNo,prevAction:(w==null?void 0:w.action)||"",prevTime:(w==null?void 0:w.timestamp)||""}),ee(!0),B(!1),Ae();try{await j.saveStudentBySid(o.data.student)}catch{}try{const b=(n.pinCode||"").trim();/^\d{6}$/.test(b)&&await j.saveStudentByPin(b,o.data.student)}catch{}}c(`Logged (${n.action})`),x("success"),S({pinCode:"",sid:"",action:"check-in",purpose:"fooding",otherPurpose:""}),await G()}catch(h){c(((g=(d=h==null?void 0:h.response)==null?void 0:d.data)==null?void 0:g.message)||"Failed to log"),x("error"),I()}},ht=async t=>{var d;t.preventDefault();const s=new Date().toISOString(),a=(d=N.purpose==="Other"?we:N.purpose)==null?void 0:d.trim();if(!a){c("Please select a purpose"),x("error");return}if(K&&(!C||C.length===0)){c("Please capture a photo"),x("error"),$(2500),_("default");return}if(!navigator.onLine){await j.queueAction({type:"visitor:create",payload:{...N,purpose:a,entryTime:s}}),W({name:"",vehicleNo:"",purpose:""}),H([]),be([]),je(""),c("Queued visitor (photo not saved offline) — will sync when online"),x("success"),$(2500),_("default");return}const i=new FormData;i.append("name",N.name),i.append("vehicleNo",N.vehicleNo),i.append("purpose",a),i.append("entryTime",s),Array.isArray(C)&&C.length&&C.slice(0,3).forEach(g=>{g&&i.append("photos",g)});const l=await O.post("/visitors",i,{headers:{"Content-Type":"multipart/form-data"}}).catch(g=>(g==null?void 0:g.response)||{status:0});!l||l.status===0||l.status>=400?(await j.queueAction({type:"visitor:create",payload:{...N,purpose:a,entryTime:s}}),c("Queued visitor (photo not saved) — will sync when online"),x("success"),$(2500),_("default")):(c("Visitor registered"),x("success"),$(5e3),_("fancy")),W({name:"",vehicleNo:"",purpose:""}),H([]),be([]),je("")};r.useEffect(()=>{const t=(Array.isArray(C)?C:[]).slice(0,3).map(s=>{try{return URL.createObjectURL(s)}catch{return""}}).filter(Boolean);return be(t),()=>{try{t.forEach(s=>URL.revokeObjectURL(s))}catch{}}},[C]);const pt=async()=>{var t;try{if(!((t=navigator.mediaDevices)!=null&&t.getUserMedia)){c("Camera not supported on this device"),x("error");return}const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});ye.current=s,Be(!0),requestAnimationFrame(()=>{J.current&&(J.current.srcObject=s,J.current.play().catch(()=>{}))})}catch{c("Failed to open camera"),x("error")}},Pe=()=>{try{const t=ye.current;if(t)for(const s of t.getTracks())s.stop()}catch{}ye.current=null,Be(!1)},xt=async()=>{try{const t=J.current;if(!t)return;const s=1024,a=t.videoWidth||640,i=t.videoHeight||480,l=Math.min(1,s/Math.max(a,i)),d=Math.round(a*l),g=Math.round(i*l),h=document.createElement("canvas");h.width=d,h.height=g,h.getContext("2d").drawImage(t,0,0,d,g);const u=await new Promise(z=>h.toBlob(z,"image/jpeg",.7));if(!u)return;const w=new File([u],"visitor.jpg",{type:"image/jpeg"});(Array.isArray(C)?C.length:0)>=3?(c("Maximum 3 photos allowed"),x("error"),$(2500),_("default")):H(z=>{const R=Array.isArray(z)?[...z]:[];return R.length>=3||R.push(w),R}),Pe(),c("Photo captured"),x("success")}catch{c("Failed to capture photo"),x("error")}},gt=t=>{var a;const s=Array.from(((a=t==null?void 0:t.target)==null?void 0:a.files)||[]).filter(Boolean);if(s.length){s.length>3&&(c("You can upload maximum 3 photos"),x("error"),$(2500),_("default")),H(s.slice(0,3));try{t.target.value=""}catch{}}},ft=t=>{H(s=>Array.isArray(s)?s.filter((a,i)=>i!==t):[])};r.useEffect(()=>{V!=="visitorEntry"&&K&&Pe()},[V]),r.useEffect(()=>{if(!X)return;const t=a=>{ve.current&&(ve.current.contains(a.target)||ne(!1))},s=a=>{a.key==="Escape"&&ne(!1)};return document.addEventListener("mousedown",t,!0),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",t,!0),document.removeEventListener("keydown",s)}},[X]);const Qe=async(t,s)=>{try{const a={type:s,from:f.from||void 0,to:f.to||void 0};s==="students"&&Q!=="all"&&(a.action=Q),await vt(`/api/export/${t}`,a,`${s}-logs.${t}`)}catch(a){c(a.message||"Export failed"),x("error")}},Ye=tt.useMemo(()=>{if(!Array.isArray(m))return[];const t=i=>new Date(i.timestamp||i.checkOutTime||i.checkInTime||i.createdAt||0).getTime(),s=[...m].sort((i,l)=>t(l)-t(i)),a=Q==="all"?s:s.filter(i=>i.action===Q);return M?a:a.slice(0,50)},[m,M,Q]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 md:p-6 space-y-6 pb-28 sm:pb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Security Dashboard"}),e.jsxs("div",{className:"relative",ref:Se,children:[e.jsxs("button",{type:"button",className:`inline-flex items-center gap-2 px-3 py-1 rounded-md ${se?"text-emerald-300 bg-emerald-400/10":"text-sky-200"} hover:text-white hover:bg-sky-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition`,onClick:()=>Ce(t=>!t),"aria-expanded":se,title:"Settings",children:[e.jsx(jt,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Settings"})]}),se&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded shadow-xl p-2 text-sm animate-scale-in bg-gray-900/95 text-gray-100 border border-white/10 z-50",children:[e.jsx("div",{className:"font-semibold mb-1 text-gray-200",children:"Feedback"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-800 rounded px-2 py-1",children:[e.jsx("input",{type:"radio",name:"haptics-mode",value:"both",checked:T==="both",onChange:()=>ue("both")})," Both (sound + vibration)"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-800 rounded px-2 py-1",children:[e.jsx("input",{type:"radio",name:"haptics-mode",value:"sound",checked:T==="sound",onChange:()=>ue("sound")})," Sound only"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-800 rounded px-2 py-1",children:[e.jsx("input",{type:"radio",name:"haptics-mode",value:"vibration",checked:T==="vibration",onChange:()=>ue("vibration")})," Vibration only"]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-800 rounded px-2 py-1",children:[e.jsx("input",{type:"radio",name:"haptics-mode",value:"off",checked:T==="off",onChange:()=>ue("off")})," Off"]})]})]})]})]}),!ke&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-amber-600/20 text-amber-200 px-3 py-1 text-xs border border-amber-400/30",children:[e.jsx("span",{className:"inline-block h-2 w-2 rounded-full bg-amber-400 animate-pulse"}),"Offline — showing cached data"]}),Z&&e.jsx("div",{className:"rounded border border-amber-200 bg-amber-50 text-amber-800 p-4",children:Z||"You are not security anymore."}),U&&!U.isApproved&&!U.requestedApproval&&e.jsxs("div",{className:"rounded border border-red-200 bg-red-50 text-red-800 p-4 flex items-start gap-3",children:[e.jsx("div",{className:"font-semibold",children:"Application was rejected"}),e.jsx("div",{className:"ml-auto",children:e.jsx("button",{className:"btn",onClick:async()=>{await O.post("/security/request-approval"),Ne({...U,requestedApproval:!0}),c("Request sent")},children:"Send request again"})})]}),U&&!U.isApproved&&U.requestedApproval&&e.jsx("div",{className:"rounded border border-blue-200 bg-blue-50 text-blue-800 p-3",children:"Application submitted — please wait for admin approval."}),L&&Re==="default"&&e.jsx("div",{role:"alert",className:`fixed top-4 right-4 z-50 shadow-lg rounded px-4 py-3 transition-opacity duration-300 ${y==="error"?"bg-red-600 text-white":"bg-green-600 text-white"}`,children:L}),L&&Re==="fancy"&&e.jsx("div",{className:"fixed inset-x-0 bottom-6 z-[9999] flex justify-center px-4",children:e.jsxs("div",{className:"relative inline-flex items-center gap-3 px-5 py-3 rounded-2xl border border-white/10 shadow-2xl bg-gradient-to-r from-emerald-500/20 via-teal-500/20 to-cyan-500/20 backdrop-blur-md text-white",children:[e.jsx("span",{className:"absolute -inset-2 -z-10 blur-2xl bg-gradient-to-r from-emerald-500/20 via-teal-500/20 to-cyan-500/20","aria-hidden":"true"}),e.jsx("svg",{className:"h-5 w-5 text-emerald-300",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M20 6L9 17l-5-5",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("span",{className:"font-semibold tracking-wide",children:L})]})}),D&&Le.createPortal(e.jsx("div",{className:"fixed inset-x-0 bottom-6 z-[10050] flex justify-center px-4 pointer-events-none",children:e.jsxs("div",{className:`relative inline-flex items-center gap-3 px-5 py-3 rounded-2xl border border-white/10 shadow-2xl backdrop-blur-md text-white pointer-events-auto ${D.action==="check-in"?"bg-gradient-to-r from-emerald-500/20 via-teal-500/20 to-cyan-500/20":"bg-gradient-to-r from-sky-500/20 via-violet-500/20 to-fuchsia-500/20"}`,children:[e.jsx("span",{className:"absolute -inset-2 -z-10 blur-2xl","aria-hidden":"true"}),D.action==="check-in"?e.jsx(pe,{className:"h-5 w-5 text-emerald-300"}):e.jsx(ge,{className:"h-5 w-5 text-fuchsia-300"}),e.jsxs("div",{className:"flex flex-col leading-tight",children:[e.jsx("span",{className:"font-semibold tracking-wide capitalize",children:D.queued?"Queued":D.action.replace("-"," ")}),e.jsxs("span",{className:"text-sm text-gray-200",children:[D.name||"Student",D.registrationNo?` • ${D.registrationNo}`:""]})]}),e.jsx("span",{className:"text-[11px] text-gray-300 ml-2",children:new Date(D.time).toLocaleTimeString()})]})}),document.body),!Z&&V==="students"&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Scan Student QR"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"text-sm mr-2 block",children:"Action"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>{$e("check-in"),B(!0)},"aria-pressed":v==="check-in",className:`relative inline-flex items-center gap-2 px-5 py-2.5 text-sm font-medium rounded-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-cyan-400/60 focus-visible:ring-offset-gray-900 group ${v==="check-in"?"text-white bg-gradient-to-r from-cyan-500 via-teal-500 to-emerald-500 shadow-sm border border-transparent":"text-cyan-300 bg-slate-800/40 hover:bg-slate-700/50 border border-cyan-500/30"} `,children:[v==="check-in"&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-white/10 group-hover:bg-white/15 transition","aria-hidden":"true"}),e.jsx(pe,{className:"relative h-4 w-4"}),e.jsx("span",{className:"relative tracking-wide",children:"Check In"})]}),e.jsxs("button",{type:"button",onClick:()=>{$e("check-out"),B(!0)},"aria-pressed":v==="check-out",className:`relative inline-flex items-center gap-2 px-5 py-2.5 text-sm font-medium rounded-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-violet-400/60 focus-visible:ring-offset-gray-900 group ${v==="check-out"?"text-white bg-gradient-to-r from-indigo-500 via-violet-500 to-fuchsia-500 shadow-sm border border-transparent":"text-violet-300 bg-slate-800/40 hover:bg-slate-700/50 border border-violet-500/30"} `,children:[v==="check-out"&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-white/10 group-hover:bg-white/15 transition","aria-hidden":"true"}),e.jsx(ge,{className:"relative h-4 w-4"}),e.jsx("span",{className:"relative tracking-wide",children:"Check Out"})]})]})]}),v==="check-out"&&e.jsx("div",{className:"mb-3",children:e.jsx(et,{label:"Purpose",value:F,onChange:st,otherValue:ie,onOtherChange:at,layout:"row"})}),Ie?e.jsxs("div",{className:"max-w-full sm:max-w-sm space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ct&&e.jsx(P,{color:ae?"amber":"indigo",size:"xs",variant:ae?"solid":"outline",onClick:async()=>{var t,s,a;try{const i=(s=(t=me.current)==null?void 0:t.getVideoTracks)==null?void 0:s.call(t)[0];if(!i)return;const l=(a=i.getCapabilities)==null?void 0:a.call(i);l&&"torch"in l&&(await i.applyConstraints({advanced:[{torch:!ae}]}),He(!ae))}catch{}},children:ae?"Torch: ON":"Torch: OFF"}),e.jsx(P,{color:"rose",size:"xs",variant:"outline",onClick:dt,children:"Camera Off"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Aim camera steady; the scanner auto-focuses."})]}),e.jsxs("div",{className:"relative inline-block rounded-xl overflow-hidden border border-white/10 bg-black/40",children:[e.jsx(wt,{width:360,height:270,videoConstraints:{facingMode:{ideal:"environment"},frameRate:{ideal:30,max:60},width:{ideal:1280},height:{ideal:720}},onUpdate:(t,s)=>{if(ze)return;const a=s==null?void 0:s.text;if(!a)return;const i=performance.now();Te.current.text===a&&i-Te.current.t<600||(Te.current={text:a,t:i},ut(a))},videoRef:t=>{var s,a;if(t)try{const i=t;ot.current=i;const l=i.srcObject;if(l){me.current=l;const d=(s=l.getVideoTracks)==null?void 0:s.call(l)[0];try{d.applyConstraints({advanced:[{focusMode:"continuous"}],width:{ideal:1280},height:{ideal:720},aspectRatio:{ideal:16/9},facingMode:{ideal:"environment"}}).catch(()=>{})}catch{}try{"torch"in(((a=d.getCapabilities)==null?void 0:a.call(d))||{})&&lt(!0)}catch{}}}catch{}}},Ie?"on":"off"),e.jsxs("div",{className:"pointer-events-none absolute inset-0 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"pulse-ring flex items-center justify-center text-cyan-300",children:e.jsx("span",{className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-cyan-400/70 bg-black/40",children:e.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-cyan-400 animate-pulse"})})}),e.jsx("div",{className:"mt-3 text-xs font-semibold tracking-[0.25em] uppercase text-cyan-50 drop-shadow-sm",children:"Scanning"})]})]})]}):e.jsx("div",{className:"text-sm text-gray-400",children:v?"Select the action again to start scanning.":"Select Check In or Check Out to start scanning."})]}),!Z&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"hidden sm:flex items-center gap-2 mb-3",role:"tablist","aria-label":"Security dashboard sections",children:[{key:"students",label:"Student Logs",icon:e.jsx(Ge,{className:"h-4 w-4"})},{key:"visitors",label:"Visitor Logs",icon:e.jsx(xe,{className:"h-4 w-4"})},{key:"manual",label:"Manual Entry",icon:e.jsx(We,{className:"h-4 w-4"})},{key:"visitorEntry",label:"Visitor Entry",icon:e.jsx(Ee,{className:"h-4 w-4"})}].map(t=>e.jsxs("button",{type:"button",role:"tab","aria-selected":V===t.key,onClick:()=>_e(t.key),className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition border focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 ${V===t.key?"bg-gradient-to-r from-cyan-500/20 to-violet-500/20 text-white border-cyan-400/40":"bg-slate-800/40 text-gray-300 border-white/10 hover:bg-slate-700/50"}`,children:[t.icon,t.label]},t.key))}),V==="manual"&&e.jsxs("div",{role:"tabpanel","aria-label":"Manual Entry",className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Manual Entry"}),e.jsxs("form",{className:"flex flex-col lg:flex-row gap-2 lg:items-end",onSubmit:mt,children:[e.jsx("input",{className:"input",placeholder:"QR sid (optional)",value:n.sid,onChange:t=>S({...n,sid:t.target.value})}),e.jsx("input",{className:"input",placeholder:"6-digit PIN (optional)",value:n.pinCode,onChange:t=>S({...n,pinCode:t.target.value})}),e.jsxs("div",{className:"flex flex-col min-w-[200px] lg:min-w-[230px]",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-400 mb-1 hidden lg:inline",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>S({...n,action:"check-in"}),"aria-pressed":n.action==="check-in",className:`relative inline-flex flex-1 items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-[13px] lg:text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-cyan-400/60 focus-visible:ring-offset-gray-900 transition-colors ${n.action==="check-in"?"text-white bg-gradient-to-r from-cyan-500 via-teal-500 to-emerald-500 border border-transparent shadow-sm":"text-cyan-300 bg-slate-800/40 hover:bg-slate-700/50 border border-cyan-500/30"} `,children:[n.action==="check-in"&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-white/10"}),e.jsx(pe,{className:"h-4 w-4 relative"}),e.jsx("span",{className:"relative",children:"Check In"})]}),e.jsxs("button",{type:"button",onClick:()=>S({...n,action:"check-out"}),"aria-pressed":n.action==="check-out",className:`relative inline-flex flex-1 items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-[13px] lg:text-sm font-medium focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-violet-400/60 focus-visible:ring-offset-gray-900 transition-colors ${n.action==="check-out"?"text-white bg-gradient-to-r from-indigo-500 via-violet-500 to-fuchsia-500 border border-transparent shadow-sm":"text-violet-300 bg-slate-800/40 hover:bg-slate-700/50 border border-violet-500/30"} `,children:[n.action==="check-out"&&e.jsx("span",{className:"absolute inset-0 rounded-lg bg-white/10"}),e.jsx(ge,{className:"h-4 w-4 relative"}),e.jsx("span",{className:"relative",children:"Check Out"})]})]})]}),n.action==="check-out"&&e.jsx("div",{className:"min-w-[260px]",children:e.jsx(et,{label:"Purpose",value:n.purpose,onChange:t=>S({...n,purpose:t}),otherValue:n.otherPurpose,onOtherChange:t=>S({...n,otherPurpose:t}),layout:"column"})}),e.jsx(P,{color:"teal",type:"submit",icon:e.jsx(pe,{className:"h-4 w-4"}),children:"Log"})]})]}),V==="visitorEntry"&&e.jsxs("div",{role:"tabpanel","aria-label":"Visitor Entry",className:"space-y-2",children:[e.jsx("div",{className:"font-semibold",children:"Visitor Registration"}),e.jsxs("form",{className:"grid grid-cols-1 md:grid-cols-5 gap-2",onSubmit:ht,children:[e.jsx("input",{className:"input",placeholder:"Name",value:N.name,onChange:t=>W({...N,name:t.target.value}),required:!0}),e.jsx("input",{className:"input",placeholder:"Vehicle No",value:N.vehicleNo,onChange:t=>W({...N,vehicleNo:t.target.value})}),e.jsxs("div",{className:"relative",ref:ve,children:[e.jsxs("button",{type:"button",className:`w-full inline-flex items-center justify-between gap-2 px-3 py-2 rounded-lg bg-slate-800/50 border border-white/10 text-sm ${N.purpose?"text-gray-100":"text-gray-400"} hover:bg-slate-700/50 focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50`,onClick:()=>ne(t=>!t),"aria-haspopup":"menu","aria-expanded":X,children:[e.jsxs("span",{className:"inline-flex items-center gap-2",children:[N.purpose==="Food Delivery"&&e.jsx(Oe,{className:"h-4 w-4"}),N.purpose==="Courier"&&e.jsx(Ke,{className:"h-4 w-4"}),N.purpose==="Guest"&&e.jsx(xe,{className:"h-4 w-4"}),N.purpose==="Other"&&e.jsx(Ve,{className:"h-4 w-4"}),e.jsx("span",{children:N.purpose==="Other"?we||"Other":N.purpose||"Purpose"})]}),e.jsx("svg",{className:`h-4 w-4 transition ${X?"rotate-180":""}`,viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"})})]}),X&&e.jsx("div",{role:"menu",className:"absolute z-50 mt-1 w-full rounded-lg bg-gray-900/95 border border-white/10 shadow-xl overflow-hidden",children:[{label:"Food Delivery",icon:Oe},{label:"Courier",icon:Ke},{label:"Guest",icon:xe},{label:"Other",icon:Ve}].map(t=>{const s=t.icon,a=N.purpose===t.label;return e.jsxs("button",{type:"button",role:"menuitemradio","aria-checked":a,className:`w-full text-left px-3 py-2 text-sm inline-flex items-center gap-2 hover:bg-white/10 ${a?"bg-white/5 text-white":"text-gray-200"}`,onClick:()=>{W({...N,purpose:t.label}),ne(!1)},children:[e.jsx(s,{className:"h-4 w-4"}),e.jsx("span",{children:t.label})]},t.label)})})]}),N.purpose==="Other"&&e.jsx("input",{className:"input md:col-span-2",placeholder:"Type custom purpose",value:we,onChange:t=>je(t.target.value)}),e.jsx("div",{className:"flex items-center gap-2",children:K?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{color:"amber",type:"button",onClick:xt,children:"Capture"}),e.jsx(P,{color:"rose",type:"button",variant:"outline",onClick:Pe,children:"Close"})]}):e.jsx(P,{color:"teal",type:"button",onClick:pt,icon:e.jsx(Nt,{className:"h-4 w-4"}),children:"Open Camera"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"visitor-photos",type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:gt}),e.jsx(P,{color:"indigo",type:"button",variant:"outline",className:"w-full justify-center",onClick:()=>{var t;try{(t=document.getElementById("visitor-photos"))==null||t.click()}catch{}},children:"Upload Photos (max 3)"})]}),!K||Array.isArray(C)&&C.length>0?e.jsx(P,{color:"teal",type:"submit",icon:e.jsx(Ee,{className:"h-4 w-4"}),children:"Add Visitor"}):e.jsx("div",{className:"text-xs text-gray-400 self-center",children:"Capture a photo to enable"}),Array.isArray(re)&&re.length>0&&e.jsxs("div",{className:"col-span-1 md:col-span-5 flex flex-wrap items-start gap-3",children:[re.map((t,s)=>e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("img",{src:t,alt:`Visitor preview ${s+1}`,className:"h-24 w-24 rounded-lg border border-white/10 object-cover"}),e.jsxs("div",{className:"text-[11px] text-gray-400",children:["~",C!=null&&C[s]?Math.ceil(C[s].size/1024):"?"," KB"]}),e.jsx("button",{type:"button",className:"text-[11px] px-2 py-1 rounded bg-slate-800/60 border border-white/10 text-gray-200 hover:bg-slate-700/60",onClick:()=>ft(s),children:"Remove"})]},t)),e.jsxs("div",{className:"flex-1 min-w-[180px]",children:[e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Selected ",re.length,"/3 photos"]}),e.jsx("div",{className:"mt-2",children:e.jsx(P,{color:"rose",type:"button",variant:"outline",onClick:()=>H([]),children:"Clear Photos"})})]})]})]}),K&&e.jsx("div",{className:"mt-2",children:e.jsx("video",{ref:J,className:"w-full max-w-xs rounded-lg border border-white/10",playsInline:!0,muted:!0})}),e.jsx(Pt,{limit:3})]}),V==="students"&&e.jsxs("div",{role:"tabpanel","aria-label":"Student Logs",className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"From"}),e.jsx("input",{type:"datetime-local",className:"input",value:f.from,onChange:t=>A({...f,from:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm",children:"To"}),e.jsx("input",{type:"datetime-local",className:"input",value:f.to,onChange:t=>A({...f,to:t.target.value})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(P,{color:"teal",onClick:G,title:"Filter logs",icon:e.jsx(kt,{className:"h-4 w-4"}),children:"Filter"}),e.jsx(P,{color:"amber",variant:"outline",onClick:()=>G(),title:"Refresh now",icon:e.jsx(St,{className:"h-4 w-4"}),children:"Refresh"}),e.jsx(P,{color:"indigo",onClick:()=>Qe("pdf","students"),icon:e.jsx(Je,{className:"h-4 w-4"}),children:"PDF"}),e.jsx(P,{color:"indigo",variant:"outline",onClick:()=>Qe("docx","students"),icon:e.jsx(Je,{className:"h-4 w-4"}),children:"DOCX"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Show:"}),[{key:"all",label:"All"},{key:"check-in",label:"Check In"},{key:"check-out",label:"Check Out"}].map(t=>e.jsx("button",{type:"button",onClick:()=>rt(t.key),className:`px-3 py-1.5 rounded-full text-xs font-medium border transition ${Q===t.key?"bg-cyan-500/80 border-cyan-300 text-white shadow-sm":"bg-slate-800/60 border-white/10 text-gray-300 hover:bg-slate-700/70"}`,children:t.label},t.key))]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mt-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:Ye.length}),m.length>50&&!M&&e.jsxs(e.Fragment,{children:[" of ",e.jsx("span",{className:"font-medium",children:m.length})]}),m.length>50&&!M&&e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest"}),M&&m.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),m.length>50&&e.jsxs("div",{className:"flex gap-2",children:[!M&&e.jsxs("button",{type:"button",onClick:()=>Ue(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",m.length-50]})]}),M&&e.jsx("button",{type:"button",onClick:()=>Ue(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"})]})]}),e.jsx(De,{maxHeight:"60vh",columns:[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"action",title:"Action"},{key:"purpose",title:"Purpose"},{key:"checkInTime",title:"Check-in",render:t=>t?new Date(t).toLocaleString():"-"},{key:"checkOutTime",title:"Check-out",render:t=>t?new Date(t).toLocaleString():"-"}],data:Ye})]}),V==="visitors"&&e.jsx("div",{role:"tabpanel","aria-label":"Visitor Logs",className:"overflow-auto",children:e.jsx(Lt,{})})]}),!Z&&e.jsx("div",{className:"sm:hidden fixed bottom-0 inset-x-0 z-40 bg-gray-900/85 backdrop-blur-md border-t border-white/10 shadow-[0_-8px_16px_rgba(0,0,0,0.35)]",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:e.jsx("div",{className:"grid grid-cols-4 h-16",children:[{key:"students",label:"Students",icon:e.jsx(Ge,{className:"h-5 w-5"})},{key:"visitors",label:"Visitors",icon:e.jsx(xe,{className:"h-5 w-5"})},{key:"manual",label:"Manual",icon:e.jsx(We,{className:"h-5 w-5"})},{key:"visitorEntry",label:"Add Visitor",icon:e.jsx(Ee,{className:"h-5 w-5"})}].map(t=>e.jsxs("button",{type:"button","aria-label":t.label,onClick:()=>_e(t.key),className:`relative flex flex-col items-center justify-center gap-1 h-16 text-sm font-medium ${V===t.key?"text-white":"text-gray-300"} focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50`,children:[e.jsx("span",{className:`absolute inset-x-8 top-0 h-1 rounded-full ${V===t.key?"bg-gradient-to-r from-cyan-400 to-violet-400":"bg-transparent"}`}),t.icon,e.jsx("span",{children:t.label})]},t.key))})})]}),ze&&q&&Le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm animate-fade-in"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative w-[88vw] max-w-xl rounded-2xl shadow-2xl border border-white/10 bg-gray-900/95 text-gray-100 animate-scale-in overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsxs("button",{type:"button",onClick:()=>{ee(!1),B(!1)},"aria-label":"Close",className:"group absolute top-2 right-2",children:[e.jsx("span",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-emerald-500/40 to-sky-500/40 blur-md opacity-0 group-hover:opacity-100 transition"}),e.jsx("span",{className:"relative inline-flex h-10 w-10 items-center justify-center rounded-full bg-gray-900/90 text-white border border-white/10 shadow-lg ring-1 ring-white/10 hover:scale-105 transition",children:e.jsx(Xe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-0",children:[e.jsx("div",{className:"p-3 sm:p-4 flex items-center justify-center bg-gray-800/60",children:e.jsx("img",{src:q.profilePhotoUrl||q.profilePhotoThumbUrl||"https://placehold.co/512x512?text=No+Photo",alt:"Student",className:"w-full max-w-[360px] aspect-square object-cover rounded-xl border border-white/10",loading:"eager",decoding:"async"})}),e.jsxs("div",{className:"p-3 sm:p-4 space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"text-lg font-semibold",children:"Student Details"}),(p==null?void 0:p.action)&&e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs ${p.action==="check-in"?"bg-emerald-500/15 text-emerald-300 border border-emerald-400/20":"bg-sky-500/15 text-sky-300 border border-sky-400/20"}`,children:p.action==="check-in"?"Checked in":"Checked out"})]}),(p==null?void 0:p.time)&&e.jsx("div",{className:"text-[12px] text-gray-400 -mt-1",children:new Date(p.time).toLocaleString()}),(p==null?void 0:p.purpose)&&e.jsxs("div",{className:"text-[12px] text-gray-300",children:["Purpose: ",e.jsx("span",{className:"font-medium",children:p.purpose})]}),e.jsxs("div",{className:"text-[12px] text-gray-300",children:["Current status: ",e.jsx("span",{className:"font-medium",children:p.action==="check-in"?"Inside campus":"Outside campus"})]}),(p==null?void 0:p.action)==="check-out"&&(p==null?void 0:p.prevAction)==="check-out"&&e.jsx("div",{className:"mt-1 text-[12px] text-amber-200 bg-amber-500/10 border border-amber-400/40 rounded px-2 py-1",children:"Warning: This student was checked out twice in a row without a check in between. Please verify."}),(p==null?void 0:p.action)==="check-in"&&(p==null?void 0:p.prevAction)==="check-in"&&e.jsx("div",{className:"mt-1 text-[12px] text-amber-200 bg-amber-500/10 border border-amber-400/40 rounded px-2 py-1",children:"Warning: This student was checked in twice in a row without a check out in between. Please verify."}),(p==null?void 0:p.prevAction)&&(p==null?void 0:p.prevTime)&&e.jsxs("div",{className:"text-[12px] text-gray-400",children:["Previous: ",p.prevAction," at ",new Date(p.prevTime).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Name:"})," ",e.jsx("span",{className:"font-medium",children:q.name||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Reg No:"})," ",e.jsx("span",{className:"font-medium",children:q.registrationNo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Branch:"})," ",e.jsx("span",{className:"font-medium",children:q.branch||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Batch:"})," ",e.jsx("span",{className:"font-medium",children:q.batchYear||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"SID:"})," ",e.jsx("span",{className:"font-medium",children:q.studentUid||"-"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"button",className:"inline-flex items-center gap-2 rounded-md bg-gray-700/60 px-3 py-1.5 text-xs text-gray-100 border border-white/10 hover:bg-gray-700/80",onClick:()=>it(t=>!t),children:Fe?"Hide history":"View recent history"})}),Fe&&e.jsx("div",{className:"mt-2 max-h-48 overflow-auto border border-white/10 rounded",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-800/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-2 py-1",children:"Action"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Purpose"}),e.jsx("th",{className:"text-left px-2 py-1",children:"Time"})]})}),e.jsx("tbody",{children:m.filter(t=>t.registrationNo===p.registrationNo).slice(0,8).map(t=>{const s=t.timestamp||t.checkInTime||t.checkOutTime;return e.jsxs("tr",{className:"border-t border-white/10",children:[e.jsx("td",{className:"px-2 py-1 capitalize",children:t.action}),e.jsx("td",{className:"px-2 py-1",children:t.purpose||"-"}),e.jsx("td",{className:"px-2 py-1",children:s?new Date(s).toLocaleString():"-"})]},t._id)})})]})})]})]})]})})]}),document.body),nt&&Le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm animate-fade-in",onClick:()=>te(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative w-[88vw] max-w-md rounded-2xl shadow-2xl border border-rose-400/30 bg-gray-900/95 text-gray-100 animate-scale-in overflow-hidden",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{type:"button",onClick:()=>te(!1),"aria-label":"Close",className:"group absolute top-2 right-2",children:e.jsx("span",{className:"relative inline-flex h-10 w-10 items-center justify-center rounded-full bg-gray-900/90 text-white border border-white/10 shadow-lg ring-1 ring-white/10 hover:scale-105 transition",children:e.jsx(Xe,{className:"h-5 w-5"})})}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-rose-300",children:[e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.5a.75.75 0 00-1.5 0v5a.75.75 0 001.5 0v-5zM10 14.5a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),e.jsx("div",{className:"text-lg font-semibold",children:"Deleted/Banned ID"})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-300",children:"This QR/PIN is not valid. The student may have been deleted or is not approved."}),(Y.sid||Y.pin)&&e.jsxs("div",{className:"mt-3 text-sm",children:[Y.sid&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"SID:"})," ",e.jsx("span",{className:"font-mono",children:Y.sid})]}),Y.pin&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"PIN:"})," ",e.jsx("span",{className:"font-mono",children:Y.pin})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>te(!1),className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-rose-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400/50",children:"Close"})})]})]})})]}),document.body)]})}function fe(m){if(!Array.isArray(m))return[];const k=f=>new Date(f.exitTime||f.entryTime||f.createdAt||0).getTime();return[...m].sort((f,A)=>k(A)-k(f))}function Pt({limit:m=3}){const[k,f]=r.useState([]),A=async()=>{try{const n=await O.get("/visitors"),S=fe(n.data);f(S.slice(0,m))}catch{const n=await j.loadVisitors().catch(()=>[]),S=fe(n);f(S.slice(0,m))}};return r.useEffect(()=>{A()},[]),r.useEffect(()=>{const n=()=>setTimeout(()=>{A().catch(()=>{})},600);return window.addEventListener("online",n),window.addEventListener("refresh-visitors",n),()=>{window.removeEventListener("online",n),window.removeEventListener("refresh-visitors",n)}},[]),k.length?e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-sm text-gray-200",children:"Recent Visitors"}),e.jsxs("div",{className:"text-[11px] text-gray-400",children:["Last ",Math.min(m,k.length)," entries"]})]}),e.jsx(De,{maxHeight:"26vh",columns:[{key:"name",title:"Name"},{key:"vehicleNo",title:"Vehicle"},{key:"purpose",title:"Purpose"},{key:"entryTime",title:"Entry",render:n=>n?new Date(n).toLocaleTimeString():"-"}],data:k})]}):null}function Lt(){const[m,k]=r.useState([]),[f,A]=r.useState(!1),n=async()=>{try{const c=await O.get("/visitors"),y=fe(c.data).slice(0,200);k(y),j.saveVisitors(y).catch(()=>{})}catch{const c=await j.loadVisitors().catch(()=>[]);if(c.length){const y=fe(c);k(y.slice(0,200))}else k([])}};r.useEffect(()=>{n()},[]),r.useEffect(()=>{const c=()=>setTimeout(()=>{n().catch(()=>{})},600);return window.addEventListener("online",c),window.addEventListener("refresh-visitors",c),()=>{window.removeEventListener("online",c),window.removeEventListener("refresh-visitors",c)}},[]);const S=async c=>{const y=new Date().toISOString();if(!navigator.onLine){await j.queueAction({type:"visitor:exit",payload:{id:c,exitTime:y}}),k(x=>x.map(E=>E._id===c?{...E,exitTime:y}:E));return}await O.patch(`/visitors/${c}/exit`,{exitTime:y});try{await n()}catch{}},L=tt.useMemo(()=>f?m:m.slice(0,50),[m,f]);return e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Visitor Logs"}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"text-xs sm:text-sm text-gray-400",children:["Showing ",e.jsx("span",{className:"font-medium text-gray-200",children:L.length}),m.length>50&&!f&&e.jsxs(e.Fragment,{children:[" of ",e.jsx("span",{className:"font-medium",children:m.length})]}),m.length===200&&e.jsx("span",{className:"ml-1 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-slate-700/60 border border-white/10",children:"Latest 200"}),f&&m.length>50&&e.jsx("span",{className:"ml-2 text-[10px] uppercase tracking-wider px-2 py-0.5 rounded-full bg-gradient-to-r from-cyan-500/20 to-violet-500/20 border border-cyan-400/30 text-cyan-200",children:"All"})]}),m.length>50&&e.jsxs("div",{className:"flex gap-2",children:[!f&&e.jsxs("button",{type:"button",onClick:()=>A(!0),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-cyan-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-cyan-400/50 group overflow-hidden",children:[e.jsx("span",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 bg-gradient-to-r from-cyan-500/10 via-teal-500/10 to-violet-500/10 transition"}),"Show More",e.jsxs("span",{className:"text-[11px] px-1.5 py-0.5 rounded bg-cyan-500/20 border border-cyan-400/30 text-cyan-200",children:["+",m.length-50]})]}),f&&e.jsx("button",{type:"button",onClick:()=>A(!1),className:"relative inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-xs sm:text-sm font-medium bg-slate-800/60 hover:bg-slate-700/70 border border-white/10 text-violet-300 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-violet-400/50",children:"Show Less"})]})]}),e.jsx(De,{maxHeight:"50vh",columns:[{key:"name",title:"Name"},{key:"vehicleNo",title:"Vehicle"},{key:"purpose",title:"Purpose"},{key:"entryTime",title:"Entry",render:c=>new Date(c).toLocaleString()},{key:"exitTime",title:"Exit",render:(c,y)=>y.exitTime?new Date(y.exitTime).toLocaleString():e.jsx(P,{size:"xs",color:"rose",onClick:()=>S(y._id),icon:e.jsx(ge,{className:"h-3 w-3"}),children:"Mark Exit"})}],data:L})]})}function et({label:m="Purpose",value:k,onChange:f,otherValue:A,onOtherChange:n,layout:S="row"}){const L=[{key:"fooding",label:"Fooding",color:"emerald",icon:Oe,description:"Meal outside campus"},{key:"marketing",label:"Marketing",color:"sky",icon:Ct,description:"Purchase / market visit"},{key:"medicine",label:"Medicine",color:"rose",icon:Tt,description:"Medical / pharmacy"},{key:"home",label:"Home",color:"amber",icon:At,description:"Going home"},{key:"other",label:"Other",color:"violet",icon:Ve,description:"Custom reason"}],c={emerald:{base:"bg-emerald-600/15 text-emerald-300 border-emerald-500/30 hover:bg-emerald-600/25",active:"bg-emerald-500/90 text-white shadow-inner border-emerald-300/60"},sky:{base:"bg-sky-600/15 text-sky-300 border-sky-500/30 hover:bg-sky-600/25",active:"bg-sky-500/90 text-white shadow-inner border-sky-300/60"},rose:{base:"bg-rose-600/15 text-rose-300 border-rose-500/30 hover:bg-rose-600/25",active:"bg-rose-500/90 text-white shadow-inner border-rose-300/60"},amber:{base:"bg-amber-600/15 text-amber-300 border-amber-500/30 hover:bg-amber-600/25",active:"bg-amber-500/90 text-white shadow-inner border-amber-300/60"},violet:{base:"bg-violet-600/15 text-violet-300 border-violet-500/30 hover:bg-violet-600/25",active:"bg-violet-500/90 text-white shadow-inner border-violet-300/60"}};return e.jsxs("div",{children:[m&&e.jsx("div",{className:"text-xs uppercase tracking-wide text-gray-400 mb-1",children:m}),e.jsx("div",{className:`flex ${S==="row"?"flex-row flex-wrap gap-2":"flex-col gap-2"} max-w-xl`,role:"radiogroup","aria-label":m,children:L.map(y=>{const x=y.icon,E=k===y.key,$=c[y.color];return e.jsxs("button",{type:"button",role:"radio","aria-checked":E,onClick:()=>f(y.key),className:`group relative px-3 py-2 rounded-lg border text-[12px] font-medium flex items-center gap-2 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/40 transition ${E?$.active:$.base}`,title:y.description,children:[E&&e.jsx("span",{className:"absolute inset-0 animate-pulse bg-white/10 rounded-lg pointer-events-none"}),e.jsx(x,{className:`h-4 w-4 ${E?"opacity-100":"opacity-70 group-hover:opacity-90"}`}),e.jsx("span",{children:y.label})]},y.key)})}),k==="other"&&e.jsx("input",{className:"input mt-2",placeholder:"Type custom purpose",value:A,onChange:y=>n(y.target.value)})]})}export{It as default};
