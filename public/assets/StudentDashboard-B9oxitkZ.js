const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StudentCharts-BQR0uM6b.js","assets/index-CA6zgANG.js","assets/index-BBfffh5Y.css"])))=>i.map(i=>d[i]);
import{r as n,a as G,j as e,c as E,b as S,X as R,_ as T}from"./index-CA6zgANG.js";import{o as j}from"./offline-CafmH5fM.js";function X(s=[]){const l={},r=new Date;r.setHours(0,0,0,0);for(let a=6;a>=0;a--){const c=new Date(r.getTime()-a*864e5).toISOString().slice(0,10);l[c]={date:c.slice(5),in:0,out:0}}for(const a of s){const o=new Date(a.timestamp||a.checkInTime||a.checkOutTime);if(isNaN(o))continue;const c=o.toISOString().slice(0,10);l[c]&&(a.action==="check-in"&&l[c].in++,a.action==="check-out"&&l[c].out++)}return Object.values(l)}function J(s=[]){const l=Date.now()-2592e6,r={};for(const a of s){const o=new Date(a.timestamp||a.checkInTime||a.checkOutTime).getTime();if(isNaN(o)||o<l)continue;const c=(a.purpose||"Other").trim()||"Other";r[c]=(r[c]||0)+1}return Object.entries(r).map(([a,o])=>({name:a,value:o}))}function ee(s=[]){const l=Date.now()-12096e5,r=Array.from({length:24},(a,o)=>({hour:o,count:0}));for(const a of s){const o=new Date(a.timestamp||a.checkInTime||a.checkOutTime),c=o.getTime();isNaN(c)||c<l||r[o.getHours()].count++}return r}function te(s=[]){const l=new Set;for(const m of s){const h=new Date(m.timestamp||m.checkInTime||m.checkOutTime);if(isNaN(h))continue;const u=h.toISOString().slice(0,10);l.add(u)}let r=0;const a=new Date;a.setHours(0,0,0,0);for(let m=0;;m++){const u=new Date(a.getTime()-m*864e5).toISOString().slice(0,10);if(l.has(u))r++;else break}const o=new Date(a);o.setDate(a.getDate()-a.getDay());const c=new Date(a.getFullYear(),a.getMonth(),1);let w=0,g=0;for(const m of s){const h=new Date(m.timestamp||m.checkInTime||m.checkOutTime);isNaN(h)||(h>=o&&w++,h>=c&&g++)}return{streak:r,week:w,month:g}}const se=n.lazy(()=>T(()=>import("./StudentCharts-BQR0uM6b.js"),__vite__mapDeps([0,1,2])).then(s=>({default:s.WeeklyActivityChart}))),ae=n.lazy(()=>T(()=>import("./StudentCharts-BQR0uM6b.js"),__vite__mapDeps([0,1,2])).then(s=>({default:s.PurposeDonut}))),re=n.lazy(()=>T(()=>import("./StudentCharts-BQR0uM6b.js"),__vite__mapDeps([0,1,2])).then(s=>({default:s.HourlyDensityArea})));function me(){const[s,l]=n.useState(null),[r,a]=n.useState([]),[o,c]=n.useState(null),[w,g]=n.useState(!1),[m,h]=n.useState(Date.now()),[u,q]=n.useState(""),[k,z]=n.useState("all"),[p,v]=n.useState(!1),[f,y]=n.useState(!1),{user:ie}=G();n.useEffect(()=>{(async()=>{try{const{data:i}=await S.get("/students/me");l(i),j.saveStudentProfile(i).catch(()=>{})}catch{const d=await j.loadStudentProfile().catch(()=>null);d&&l(d)}})()},[]),n.useEffect(()=>{if(p||f){const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[p,f]),n.useEffect(()=>{const t=i=>{i.key==="Escape"&&(p&&v(!1),f&&y(!1))};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[p,f]);const N=async()=>{try{g(!0);const t=(await S.get("/students/logs")).data;a(t),c(new Date),j.saveStudentLogs(t).catch(()=>{})}catch{const i=await j.loadStudentLogs().catch(()=>[]);i.length?a(i):a([])}finally{g(!1)}};n.useEffect(()=>{N();const t=()=>N();window.addEventListener("focus",t);const i=setInterval(N,3e4),d=setInterval(()=>h(Date.now()),3e4);return()=>{window.removeEventListener("focus",t),clearInterval(i),clearInterval(d)}},[]);const A=t=>{if(!t)return"";const i=Math.max(0,Math.floor((Date.now()-new Date(t).getTime())/1e3));if(i<60)return`${i}s ago`;const d=Math.floor(i/60);if(d<60)return`${d}m ago`;const b=Math.floor(d/60);return b<24?`${b}h ago`:`${Math.floor(b/24)}d ago`},O=["Small steps done consistently create big change.","Progress beats perfection—show up and move forward.","Discipline turns goals into daily habits.","Your future self is built by today’s choices.","Momentum starts when excuses stop.","Dream big, act small, repeat daily.","Growth lives just beyond your comfort zone.","You don’t need more time, just more focus.","The best way to begin is to begin.","Every effort compounds—keep going.","Consistency is a superpower—use it.","Win the day; the week will follow.","Your pace is enough if you persist.","Direction matters more than speed.","Tiny improvements beat sudden bursts.","Make it a habit, not a hurdle."],P=["Faizan","Faizan","Faizan","Faizan"],D=new Date,Z=`${D.getFullYear()}-${D.getMonth()+1}-${D.getDate()}`,L=(t=>{let i=0;for(let d=0;d<t.length;d++)i=i*31+t.charCodeAt(d)|0;return Math.abs(i)})(Z),F=O[L%O.length],H=P[(L*7+3)%P.length];if(!s)return e.jsx("div",{className:"p-6",children:"Loading..."});const x=r&&r.length?r[0]:null,I=x?x.timestamp||x.checkInTime||x.checkOutTime:null,M=(x==null?void 0:x.action)==="check-in",V=x?M?"Inside campus":"Outside campus":"No activity yet",Y=x?M?"bg-emerald-500/15 text-emerald-700 dark:text-emerald-300 border border-emerald-400/20":"bg-sky-500/15 text-sky-700 dark:text-sky-300 border border-sky-400/20":"bg-gray-500/15 text-gray-700 dark:text-gray-300 border border-gray-400/20",U=r.filter(t=>t.action==="check-in").length,$=r.filter(t=>t.action==="check-out").length,B=!s.isApproved&&s.requestedApproval?1:0,_=r.filter(t=>{const i=k==="all"||t.action===k,d=u.trim().toLowerCase(),b=!d||t.action&&t.action.toLowerCase().includes(d)||t.purpose&&t.purpose.toLowerCase().includes(d);return i&&b}),Q=X(r),W=J(r),K=ee(r),C=te(r);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative min-h-screen overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 -z-10 bg-gradient-to-br from-indigo-600 via-sky-500 to-emerald-500 animate-gradient"}),e.jsx("div",{className:"blob absolute bottom-10 right-6 w-72 h-72 bg-cyan-400/40 rounded-full",style:{animationDelay:"2s"}}),e.jsx("div",{className:"blob absolute top-1/3 left-1/2 w-64 h-64 bg-amber-400/40 rounded-full",style:{animationDelay:"4s"}}),e.jsxs("div",{className:"p-4 md:p-6 max-w-5xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{type:"button",onClick:()=>s.profilePhotoUrl&&v(!0),className:"relative group","aria-label":"View profile photo",title:"Click to view",children:[e.jsx("img",{src:s.profilePhotoUrl||"https://placehold.co/128x128?text=Avatar",alt:"Profile",className:"w-20 h-20 rounded-full object-cover border border-white/50 shadow cursor-zoom-in group-hover:scale-[1.02] transition-transform"}),s.profilePhotoUrl&&e.jsx("span",{className:"pointer-events-none absolute -bottom-2 left-1/2 -translate-x-1/2 text-[10px] text-white/80 bg-black/40 px-2 py-0.5 rounded opacity-0 group-hover:opacity-100 transition-opacity",children:"Click to zoom"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("div",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:s.name||"Student"}),e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs ${Y}`,children:V}),I&&e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["• ",A(I)]})]}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:s.registrationNo})]})]}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Student Dashboard"}),!s.isApproved&&!s.requestedApproval&&e.jsxs("div",{className:"rounded border border-red-200 bg-red-50 text-red-800 p-4 flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6 mt-0.5",children:e.jsx("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm.75 6a.75.75 0 0 0-1.5 0v5.25a.75.75 0 0 0 1.5 0V8.25Zm-1.5 7.5a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5h-1.5Z",clipRule:"evenodd"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:"Application was rejected"}),e.jsx("div",{className:"text-sm mb-2",children:"Your application was rejected by an admin. You can send the request again."}),e.jsx("button",{className:"btn",onClick:async()=>{await S.post("/students/request-approval"),l({...s,requestedApproval:!0})},children:"Send request again"})]})]}),!s.isApproved&&s.requestedApproval&&e.jsxs("div",{className:"rounded border border-blue-200 bg-blue-50 text-blue-800 p-4 flex items-start gap-3",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-6 h-6 mt-0.5",children:e.jsx("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm9.75-6a.75.75 0 0 0-.75.75v6a.75.75 0 0 0 1.5 0v-6a.75.75 0 0 0-.75-.75Zm0 12a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z",clipRule:"evenodd"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Application submitted"}),e.jsx("div",{className:"text-sm",children:"Your application has been sent to the admin. Please wait for approval. You’ll get your QR and PIN once approved."})]})]}),e.jsxs("div",{className:"card student-glass border border-white/30 dark:border-white/10 mt-4",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsxs("div",{children:["Registration: ",s.registrationNo]}),e.jsxs("div",{children:["Branch: ",s.branch]}),e.jsxs("div",{children:["Batch Year: ",s.batchYear]}),e.jsxs("div",{className:"mt-2 text-sm",children:["6-digit PIN (fallback): ",e.jsx("span",{className:"font-mono text-lg",children:s.pinCode||"-"})]})]}),s.qrCodeDataUrl&&e.jsxs("div",{className:"card student-glass border border-white/30 dark:border-white/10 mt-4",children:[e.jsx("div",{className:"font-semibold mb-2",children:"Your QR Code"}),e.jsx("button",{type:"button",onClick:()=>y(!0),className:"inline-block group","aria-label":"View QR code",title:"Click to view",children:e.jsx("img",{alt:"qr",className:"w-40 h-40 sm:w-48 sm:h-48 cursor-zoom-in group-hover:scale-[1.02] transition-transform",src:s.qrCodeDataUrl})}),e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:"Show this to security for check-in/out"})]}),e.jsxs("div",{className:"card student-glass border border-white/30 dark:border-white/10 mt-4",children:[e.jsx("div",{className:"flex items-center justify-end mt-8",children:e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:o?`Last updated: ${A(o)}`:"Loading..."})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"card student-glass flex flex-col items-center text-center py-6 shadow-lg transition-transform hover:scale-105",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600 animate-bounce",children:U}),e.jsx("div",{className:"mt-1 text-sm text-gray-700 dark:text-gray-200",children:"Total Check-ins"})]}),e.jsxs("div",{className:"card student-glass flex flex-col items-center text-center py-6 shadow-lg transition-transform hover:scale-105",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 animate-pulse",children:$}),e.jsx("div",{className:"mt-1 text-sm text-gray-700 dark:text-gray-200",children:"Total Check-outs"})]}),e.jsxs("div",{className:"card student-glass flex flex-col items-center text-center py-6 shadow-lg transition-transform hover:scale-105",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-500",children:B}),e.jsx("div",{className:"mt-1 text-sm text-gray-700 dark:text-gray-200",children:"Pending Requests"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{className:"card student-glass flex items-center justify-between py-4 px-5 border border-white/30 dark:border-white/10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Streak"}),e.jsxs("div",{className:"text-2xl font-semibold text-emerald-500",children:[C.streak||0," days"]})]}),e.jsx("svg",{className:"h-8 w-8 text-emerald-400",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M13 2.05v3.02a7.001 7.001 0 0 1 6 6.92h3.02A10.002 10.002 0 0 0 13 2.05ZM11 2.05C6.05 2.56 2 6.92 2 12a10 10 0 0 0 19 4.9l-2.6-1.5A7 7 0 1 1 11 2.05Z"})})]}),e.jsxs("div",{className:"card student-glass flex items-center justify-between py-4 px-5 border border-white/30 dark:border-white/10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"This week"}),e.jsx("div",{className:"text-2xl font-semibold text-sky-500",children:C.week||0})]}),e.jsx("svg",{className:"h-8 w-8 text-sky-400",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 4H5a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h14a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3Zm-8 10H7v-2h4v2Zm6-4H7V8h10v2Z"})})]}),e.jsxs("div",{className:"card student-glass flex items-center justify-between py-4 px-5 border border-white/30 dark:border-white/10",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:"This month"}),e.jsx("div",{className:"text-2xl font-semibold text-amber-500",children:C.month||0})]}),e.jsx("svg",{className:"h-8 w-8 text-amber-400",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M7 4V2h2v2h6V2h2v2h4v2H3V4h4Zm14 4v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8h18ZM7 12h5v5H7v-5Z"})})]})]}),e.jsx(n.Suspense,{fallback:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx("div",{className:"card h-48 animate-pulse bg-white/40 dark:bg-gray-800/40"}),e.jsx("div",{className:"card h-48 animate-pulse bg-white/40 dark:bg-gray-800/40"})]}),children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(se,{data:Q}),e.jsx(ae,{data:W})]})}),e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"card h-48 mt-4 animate-pulse bg-white/40 dark:bg-gray-800/40"}),children:e.jsx("div",{className:"mt-4",children:e.jsx(re,{data:K})})}),e.jsxs("div",{className:"card student-glass flex items-center gap-4 p-4 shadow-md border-l-4 border-blue-400 mt-4",children:[e.jsx("svg",{className:"w-8 h-8 text-blue-400",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h.01M15 12h.01M7.5 19a9 9 0 1111 0H7.5z"})}),e.jsxs("div",{className:"text-gray-700 dark:text-gray-200 italic flex-1",children:["“",F,"” ",e.jsxs("span",{className:"not-italic text-sm text-gray-600 dark:text-gray-300",children:["— ",H]})]})]}),e.jsx("div",{className:"font-semibold mb-2",children:"Recent Activity"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-3",children:[e.jsx("input",{type:"text",value:u,onChange:t=>q(t.target.value),placeholder:"Search purpose or action...",className:"input sm:flex-1","aria-label":"Search logs"}),e.jsxs("select",{value:k,onChange:t=>z(t.target.value),className:"input w-full sm:w-40","aria-label":"Filter by action",children:[e.jsx("option",{value:"all",children:"All actions"}),e.jsx("option",{value:"check-in",children:"Check-in"}),e.jsx("option",{value:"check-out",children:"Check-out"})]})]}),e.jsx("div",{className:"overflow-auto max-h-80 scroll-thin",children:e.jsxs("table",{className:"min-w-full text-left text-sm text-gray-800 dark:text-gray-200",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800/70",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-sm",children:"Action"}),e.jsx("th",{className:"px-3 py-2 text-sm",children:"Purpose"}),e.jsx("th",{className:"px-3 py-2 text-sm",children:"Check-in"}),e.jsx("th",{className:"px-3 py-2 text-sm",children:"Check-out"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200/60 dark:divide-gray-700/60",children:[_.map(t=>e.jsxs("tr",{className:"border-t border-gray-200/60 dark:border-gray-700/60",children:[e.jsx("td",{className:"px-3 py-2 text-sm",children:t.action}),e.jsx("td",{className:"px-3 py-2 text-sm",children:t.purpose||"-"}),e.jsx("td",{className:"px-3 py-2 text-sm",children:t.checkInTime?new Date(t.checkInTime).toLocaleString():"-"}),e.jsx("td",{className:"px-3 py-2 text-sm",children:t.checkOutTime?new Date(t.checkOutTime).toLocaleString():"-"})]},t._id)),_.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-center text-gray-500 dark:text-gray-400",colSpan:4,children:"No logs"})})]})]})})]})]})]}),p&&E.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/75 backdrop-blur-sm animate-fade-in",onClick:()=>v(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative",onClick:t=>t.stopPropagation(),children:[e.jsx("img",{src:s.profilePhotoUrl,alt:"Profile full view",className:"max-w-[92vw] max-h-[86vh] object-contain rounded-xl shadow-2xl animate-scale-in"}),e.jsxs("button",{type:"button",onClick:()=>v(!1),"aria-label":"Close",className:"group absolute -top-4 -right-4",children:[e.jsx("span",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-rose-500/40 to-fuchsia-500/40 blur-md opacity-0 group-hover:opacity-100 transition"}),e.jsx("span",{className:"relative inline-flex h-10 w-10 items-center justify-center rounded-full bg-gray-900/90 text-white border border-white/10 shadow-lg ring-1 ring-white/10 hover:scale-105 transition",children:e.jsx(R,{className:"h-5 w-5"})})]})]})})]}),document.body),f&&E.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/75 backdrop-blur-sm animate-fade-in",onClick:()=>y(!1)}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4","aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"mx-auto bg-white dark:bg-gray-900 rounded-2xl p-5 shadow-2xl border border-black/10 dark:border-white/10 animate-scale-in",children:[e.jsx("img",{src:s.qrCodeDataUrl,alt:"Full QR code",className:"w-[80vw] max-w-[520px] aspect-square object-contain rounded-md"}),e.jsx("div",{className:"text-center text-sm mt-3 text-gray-600 dark:text-gray-300",children:"Present this QR at the gate"})]}),e.jsxs("button",{type:"button",onClick:()=>y(!1),"aria-label":"Close",className:"group absolute -top-4 -right-4",children:[e.jsx("span",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-emerald-500/40 to-sky-500/40 blur-md opacity-0 group-hover:opacity-100 transition"}),e.jsx("span",{className:"relative inline-flex h-10 w-10 items-center justify-center rounded-full bg-gray-900/90 text-white border border-white/10 shadow-lg ring-1 ring-white/10 hover:scale-105 transition",children:e.jsx(R,{className:"h-5 w-5"})})]})]})})]}),document.body)]})}export{me as default};
