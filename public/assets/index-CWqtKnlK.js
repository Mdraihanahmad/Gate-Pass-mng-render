const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminOverstayModal-CMj89vpN.js","assets/vendor-CFsy__N8.js","assets/vendor-recharts-ClFrvCmH.js","assets/vendor-router-CySAd55F.js","assets/vendor-axios-NIGUFBhG.js","assets/vendor-icons-B9ONrHs4.js","assets/Login-DfT7y0y4.js","assets/Signup-BlbQxbYX.js","assets/ForgotPassword-B4k3qCXC.js","assets/StudentDashboard-D3ykHtTg.js","assets/offline-CafmH5fM.js","assets/AdminDashboard-uKVfBDLy.js","assets/SecurityDashboard-4nfpJDF1.js","assets/About-DCEI8zKV.js"])))=>i.map(i=>d[i]);
import{r as a,ap as e,R as Xe,aq as ne,ar as vt}from"./vendor-CFsy__N8.js";import{u as wt,N as Ee,L as q,R as jt,a as O,B as kt}from"./vendor-router-CySAd55F.js";import{a as Nt}from"./vendor-axios-NIGUFBhG.js";import{S as We,M as Ve,X as oe,a as St,U as Ne,B as Je,L as Ge,b as Se,E as J,c as G,C as ie,I as Ct,d as Ce,e as Et,K as Ye}from"./vendor-icons-B9ONrHs4.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))h(d);new MutationObserver(d=>{for(const l of d)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&h(c)}).observe(document,{childList:!0,subtree:!0});function o(d){const l={};return d.integrity&&(l.integrity=d.integrity),d.referrerPolicy&&(l.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?l.credentials="include":d.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function h(d){if(d.ep)return;d.ep=!0;const l=o(d);fetch(d.href,l)}})();const Lt="modulepreload",Pt=function(s){return"/"+s},Ke={},A=function(n,o,h){let d=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));d=Promise.allSettled(o.map(v=>{if(v=Pt(v),v in Ke)return;Ke[v]=!0;const p=v.endsWith(".css"),S=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${S}`))return;const r=document.createElement("link");if(r.rel=p?"stylesheet":Lt,p||(r.as="script"),r.crossOrigin="",r.href=v,u&&r.setAttribute("nonce",u),document.head.appendChild(r),p)return new Promise((f,b)=>{r.addEventListener("load",f),r.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${v}`)))})}))}function l(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return d.then(c=>{for(const u of c||[])u.status==="rejected"&&l(u.reason);return n().catch(l)})},Pe="/api",B=Nt.create({baseURL:Pe,timeout:15e3,headers:{Accept:"application/json"}});let de=null;B.interceptors.request.use(s=>(de&&(s.headers.Authorization=`Bearer ${de}`),s));let Le=null;B.interceptors.response.use(s=>{if(s&&s.status===200&&typeof s.data=="string"){const n=String(s.data).trim().slice(0,200).toLowerCase();if(n.startsWith("<!doctype")||n.startsWith("<html")){const o=new Error("Invalid server response");throw o.response={status:502,data:{message:"Invalid server response (HTML). Check API routing or BASE URL."}},o}}return s},s=>{var h,d,l;const n=(h=s==null?void 0:s.response)==null?void 0:h.status,o=(l=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:l.message;if(n===401||n===403){try{localStorage.removeItem("token"),localStorage.removeItem("user")}catch{}de=null,typeof Le=="function"&&Le(o||"Session expired")}return Promise.reject(s)});const x={setToken:s=>{de=s},onAuthFailure:s=>{Le=s},get:(s,n)=>B.get(s,{...n}),post:(s,n,o)=>B.post(s,n,o),patch:(s,n,o)=>B.patch(s,n,o),delete:(s,n)=>B.delete(s,n)},Qt=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:Pe,api:x},Symbol.toStringTag,{value:"Module"})),Qe=a.createContext(),At=({children:s})=>{const[n,o]=a.useState(()=>localStorage.getItem("token")),[h,d]=a.useState(()=>localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null),[l,c]=a.useState(!1);a.useEffect(()=>{n&&x.setToken(n)},[n]),a.useEffect(()=>{x.onAuthFailure(r=>{o(null),d(null);try{localStorage.removeItem("token"),localStorage.removeItem("user")}catch{}if(typeof window<"u"){const f=new URLSearchParams;r&&f.set("msg",r),window.location.assign(`/login?${f.toString()}`)}})},[]);const u=async(r,f,b)=>{c(!0);try{const w={registrationNo:r,password:f};b&&b!=="student"&&(delete w.registrationNo,w.name=r);const{data:C}=await x.post("/auth/login",w);return o(C.token),d(C.user),localStorage.setItem("token",C.token),localStorage.setItem("user",JSON.stringify(C.user)),x.setToken(C.token),C.user}finally{c(!1)}},v=async r=>{c(!0);try{const{data:f}=await x.post("/auth/signup",r);return o(f.token),d(f.user),localStorage.setItem("token",f.token),localStorage.setItem("user",JSON.stringify(f.user)),x.setToken(f.token),f.user}finally{c(!1)}},p=()=>{o(null),d(null),localStorage.removeItem("token"),localStorage.removeItem("user")},S=async()=>{if(!n)return null;try{const{data:r}=await x.get("/auth/me");return d(r),localStorage.setItem("user",JSON.stringify(r)),r}catch{return null}};return e.jsx(Qe.Provider,{value:{token:n,user:h,loading:l,login:u,signup:v,logout:p,refreshUser:S},children:s})},Ae=()=>a.useContext(Qe),le=({role:s,children:n})=>{const{user:o}=Ae(),h=wt();return!!o&&(Array.isArray(s)?s.includes(o.role):o.role===s)?n:e.jsx(Ee,{to:"/login",replace:!0,state:{from:h}})};function It({columns:s,data:n,maxHeight:o,containerClassName:h=""}){const d=o?{maxHeight:typeof o=="number"?`${o}px`:o}:void 0;return e.jsx("div",{className:`overflow-auto border rounded animate-fade-in ${h}`,style:d,children:e.jsxs("table",{className:"min-w-full text-left text-sm",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-gray-100 dark:bg-gray-700 dark:text-gray-100 shadow-sm",children:e.jsx("tr",{children:s.map(l=>e.jsx("th",{className:"px-2 md:px-3 py-2 font-semibold whitespace-nowrap",children:l.title},l.key))})}),e.jsxs("tbody",{children:[n.map(l=>e.jsx("tr",{className:"border-t border-gray-200 dark:border-gray-700 odd:bg-white even:bg-gray-50 dark:odd:bg-gray-800 dark:even:bg-gray-900 hover:bg-blue-50/60 dark:hover:bg-blue-900/30 transition-colors",children:s.map(c=>e.jsx("td",{className:"px-2 md:px-3 py-2 align-top whitespace-nowrap",children:c.render?c.render(l[c.key],l):String(l[c.key]??"")},c.key))},l._id||JSON.stringify(l))),n.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-10 text-center text-gray-500 dark:text-gray-400",colSpan:s.length,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-8 h-8 text-gray-300 dark:text-gray-600",children:e.jsx("path",{fillRule:"evenodd",d:"M2.25 6.75A2.25 2.25 0 014.5 4.5h15a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0119.5 19.5h-15a2.25 2.25 0 01-2.25-2.25V6.75zm3 0a.75.75 0 00-.75.75v9a.75.75 0 00.75.75h13.5a.75.75 0 00.75-.75v-9a.75.75 0 00-.75-.75H5.25z",clipRule:"evenodd"})}),e.jsx("div",{children:"No data"})]})})})]})]})})}const Ot=Xe.memo(It);function _t(s){if(/^https?:\/\//i.test(s))return s;const n=Pe.replace(/\/+$/,"");let o=s.startsWith("/")?s:`/${s}`;return/\/api$/i.test(n)&&/^\/api(\/|$)/i.test(o)&&(o=o.replace(/^\/api/i,""),o.startsWith("/")||(o=`/${o}`)),`${n}${o}`}async function Tt(s,n={},o="download"){const h=new URLSearchParams;Object.entries(n).forEach(([b,w])=>{w!=null&&w!==""&&h.set(b,w)});const d=localStorage.getItem("token"),l=_t(s),c=h.toString()?`${l}?${h.toString()}`:l,u=await fetch(c,{method:"GET",headers:d?{Authorization:`Bearer ${d}`}:{}});if(!u.ok){let b=`Download failed (${u.status})`;try{const w=await u.json();w!=null&&w.message&&(b=w.message)}catch{}throw new Error(b)}const v=await u.blob();let p=o;const S=u.headers.get("content-disposition");if(S){const b=/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i.exec(S),w=decodeURIComponent((b==null?void 0:b[1])||(b==null?void 0:b[2])||"");w&&(p=w)}const r=URL.createObjectURL(v),f=document.createElement("a");f.href=r,f.download=p,document.body.appendChild(f),f.click(),f.remove(),URL.revokeObjectURL(r)}const Rt=a.lazy(()=>A(()=>import("./AdminOverstayModal-CMj89vpN.js"),__vite__mapDeps([0,1,2,3,4,5])));function Ft(){const{user:s,logout:n,refreshUser:o}=Ae(),[h,d]=a.useState([]),[l,c]=a.useState(!1),[u,v]=a.useState(!1),[p,S]=a.useState(null),[r,f]=a.useState(!0),[b,w]=a.useState(!1),[C,et]=a.useState("student"),[tt,Ie]=a.useState([]),[st,Oe]=a.useState(!1),[Y,N]=a.useState(!1),[_,_e]=a.useState(()=>localStorage.getItem("theme")||"system"),[ce,Te]=a.useState(null),[at,Re]=a.useState(!1),[T,H]=a.useState(!1),[j,K]=a.useState({current:"",p1:"",p2:""}),[me,ue]=a.useState(""),[R,ge]=a.useState({oldPin:"",newPin:""}),[he,xe]=a.useState(""),[m,W]=a.useState(null),[E,Z]=a.useState({name:"",registrationNo:""}),[pe,X]=a.useState(""),[U,fe]=a.useState(null),[ye,V]=a.useState(""),[Q,Fe]=a.useState(!1),[rt,be]=a.useState(0),[ve,Ue]=a.useState(!1),[L,De]=a.useState(null),[we,$e]=a.useState(""),[D,je]=a.useState(null),[$,ke]=a.useState({current:!1,p1:!1,p2:!1}),[ee,ze]=a.useState(!1),[nt,ot]=a.useState(!1),[z,te]=a.useState(!1),[it,Me]=a.useState([]),[lt,qe]=a.useState(!1),[P,dt]=a.useState({from:"",to:""}),[ct,Be]=a.useState({currentOutside:{count:0,avgHours:0,maxHours:0,top:[]},openResolved:{open:0,resolved:0},byHour:[],frequent:[]});a.useEffect(()=>{const t=()=>{ot(window.scrollY>4)};return t(),window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[]),a.useEffect(()=>{const t=i=>{i.preventDefault(),Te(i),Re(!0)};return window.addEventListener("beforeinstallprompt",t),()=>window.removeEventListener("beforeinstallprompt",t)},[]),a.useEffect(()=>{const t=()=>{const i=window.matchMedia("(prefers-color-scheme: dark)").matches,y=_==="dark"||_==="system"&&i;document.documentElement.classList.toggle("dark",y),document.documentElement.setAttribute("data-theme",_)};try{t(),localStorage.setItem("theme",_)}catch{}},[_]),a.useEffect(()=>{if(!s||s.role!=="admin"||!u)return;let t=!1;const i=async()=>{try{const{data:g}=await x.get("/admin/counts",{params:{approvedOnly:r}});t||S(g)}catch{}};i();const y=setInterval(i,15e3);return()=>{t=!0,clearInterval(y)}},[s,u,r]),a.useEffect(()=>{s&&(async()=>d((await x.get("/notifications")).data))()},[s]);const se=h.filter(t=>!t.read).length,He=async()=>{await x.post("/notifications/read"),d((await x.get("/notifications")).data)};a.useEffect(()=>{(async()=>{if(!(!T||!s||s.role!=="student"))try{const{data:i}=await x.get("/students/me");W(i),Z({name:(i==null?void 0:i.name)||"",registrationNo:(i==null?void 0:i.registrationNo)||""})}catch{W(null)}})()},[T,s]),a.useEffect(()=>{m&&Z({name:m.name||"",registrationNo:m.registrationNo||""})},[m]),a.useEffect(()=>{if(T||b||z){const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[T,b,z]),a.useEffect(()=>{const t=i=>{i.key==="Escape"&&(T&&H(!1),b&&w(!1),z&&te(!1),ve&&M())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[T,b,z,ve]),a.useEffect(()=>()=>{L&&L.getTracks().forEach(t=>t.stop())},[L]);const mt=async()=>{$e(""),je(null);try{const t=await navigator.mediaDevices.getUserMedia({video:{width:640,height:640,facingMode:"user"}});De(t),Ue(!0)}catch(t){$e((t==null?void 0:t.message)||"Unable to access camera")}},M=()=>{L&&L.getTracks().forEach(t=>t.stop()),De(null),Ue(!1)},ut=()=>{if(!L)return;const i=L.getVideoTracks()[0].getSettings(),y=i.width||640,g=i.height||640,k=Math.min(y,g),I=document.createElement("canvas");I.width=512,I.height=512;const pt=I.getContext("2d"),re=document.getElementById("camera-video");if(!re)return;const ft=(re.videoWidth-k)/2,yt=(re.videoHeight-k)/2;pt.drawImage(re,ft,yt,k,k,0,0,512,512);const bt=I.toDataURL("image/jpeg",.9);je(bt)},gt=()=>{D&&fetch(D).then(t=>t.blob()).then(t=>{const i=new File([t],"capture.jpg",{type:"image/jpeg"});fe(i),V("Captured photo ready to upload"),M()}).catch(()=>V("Failed to process captured image"))},F=async t=>{v(!1),N(!1),et(t),w(!0),Oe(!0);try{const{data:i}=await x.get("/admin/users",{params:{role:t,approvedOnly:r}});Ie(i)}catch{Ie([])}finally{Oe(!1)}};a.useEffect(()=>{s&&s.role==="admin"&&b&&F(C)},[r]);const ae=async()=>{if(!(!s||s.role!=="admin")){qe(!0);try{const t={};P.from&&(t.from=P.from),P.to&&(t.to=P.to);const[i,y,g,k,I]=await Promise.all([x.get("/admin/overstays",{params:t}),x.get("/admin/analytics/current-outside-summary",{params:t}),x.get("/admin/analytics/overstays-open-resolved",{params:t}),x.get("/admin/analytics/exits-by-hour",{params:t}),x.get("/admin/analytics/frequent-overstayers",{params:t})]);Me(i.data||[]),Be({currentOutside:y.data||{count:0,avgHours:0,maxHours:0,top:[]},openResolved:g.data||{open:0,resolved:0},byHour:k.data||[],frequent:I.data||[]})}catch{Me([]),Be({currentOutside:{count:0,avgHours:0,maxHours:0,top:[]},openResolved:{open:0,resolved:0},byHour:[],frequent:[]})}finally{qe(!1)}}},ht=async t=>{try{await x.post(`/admin/overstays/${t}/resolve`),await ae()}catch{}},xt=async t=>{try{const i={type:"overstays"};P.from&&(i.from=P.from),P.to&&(i.to=P.to),await Tt(`/api/export/${t}`,i,`overstays.${t}`)}catch{}};return e.jsxs("nav",{className:`sticky top-0 z-50 p-3 border-b bg-white/80 text-gray-900 border-gray-200 supports-[backdrop-filter]:bg-white/70 backdrop-blur dark:bg-gray-900/60 dark:text-gray-100 dark:border-white/10 transition-shadow ${nt?"shadow-md shadow-black/10 dark:shadow-black/20":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{to:"/",className:"font-semibold text-lg",children:"GatePass"}),e.jsxs("div",{className:"flex items-center gap-2 md:hidden",children:[e.jsx("button",{className:"p-2 rounded-md text-sky-700 hover:text-sky-900 hover:bg-sky-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition dark:text-sky-200 dark:hover:text-white dark:hover:bg-sky-400/10",onClick:()=>_e(t=>t==="dark"?"light":"dark"),"aria-label":"Toggle theme",title:"Toggle theme",children:_==="dark"?e.jsx(We,{className:"h-5 w-5"}):e.jsx(Ve,{className:"h-5 w-5"})}),e.jsx("button",{className:`p-2 rounded-md ${Y?"text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-400/10":"text-sky-700 dark:text-sky-200"} hover:text-sky-900 hover:bg-sky-100 dark:hover:text-white dark:hover:bg-sky-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition`,onClick:()=>N(t=>!t),"aria-label":"Toggle menu","aria-expanded":Y,title:"Menu",children:Y?e.jsx(oe,{className:"h-6 w-6 transition-transform duration-200"}):e.jsx(St,{className:"h-6 w-6 transition-transform duration-200"})})]}),e.jsx("div",{className:"hidden md:flex gap-3 items-center",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm hidden md:inline",children:[s.registrationNo," (",s.role,")"]}),e.jsx("button",{className:"p-2 rounded-md text-sky-700 hover:text-sky-900 hover:bg-sky-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition dark:text-sky-200 dark:hover:text-white dark:hover:bg-sky-400/10",onClick:()=>_e(t=>t==="dark"?"light":"dark"),"aria-label":"Toggle theme",title:"Toggle theme",children:_==="dark"?e.jsx(We,{className:"h-5 w-5"}):e.jsx(Ve,{className:"h-5 w-5"})}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md text-sky-700 hover:text-sky-900 hover:bg-sky-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition dark:text-sky-200 dark:hover:text-white dark:hover:bg-sky-400/10",onClick:()=>{H(!0),N(!1)},title:"Edit profile",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Profile"})]}),at&&e.jsx("button",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/30 transition dark:text-emerald-200 dark:hover:text-white dark:hover:bg-emerald-400/10",onClick:async()=>{if(!ce)return;ce.prompt();const{outcome:t}=await ce.userChoice;t&&Re(!1),Te(null)},children:"Install App"}),s.role==="admin"&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-md ${u?"text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-400/10":"text-sky-700 dark:text-sky-200"} hover:text-sky-900 hover:bg-sky-100 dark:hover:text-white dark:hover:bg-sky-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition`,onClick:async()=>{v(!u)},"aria-expanded":u,children:"Stats"}),e.jsx("button",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md text-amber-700 hover:text-amber-900 hover:bg-amber-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/30 transition dark:text-amber-200 dark:hover:text-white dark:hover:bg-amber-400/10 ml-2",onClick:async()=>{te(!0),N(!1),await ae()},title:"Overstay Alerts",children:"Overstay Alerts"}),u&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded shadow-xl p-2 text-sm animate-scale-in bg-white text-gray-900 border border-gray-200 dark:bg-gray-900/95 dark:text-gray-100 dark:border-white/10 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:t=>f(t.target.checked)}),"Approved only"]}),p&&e.jsx("span",{className:"text-xs text-gray-500",children:"auto"})]}),p?e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 rounded px-2 py-1",onClick:()=>F("student"),children:[e.jsx("span",{children:"Total Students"}),e.jsx("span",{className:"font-semibold",children:p.students})]})}),e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 rounded px-2 py-1",onClick:()=>F("security"),children:[e.jsx("span",{children:"Total Security"}),e.jsx("span",{className:"font-semibold",children:p.security})]})}),e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 rounded px-2 py-1",onClick:()=>F("admin"),children:[e.jsx("span",{children:"Total Admins"}),e.jsx("span",{className:"font-semibold",children:p.admins})]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading…"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-md ${l?"text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-400/10":"text-sky-700 dark:text-sky-200"} hover:text-sky-900 hover:bg-sky-100 dark:hover:text-white dark:hover:bg-sky-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition`,onClick:()=>{c(!l),l===!1&&He()},"aria-expanded":l,"aria-haspopup":"menu",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Notifications"}),se>0&&e.jsx("span",{className:"ml-1 bg-red-600 text-white rounded px-1 text-xs",children:se})]}),l&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 rounded shadow-xl p-2 max-h-64 overflow-auto animate-scale-in bg-white text-gray-900 border border-gray-200 dark:bg-gray-900/95 dark:text-gray-100 dark:border-white/10 z-50",children:[h.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No notifications"}),h.map(t=>e.jsxs("div",{className:"text-sm border-b py-1",children:[t.message,e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(t.createdAt).toLocaleString()})]},t._id))]})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md text-rose-700 hover:text-rose-900 hover:bg-rose-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400/30 transition dark:text-rose-200 dark:hover:text-white dark:hover:bg-rose-400/10",onClick:n,children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{to:"/login",children:"Login"}),e.jsx(q,{to:"/signup",children:"Signup"})]})})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 dark:bg-gradient-to-b dark:from-gray-900/70 dark:to-black/70 backdrop-blur-sm animate-fade-in md:hidden",onClick:()=>N(!1)}),e.jsxs("div",{className:"md:hidden mt-2 space-y-3 rounded-lg p-4 shadow-2xl border border-gray-200 bg-white text-gray-900 animate-scale-in dark:border-white/10 dark:bg-gray-800/95 dark:text-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-sky-700 dark:text-sky-300",children:"Menu"}),e.jsx("button",{className:"p-2 rounded-md text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/30 transition dark:text-emerald-300 dark:hover:text-white dark:hover:bg-emerald-400/10",onClick:()=>N(!1),"aria-label":"Close menu",title:"Close",children:e.jsx(oe,{className:"h-6 w-6"})})]}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 -mt-1",children:[s.registrationNo," (",s.role,")"]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:()=>{H(!0),N(!1)},style:{animationDelay:"60ms"},children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Profile"})]}),s.role==="student"&&e.jsx(q,{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",to:"/about",onClick:()=>N(!1),style:{animationDelay:"80ms"},children:"About"}),s.role==="admin"&&e.jsxs("div",{children:[e.jsx("button",{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:()=>v(t=>!t),style:{animationDelay:"100ms"},children:"Stats"}),e.jsx("button",{className:"mt-2 w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-amber-50 text-amber-900 border border-amber-200 hover:bg-amber-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:async()=>{N(!1),te(!0),await ae()},style:{animationDelay:"120ms"},children:"Overstay Alerts"}),u&&e.jsxs("div",{className:"mt-2 w-full bg-white rounded shadow-lg p-2 text-sm animate-scale-in text-gray-900 border border-gray-200 dark:bg-gray-900/90 dark:text-gray-100 dark:border-white/10 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:t=>f(t.target.checked)}),"Approved only"]}),p&&e.jsx("span",{className:"text-xs text-gray-500",children:"auto"})]}),p?e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-700 rounded px-2 py-1",onClick:()=>F("student"),children:[e.jsx("span",{children:"Total Students"}),e.jsx("span",{className:"font-semibold",children:p.students})]})}),e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-700 rounded px-2 py-1",onClick:()=>F("security"),children:[e.jsx("span",{children:"Total Security"}),e.jsx("span",{className:"font-semibold",children:p.security})]})}),e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-700 rounded px-2 py-1",onClick:()=>F("admin"),children:[e.jsx("span",{children:"Total Admins"}),e.jsx("span",{className:"font-semibold",children:p.admins})]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading…"})]})]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-rose-50 text-rose-900 border border-rose-200 hover:bg-rose-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:()=>{c(t=>!t),l||He()},style:{animationDelay:"140ms"},children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:"Notifications"}),se>0&&e.jsx("span",{className:"ml-1 bg-red-600 text-white rounded px-1 text-xs",children:se})]}),l&&e.jsxs("div",{className:"w-full bg-white rounded shadow-lg p-2 max-h-64 overflow-auto animate-scale-in text-gray-900 border border-gray-200 dark:bg-gray-900/90 dark:text-gray-100 dark:border-white/10 z-50",children:[h.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No notifications"}),h.map(t=>e.jsxs("div",{className:"text-sm border-b py-1",children:[t.message,e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.createdAt).toLocaleString()})]},t._id))]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-rose-50 text-rose-900 border border-rose-200 hover:bg-rose-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:n,style:{animationDelay:"180ms"},children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx(q,{className:"flex-1 text-center rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",to:"/login",onClick:()=>N(!1),children:"Login"}),e.jsx(q,{className:"flex-1 text-center rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",to:"/signup",onClick:()=>N(!1),children:"Signup"})]})]})]}),s&&s.role==="admin"&&b&&ne.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md animate-fade-in",onClick:()=>w(!1)}),e.jsxs("div",{className:"relative glass rounded shadow-xl w-[90vw] max-w-3xl max-h-[80vh] p-4 overflow-auto animate-scale-in text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"text-lg font-semibold capitalize",children:[C," list ",r?"(approved)":""]}),e.jsx("button",{className:"btn",onClick:()=>w(!1),children:"Close"})]}),st?e.jsx("div",{className:"text-gray-500",children:"Loading…"}):e.jsx(Ot,{columns:C==="student"?[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"isApproved",title:"Approved",render:t=>t?"Yes":"No"}]:[{key:"registrationNo",title:"Identifier"},{key:"name",title:"Name"},{key:"isApproved",title:"Approved",render:t=>t?"Yes":"No"}],data:tt})]})]}),document.body),s&&s.role==="admin"&&z&&ne.createPortal(e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:e.jsx("div",{className:"p-3 rounded bg-gray-900/80 text-white border border-white/10",children:"Loading…"})}),children:e.jsx(Rt,{charts:ct,overstays:it,overstaysFilter:P,setOverstaysFilter:dt,overstayOpen:z,setOverstayOpen:te,exportOverstays:xt,loadOverstaysAndCharts:ae,overstaysLoading:lt,resolveOverstay:ht})}),document.body),s&&T&&ne.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md animate-fade-in",onClick:()=>H(!1)}),e.jsxs("div",{className:"relative w-[92vw] max-w-md max-h-[85vh] overflow-y-auto overscroll-contain scrollbar-thin p-4 sm:p-5 rounded-lg shadow-2xl border border-white/10 bg-gray-800/95 text-gray-100 animate-scale-in text-[14px] sm:text-[15px] md:text-base transform-gpu origin-top max-[400px]:scale-[.94] max-[360px]:scale-[.9]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 text-base sm:text-lg font-semibold",children:[e.jsx(Ne,{className:"h-5 w-5 text-sky-300"}),"Edit Profile"]}),e.jsx("button",{className:"p-2 rounded-md text-emerald-300 hover:text-white hover:bg-emerald-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/30 transition",onClick:()=>H(!1),"aria-label":"Close",children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Change Password"}),e.jsxs("form",{className:"flex flex-col gap-3",onSubmit:async t=>{var i,y;t.preventDefault(),ue("");try{if(!j.current||!j.p1||!j.p2)throw new Error("All fields are required");if(j.p1.length<6)throw new Error("Password must be at least 6 characters");if(j.p1!==j.p2)throw new Error("Passwords do not match");await x.post("/auth/change-password",{currentPassword:j.current,newPassword:j.p1}),K({current:"",p1:"",p2:""}),ue("Password changed successfully")}catch(g){ue(((y=(i=g==null?void 0:g.response)==null?void 0:i.data)==null?void 0:y.message)||g.message||"Failed to change password")}},children:[e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",type:$.current?"text":"password",placeholder:"Current password",value:j.current,onChange:t=>K({...j,current:t.target.value})}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>ke(t=>({...t,current:!t.current})),"aria-label":"Toggle password visibility",children:$.current?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",type:$.p1?"text":"password",placeholder:"New password",value:j.p1,onChange:t=>K({...j,p1:t.target.value})}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>ke(t=>({...t,p1:!t.p1})),"aria-label":"Toggle password visibility",children:$.p1?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",type:$.p2?"text":"password",placeholder:"Confirm new password",value:j.p2,onChange:t=>K({...j,p2:t.target.value})}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>ke(t=>({...t,p2:!t.p2})),"aria-label":"Toggle password visibility",children:$.p2?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-md bg-sky-600 px-4 py-2 text-sm text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/50 w-fit",children:[e.jsx(ie,{className:"h-4 w-4"}),"Save"]}),me&&e.jsx("div",{className:`text-sm ${me.includes("success")?"text-green-400":"text-rose-400"}`,children:me})]})]}),s&&s.role==="student"&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Identity (pre-approval)"}),m!=null&&m.isApproved?e.jsx("div",{className:"text-sm text-emerald-400 mb-2",children:"Identity is locked after approval. Contact admin for changes."}):e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"You can edit your name and registration number until your account is approved."}),e.jsxs("form",{className:"flex flex-col gap-3 mb-4",onSubmit:async t=>{var i,y;t.preventDefault(),X("");try{if(m!=null&&m.isApproved)throw new Error("Already approved");const g={};if(E.name&&E.name!==(m==null?void 0:m.name)&&(g.name=E.name),E.registrationNo&&E.registrationNo!==(m==null?void 0:m.registrationNo)&&(g.registrationNo=E.registrationNo),Object.keys(g).length===0){X("No changes to save");return}await x.patch("/students/draft",g);const{data:k}=await x.get("/students/me");W(k);try{await(o==null?void 0:o())}catch{}X("Saved")}catch(g){X(((y=(i=g==null?void 0:g.response)==null?void 0:i.data)==null?void 0:y.message)||g.message||"Failed to save")}},children:[e.jsx("input",{className:"input",placeholder:"Full name",value:E.name,disabled:!!(m!=null&&m.isApproved),onChange:t=>Z({...E,name:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Registration number",value:E.registrationNo,disabled:!!(m!=null&&m.isApproved),onChange:t=>Z({...E,registrationNo:t.target.value})}),!(m!=null&&m.isApproved)&&e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-md bg-sky-600 px-4 py-2 text-sm text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/50 w-fit",children:[e.jsx(ie,{className:"h-4 w-4"}),"Save identity"]}),pe&&e.jsx("div",{className:`text-sm ${pe==="Saved"?"text-green-400":"text-rose-400"}`,children:pe})]}),e.jsx("div",{className:"font-semibold mb-1",children:"Profile Photo"}),e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"PNG/JPG up to 2 MB. You can update your photo until approval; after approval it is locked."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:(m==null?void 0:m.profilePhotoUrl)||"https://placehold.co/64x64?text=Avatar",alt:"Current",className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover border border-white/10"}),!(m!=null&&m.isApproved)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"photo-input",type:"file",accept:"image/*",className:"hidden",onChange:t=>{var i;return fe(((i=t.target.files)==null?void 0:i[0])||null)}}),e.jsxs("label",{htmlFor:"photo-input",className:"inline-flex items-center gap-2 rounded-md px-3 py-2 bg-gray-700/60 text-gray-100 border border-white/10 hover:bg-gray-700/80 cursor-pointer",children:[e.jsx(Ct,{className:"h-4 w-4"})," Choose file"]}),e.jsx("span",{className:"text-xs text-gray-400 truncate max-w-[140px]",children:(U==null?void 0:U.name)||"No file chosen"}),e.jsxs("button",{type:"button",onClick:()=>mt(),className:"inline-flex items-center gap-2 rounded-md px-3 py-2 bg-gray-700/60 text-gray-100 border border-white/10 hover:bg-gray-700/80",children:[e.jsx(Ce,{className:"h-4 w-4"})," Capture"]})]})]}),!(m!=null&&m.isApproved)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("button",{className:`btn inline-flex items-center gap-2 ${Q?"opacity-70 cursor-not-allowed":""}`,disabled:Q,onClick:async()=>{var t,i;V(""),be(0),Fe(!0);try{if(!U)throw new Error("Select an image first");if(U.size>2*1024*1024)throw new Error("Max size 2 MB");const y=new FormData;y.append("photo",U),await x.post("/students/profile-photo",y,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:k=>{if(!k.total)return;const I=Math.round(k.loaded*100/k.total);be(I)}});const{data:g}=await x.get("/students/me");W(g),fe(null),V("Profile photo set")}catch(y){V(((i=(t=y==null?void 0:y.response)==null?void 0:t.data)==null?void 0:i.message)||y.message||"Upload failed")}finally{Fe(!1),setTimeout(()=>be(0),600)}},children:Q?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 3v3",strokeLinecap:"round"})}),"Uploading…"]}):e.jsxs(e.Fragment,{children:[e.jsx(Et,{className:"h-4 w-4"}),"Upload"]})}),ve&&ne.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[10000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-fade-in",onClick:M}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"relative w-full max-w-md bg-gray-900 text-gray-100 rounded-xl p-4 border border-white/10 shadow-2xl animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 font-semibold",children:[e.jsx(Ce,{className:"h-5 w-5"})," Capture Photo"]}),e.jsx("button",{onClick:M,className:"p-2 rounded-md hover:bg-white/10","aria-label":"Close camera",children:e.jsx(oe,{className:"h-5 w-5"})})]}),we&&e.jsx("div",{className:"text-sm text-rose-400 mb-2",children:we}),!D&&!we&&e.jsx("div",{className:"relative aspect-square w-full rounded-lg overflow-hidden bg-black",children:e.jsx("video",{id:"camera-video",autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",ref:t=>{t&&L&&t.srcObject!==L&&(t.srcObject=L)}})}),D&&e.jsx("div",{className:"relative aspect-square w-full rounded-lg overflow-hidden",children:e.jsx("img",{src:D,alt:"Captured preview",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2 justify-between",children:D?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>je(null),className:"px-4 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm",children:"Retake"}),e.jsxs("button",{onClick:gt,className:"btn inline-flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"})," Use Photo"]}),e.jsx("button",{onClick:M,className:"px-4 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm",children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:ut,className:"btn flex-1 inline-flex items-center justify-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"})," Capture"]}),e.jsx("button",{onClick:M,className:"px-4 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm",children:"Cancel"})]})}),e.jsx("div",{className:"mt-3 text-[11px] text-gray-400 leading-snug",children:"We capture a centered square and resize to 512x512 (compressed JPEG). Lighting and clarity help security identify you."})]})})]}),document.body),Q&&e.jsx("div",{className:"flex-1 h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-600 via-sky-600 to-emerald-500 transition-[width] duration-200",style:{width:`${rt}%`}})})]})}),(m==null?void 0:m.isApproved)&&e.jsx("div",{className:"mt-2 text-xs text-emerald-400",children:"Photo locked after approval."}),ye&&e.jsx("div",{className:`text-sm mt-1 ${ye.includes("set")?"text-green-400":"text-rose-400"}`,children:ye})]}),s&&s.role==="student"&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Change PIN"}),e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"This 6-digit PIN is used at the gate when your mobile is unavailable."}),e.jsxs("form",{className:"flex flex-col gap-3",onSubmit:async t=>{var i,y;t.preventDefault(),xe("");try{if(!/^\d{6}$/.test(R.newPin))throw new Error("PIN must be exactly 6 digits");await x.patch("/students/pin",{oldPin:R.oldPin||void 0,newPin:R.newPin});try{const{data:g}=await x.get("/students/me");W(g)}catch{}ge({oldPin:"",newPin:""}),xe("PIN updated successfully")}catch(g){xe(((y=(i=g==null?void 0:g.response)==null?void 0:i.data)==null?void 0:y.message)||g.message||"Failed to update PIN")}},children:[(m==null?void 0:m.pinCode)&&e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{value:R.oldPin,onChange:t=>ge({...R,oldPin:t.target.value}),placeholder:"Current 6-digit PIN",className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",maxLength:6,inputMode:"numeric",type:ee?"text":"password"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>ze(t=>!t),"aria-label":"Toggle PIN visibility",children:ee?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{value:R.newPin,onChange:t=>ge({...R,newPin:t.target.value}),placeholder:"New 6-digit PIN",className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",maxLength:6,inputMode:"numeric",type:ee?"text":"password"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>ze(t=>!t),"aria-label":"Toggle PIN visibility",children:ee?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-md bg-sky-600 px-4 py-2 text-sm text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/50 w-fit",type:"submit",children:[e.jsx(ie,{className:"h-4 w-4"}),"Save PIN"]}),he&&e.jsx("div",{className:`text-sm ${he.includes("success")?"text-green-400":"text-rose-400"}`,children:he})]})]})]})]})]}),document.body)]})}function Ut({onDone:s,duration:n=2e3}){const[o,h]=a.useState(!1),[d,l]=a.useState(!0),[c,u]=a.useState(!0);return a.useEffect(()=>{const v=setTimeout(()=>{h(!0);const p=setTimeout(()=>s==null?void 0:s(),200);return()=>clearTimeout(p)},n);return()=>clearTimeout(v)},[n,s]),e.jsxs("div",{className:`fixed inset-0 z-[99999] select-none ${o?"opacity-0 pointer-events-none":"opacity-100"} transition-opacity duration-200`,"aria-hidden":!0,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-900 to-black"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm"}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[e.jsx("img",{src:"/icons/icon-192.png",width:96,height:96,alt:"LNJPIT Logo",className:"rounded-xl shadow-2xl border border-white/10",loading:"eager"}),e.jsx("div",{className:"text-2xl font-extrabold tracking-tight text-white drop-shadow-sm",children:"GatePass"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex -space-x-3",children:[d?e.jsx("img",{src:"/developer.jpg",alt:"Developer: MD RAIHAN",className:"w-12 h-12 rounded-full object-cover border border-white/10 shadow ring-2 ring-gray-900",onError:()=>l(!1)}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-rose-500 grid place-items-center text-white font-bold border border-white/10 shadow ring-2 ring-gray-900",children:"RA"}),c?e.jsx("img",{src:"/faizan.jpg",alt:"Developer: Faizan",className:"w-12 h-12 rounded-full object-cover border border-white/10 shadow ring-2 ring-gray-900",onError:()=>u(!1)}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-emerald-500 to-cyan-500 grid place-items-center text-white font-bold border border-white/10 shadow ring-2 ring-gray-900",children:"FZ"})]}),e.jsx("div",{className:"text-gray-200 text-sm font-semibold",children:"Developed by: MD RAIHAN & FAIZAN"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Loading experience…"})]})})]})}const Dt=a.lazy(()=>A(()=>import("./Login-DfT7y0y4.js"),__vite__mapDeps([6,1,3,5,4]))),$t=a.lazy(()=>A(()=>import("./Signup-BlbQxbYX.js"),__vite__mapDeps([7,1,3,4,5]))),zt=a.lazy(()=>A(()=>import("./ForgotPassword-B4k3qCXC.js"),__vite__mapDeps([8,1,3,4,5]))),Mt=a.lazy(()=>A(()=>import("./StudentDashboard-D3ykHtTg.js"),__vite__mapDeps([9,1,10,5,3,4]))),qt=a.lazy(()=>A(()=>import("./AdminDashboard-uKVfBDLy.js"),__vite__mapDeps([11,1,10,5,3,4]))),Bt=a.lazy(()=>A(()=>import("./SecurityDashboard-4nfpJDF1.js"),__vite__mapDeps([12,1,10,5,3,4]))),Ht=a.lazy(()=>A(()=>import("./About-DCEI8zKV.js"),__vite__mapDeps([13,1,3])));function Wt(){const{user:s}=Ae();if(s){const n=s.role==="admin"?"/admin":s.role==="security"?"/security":"/student";return e.jsx(Ee,{to:n,replace:!0})}return e.jsx(Ee,{to:"/login",replace:!0})}function Vt(){const[s,n]=a.useState(()=>{try{return!sessionStorage.getItem("seen_splash")}catch{return!0}});return a.useEffect(()=>{if(s)try{sessionStorage.setItem("seen_splash","1")}catch{}},[s]),e.jsx(At,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800 transition-colors pt-2",children:[s&&e.jsx(Ut,{onDone:()=>n(!1),duration:1200}),e.jsx(Ft,{}),e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"p-6 text-sm text-gray-500",children:"Loading…"}),children:e.jsxs(jt,{children:[e.jsx(O,{path:"/",element:e.jsx(Wt,{})}),e.jsx(O,{path:"/login",element:e.jsx(Dt,{})}),e.jsx(O,{path:"/signup",element:e.jsx($t,{})}),e.jsx(O,{path:"/forgot-password",element:e.jsx(zt,{})}),e.jsx(O,{path:"/student",element:e.jsx(le,{role:"student",children:e.jsx(Mt,{})})}),e.jsx(O,{path:"/about",element:e.jsx(le,{role:"student",children:e.jsx(Ht,{})})}),e.jsx(O,{path:"/admin",element:e.jsx(le,{role:"admin",children:e.jsx(qt,{})})}),e.jsx(O,{path:"/security",element:e.jsx(le,{role:"security",children:e.jsx(Bt,{})})})]})})]})})}function Jt(s={}){const{immediate:n=!1,onNeedRefresh:o,onOfflineReady:h,onRegistered:d,onRegisteredSW:l,onRegisterError:c}=s;let u,v;const p=async(r=!0)=>{await v};async function S(){if("serviceWorker"in navigator){if(u=await A(async()=>{const{Workbox:r}=await import("./vendor-CFsy__N8.js").then(f=>f.at);return{Workbox:r}},[]).then(({Workbox:r})=>new r("/sw.js",{scope:"/",type:"classic"})).catch(r=>{c==null||c(r)}),!u)return;u.addEventListener("activated",r=>{(r.isUpdate||r.isExternal)&&window.location.reload()}),u.addEventListener("installed",r=>{r.isUpdate||h==null||h()}),u.register({immediate:n}).then(r=>{l?l("/sw.js",r):d==null||d(r)}).catch(r=>{c==null||c(r)})}}return v=S(),p}Xe.Fragment;const Ze=()=>{vt.createRoot(document.getElementById("root")).render(e.jsx(e.Fragment,{children:e.jsx(kt,{children:e.jsx(Vt,{})})}))};"requestIdleCallback"in window?window.requestIdleCallback(Ze,{timeout:1200}):setTimeout(Ze,0);const Gt=Jt({immediate:!0,onNeedRefresh(){Gt(!0)},onOfflineReady(){}});window.addEventListener("online",()=>{});window.addEventListener("offline",()=>{});export{Ot as D,A as _,x as a,Tt as b,Qt as c,Ae as u};
