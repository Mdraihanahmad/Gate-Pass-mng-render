const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminOverstayModal-C2se5fNh.js","assets/vendor-CFsy__N8.js","assets/vendor-recharts-DuiZsPwZ.js","assets/vendor-router-CySAd55F.js","assets/vendor-axios-NIGUFBhG.js","assets/vendor-icons-DxUJAirC.js","assets/Login-CgBacOH_.js","assets/Signup-CUZB4G63.js","assets/ForgotPassword-BlbDV6dd.js","assets/StudentDashboard-DXGeqhFJ.js","assets/offline-BGNqmuom.js","assets/AdminDashboard-StcCBFc-.js","assets/SecurityDashboard-Czc3i0Vm.js","assets/About-DCEI8zKV.js"])))=>i.map(i=>d[i]);
import{r as a,ap as e,R as tt,aq as oe,ar as Nt}from"./vendor-CFsy__N8.js";import{u as st,N as Le,L as A,R as St,a as _,B as Ct}from"./vendor-router-CySAd55F.js";import{a as Et}from"./vendor-axios-NIGUFBhG.js";import{S as Ve,M as Je,X as ie,a as Lt,L as Ge,I as Ye,U as Se,B as Ke,b as Ze,c as Ce,E as J,d as G,C as le,e as Pt,f as Ee,g as At,K as Xe}from"./vendor-icons-DxUJAirC.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))x(d);new MutationObserver(d=>{for(const l of d)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&x(c)}).observe(document,{childList:!0,subtree:!0});function o(d){const l={};return d.integrity&&(l.integrity=d.integrity),d.referrerPolicy&&(l.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?l.credentials="include":d.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function x(d){if(d.ep)return;d.ep=!0;const l=o(d);fetch(d.href,l)}})();const It="modulepreload",Ot=function(s){return"/"+s},Qe={},I=function(n,o,x){let d=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));d=Promise.allSettled(o.map(v=>{if(v=Ot(v),v in Qe)return;Qe[v]=!0;const p=v.endsWith(".css"),S=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${v}"]${S}`))return;const r=document.createElement("link");if(r.rel=p?"stylesheet":It,p||(r.as="script"),r.crossOrigin="",r.href=v,u&&r.setAttribute("nonce",u),document.head.appendChild(r),p)return new Promise((y,b)=>{r.addEventListener("load",y),r.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${v}`)))})}))}function l(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return d.then(c=>{for(const u of c||[])u.status==="rejected"&&l(u.reason);return n().catch(l)})},Ae="/api",B=Et.create({baseURL:Ae,timeout:15e3,headers:{Accept:"application/json"}});let ce=null;B.interceptors.request.use(s=>(ce&&(s.headers.Authorization=`Bearer ${ce}`),s));let Pe=null;B.interceptors.response.use(s=>{if(s&&s.status===200&&typeof s.data=="string"){const n=String(s.data).trim().slice(0,200).toLowerCase();if(n.startsWith("<!doctype")||n.startsWith("<html")){const o=new Error("Invalid server response");throw o.response={status:502,data:{message:"Invalid server response (HTML). Check API routing or BASE URL."}},o}}return s},s=>{var x,d,l;const n=(x=s==null?void 0:s.response)==null?void 0:x.status,o=(l=(d=s==null?void 0:s.response)==null?void 0:d.data)==null?void 0:l.message;if(n===401||n===403){try{localStorage.removeItem("token"),localStorage.removeItem("user")}catch{}ce=null,typeof Pe=="function"&&Pe(o||"Session expired")}return Promise.reject(s)});const g={setToken:s=>{ce=s},onAuthFailure:s=>{Pe=s},get:(s,n)=>B.get(s,{...n}),post:(s,n,o)=>B.post(s,n,o),patch:(s,n,o)=>B.patch(s,n,o),delete:(s,n)=>B.delete(s,n)},as=Object.freeze(Object.defineProperty({__proto__:null,API_BASE:Ae,api:g},Symbol.toStringTag,{value:"Module"})),at=a.createContext(),_t=({children:s})=>{const[n,o]=a.useState(()=>localStorage.getItem("token")),[x,d]=a.useState(()=>localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):null),[l,c]=a.useState(!1);a.useEffect(()=>{n&&g.setToken(n)},[n]),a.useEffect(()=>{g.onAuthFailure(r=>{o(null),d(null);try{localStorage.removeItem("token"),localStorage.removeItem("user")}catch{}if(typeof window<"u"){const y=new URLSearchParams;r&&y.set("msg",r),window.location.assign(`/login?${y.toString()}`)}})},[]);const u=async(r,y,b)=>{c(!0);try{const w={registrationNo:r,password:y};b&&b!=="student"&&(delete w.registrationNo,w.name=r);const{data:C}=await g.post("/auth/login",w);return o(C.token),d(C.user),localStorage.setItem("token",C.token),localStorage.setItem("user",JSON.stringify(C.user)),g.setToken(C.token),C.user}finally{c(!1)}},v=async r=>{c(!0);try{const{data:y}=await g.post("/auth/signup",r);return o(y.token),d(y.user),localStorage.setItem("token",y.token),localStorage.setItem("user",JSON.stringify(y.user)),g.setToken(y.token),y.user}finally{c(!1)}},p=()=>{o(null),d(null),localStorage.removeItem("token"),localStorage.removeItem("user")},S=async()=>{if(!n)return null;try{const{data:r}=await g.get("/auth/me");return d(r),localStorage.setItem("user",JSON.stringify(r)),r}catch{return null}};return e.jsx(at.Provider,{value:{token:n,user:x,loading:l,login:u,signup:v,logout:p,refreshUser:S},children:s})},Ie=()=>a.useContext(at),de=({role:s,children:n})=>{const{user:o}=Ie(),x=st();return!!o&&(Array.isArray(s)?s.includes(o.role):o.role===s)?n:e.jsx(Le,{to:"/login",replace:!0,state:{from:x}})};function Tt({columns:s,data:n,maxHeight:o,containerClassName:x=""}){const d=o?{maxHeight:typeof o=="number"?`${o}px`:o}:void 0;return e.jsx("div",{className:`overflow-auto border rounded animate-fade-in ${x}`,style:d,children:e.jsxs("table",{className:"min-w-full text-left text-sm",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-gray-100 dark:bg-gray-700 dark:text-gray-100 shadow-sm",children:e.jsx("tr",{children:s.map(l=>e.jsx("th",{className:"px-2 md:px-3 py-2 font-semibold whitespace-nowrap",children:l.title},l.key))})}),e.jsxs("tbody",{children:[n.map(l=>e.jsx("tr",{className:"border-t border-gray-200 dark:border-gray-700 odd:bg-white even:bg-gray-50 dark:odd:bg-gray-800 dark:even:bg-gray-900 hover:bg-blue-50/60 dark:hover:bg-blue-900/30 transition-colors",children:s.map(c=>e.jsx("td",{className:"px-2 md:px-3 py-2 align-top whitespace-nowrap",children:c.render?c.render(l[c.key],l):String(l[c.key]??"")},c.key))},l._id||JSON.stringify(l))),n.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-10 text-center text-gray-500 dark:text-gray-400",colSpan:s.length,children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-8 h-8 text-gray-300 dark:text-gray-600",children:e.jsx("path",{fillRule:"evenodd",d:"M2.25 6.75A2.25 2.25 0 014.5 4.5h15a2.25 2.25 0 012.25 2.25v10.5A2.25 2.25 0 0119.5 19.5h-15a2.25 2.25 0 01-2.25-2.25V6.75zm3 0a.75.75 0 00-.75.75v9a.75.75 0 00.75.75h13.5a.75.75 0 00.75-.75v-9a.75.75 0 00-.75-.75H5.25z",clipRule:"evenodd"})}),e.jsx("div",{children:"No data"})]})})})]})]})})}const Rt=tt.memo(Tt);function Dt(s){if(/^https?:\/\//i.test(s))return s;const n=Ae.replace(/\/+$/,"");let o=s.startsWith("/")?s:`/${s}`;return/\/api$/i.test(n)&&/^\/api(\/|$)/i.test(o)&&(o=o.replace(/^\/api/i,""),o.startsWith("/")||(o=`/${o}`)),`${n}${o}`}async function Ft(s,n={},o="download"){const x=new URLSearchParams;Object.entries(n).forEach(([b,w])=>{w!=null&&w!==""&&x.set(b,w)});const d=localStorage.getItem("token"),l=Dt(s),c=x.toString()?`${l}?${x.toString()}`:l,u=await fetch(c,{method:"GET",headers:d?{Authorization:`Bearer ${d}`}:{}});if(!u.ok){let b=`Download failed (${u.status})`;try{const w=await u.json();w!=null&&w.message&&(b=w.message)}catch{}throw new Error(b)}const v=await u.blob();let p=o;const S=u.headers.get("content-disposition");if(S){const b=/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i.exec(S),w=decodeURIComponent((b==null?void 0:b[1])||(b==null?void 0:b[2])||"");w&&(p=w)}const r=URL.createObjectURL(v),y=document.createElement("a");y.href=r,y.download=p,document.body.appendChild(y),y.click(),y.remove(),URL.revokeObjectURL(r)}const Ut=a.lazy(()=>I(()=>import("./AdminOverstayModal-C2se5fNh.js"),__vite__mapDeps([0,1,2,3,4,5])));function zt(){const{user:s,logout:n,refreshUser:o}=Ie(),[x,d]=a.useState([]),[l,c]=a.useState(!1),[u,v]=a.useState(!1),[p,S]=a.useState(null),[r,y]=a.useState(!0),[b,w]=a.useState(!1),[C,rt]=a.useState("student"),[nt,Oe]=a.useState([]),[ot,_e]=a.useState(!1),[Y,k]=a.useState(!1),[T,Te]=a.useState(()=>localStorage.getItem("theme")||"system"),[me,Re]=a.useState(null),[it,De]=a.useState(!1),[R,H]=a.useState(!1),[j,K]=a.useState({current:"",p1:"",p2:""}),[ue,he]=a.useState(""),[D,xe]=a.useState({oldPin:"",newPin:""}),[ge,pe]=a.useState(""),[m,W]=a.useState(null),[E,Z]=a.useState({name:"",registrationNo:""}),[ye,X]=a.useState(""),[U,fe]=a.useState(null),[be,V]=a.useState(""),[Q,Fe]=a.useState(!1),[lt,ve]=a.useState(0),[we,Ue]=a.useState(!1),[L,ze]=a.useState(null),[je,$e]=a.useState(""),[z,ke]=a.useState(null),[$,Ne]=a.useState({current:!1,p1:!1,p2:!1}),[ee,Me]=a.useState(!1),[dt,ct]=a.useState(!1),[M,te]=a.useState(!1),[mt,qe]=a.useState([]),[ut,Be]=a.useState(!1),[P,ht]=a.useState({from:"",to:""}),[xt,He]=a.useState({currentOutside:{count:0,avgHours:0,maxHours:0,top:[]},openResolved:{open:0,resolved:0},byHour:[],frequent:[]}),se=st().pathname;a.useEffect(()=>{const t=()=>{ct(window.scrollY>4)};return t(),window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[]),a.useEffect(()=>{const t=i=>{i.preventDefault(),Re(i),De(!0)};return window.addEventListener("beforeinstallprompt",t),()=>window.removeEventListener("beforeinstallprompt",t)},[]),a.useEffect(()=>{const t=()=>{const i=window.matchMedia("(prefers-color-scheme: dark)").matches,f=T==="dark"||T==="system"&&i;document.documentElement.classList.toggle("dark",f),document.documentElement.setAttribute("data-theme",T)};try{t(),localStorage.setItem("theme",T)}catch{}},[T]),a.useEffect(()=>{if(!s||s.role!=="admin"||!u)return;let t=!1;const i=async()=>{try{const{data:h}=await g.get("/admin/counts",{params:{approvedOnly:r}});t||S(h)}catch{}};i();const f=setInterval(i,15e3);return()=>{t=!0,clearInterval(f)}},[s,u,r]),a.useEffect(()=>{s&&(async()=>d((await g.get("/notifications")).data))()},[s]);const ae=x.filter(t=>!t.read).length,We=async()=>{await g.post("/notifications/read"),d((await g.get("/notifications")).data)};a.useEffect(()=>{(async()=>{if(!(!R||!s||s.role!=="student"))try{const{data:i}=await g.get("/students/me");W(i),Z({name:(i==null?void 0:i.name)||"",registrationNo:(i==null?void 0:i.registrationNo)||""})}catch{W(null)}})()},[R,s]),a.useEffect(()=>{m&&Z({name:m.name||"",registrationNo:m.registrationNo||""})},[m]),a.useEffect(()=>{if(R||b||M){const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[R,b,M]),a.useEffect(()=>{const t=i=>{i.key==="Escape"&&(R&&H(!1),b&&w(!1),M&&te(!1),we&&q())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[R,b,M,we]),a.useEffect(()=>()=>{L&&L.getTracks().forEach(t=>t.stop())},[L]);const gt=async()=>{$e(""),ke(null);try{const t=await navigator.mediaDevices.getUserMedia({video:{width:640,height:640,facingMode:"user"}});ze(t),Ue(!0)}catch(t){$e((t==null?void 0:t.message)||"Unable to access camera")}},q=()=>{L&&L.getTracks().forEach(t=>t.stop()),ze(null),Ue(!1)},pt=()=>{if(!L)return;const i=L.getVideoTracks()[0].getSettings(),f=i.width||640,h=i.height||640,N=Math.min(f,h),O=document.createElement("canvas");O.width=512,O.height=512;const vt=O.getContext("2d"),ne=document.getElementById("camera-video");if(!ne)return;const wt=(ne.videoWidth-N)/2,jt=(ne.videoHeight-N)/2;vt.drawImage(ne,wt,jt,N,N,0,0,512,512);const kt=O.toDataURL("image/jpeg",.9);ke(kt)},yt=()=>{z&&fetch(z).then(t=>t.blob()).then(t=>{const i=new File([t],"capture.jpg",{type:"image/jpeg"});fe(i),V("Captured photo ready to upload"),q()}).catch(()=>V("Failed to process captured image"))},F=async t=>{v(!1),k(!1),rt(t),w(!0),_e(!0);try{const{data:i}=await g.get("/admin/users",{params:{role:t,approvedOnly:r}});Oe(i)}catch{Oe([])}finally{_e(!1)}};a.useEffect(()=>{s&&s.role==="admin"&&b&&F(C)},[r]);const re=async()=>{if(!(!s||s.role!=="admin")){Be(!0);try{const t={};P.from&&(t.from=P.from),P.to&&(t.to=P.to);const[i,f,h,N,O]=await Promise.all([g.get("/admin/overstays",{params:t}),g.get("/admin/analytics/current-outside-summary",{params:t}),g.get("/admin/analytics/overstays-open-resolved",{params:t}),g.get("/admin/analytics/exits-by-hour",{params:t}),g.get("/admin/analytics/frequent-overstayers",{params:t})]);qe(i.data||[]),He({currentOutside:f.data||{count:0,avgHours:0,maxHours:0,top:[]},openResolved:h.data||{open:0,resolved:0},byHour:N.data||[],frequent:O.data||[]})}catch{qe([]),He({currentOutside:{count:0,avgHours:0,maxHours:0,top:[]},openResolved:{open:0,resolved:0},byHour:[],frequent:[]})}finally{Be(!1)}}},ft=async t=>{try{await g.post(`/admin/overstays/${t}/resolve`),await re()}catch{}},bt=async t=>{try{const i={type:"overstays"};P.from&&(i.from=P.from),P.to&&(i.to=P.to),await Ft(`/api/export/${t}`,i,`overstays.${t}`)}catch{}};return e.jsxs("nav",{className:`sticky top-0 z-50 p-3 border-b bg-white/80 text-gray-900 border-gray-200 supports-[backdrop-filter]:bg-white/70 backdrop-blur dark:bg-gray-900/60 dark:text-gray-100 dark:border-white/10 transition-shadow ${dt?"shadow-md shadow-black/10 dark:shadow-black/20":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{to:"/",className:"font-semibold text-lg",children:"GatePass"}),e.jsxs("div",{className:"flex items-center gap-2 md:hidden",children:[e.jsx("button",{className:"p-2 rounded-md text-sky-700 hover:text-sky-900 hover:bg-sky-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition dark:text-sky-200 dark:hover:text-white dark:hover:bg-sky-400/10",onClick:()=>Te(t=>t==="dark"?"light":"dark"),"aria-label":"Toggle theme",title:"Toggle theme",children:T==="dark"?e.jsx(Ve,{className:"h-5 w-5"}):e.jsx(Je,{className:"h-5 w-5"})}),e.jsx("button",{className:`p-2 rounded-md ${Y?"text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-400/10":"text-sky-700 dark:text-sky-200"} hover:text-sky-900 hover:bg-sky-100 dark:hover:text-white dark:hover:bg-sky-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition`,onClick:()=>k(t=>!t),"aria-label":"Toggle menu","aria-expanded":Y,title:"Menu",children:Y?e.jsx(ie,{className:"h-6 w-6 transition-transform duration-200"}):e.jsx(Lt,{className:"h-6 w-6 transition-transform duration-200"})})]}),e.jsx("div",{className:"hidden md:flex gap-3 items-center",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm hidden md:inline",children:[s.registrationNo," (",s.role,")"]}),s.role==="student"&&e.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-white/40 bg-slate-900/80 px-1 py-0.5 shadow-sm shadow-sky-900/40 text-xs",children:[e.jsxs(A,{to:"/student",className:"inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 font-medium transition-colors "+(se==="/student"?"bg-sky-500 text-white shadow-sm shadow-sky-500/50":"text-slate-200 hover:bg-slate-800/80 hover:text-white"),children:[e.jsx(Ge,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(A,{to:"/about",className:"inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 font-medium transition-colors "+(se==="/about"?"bg-sky-500 text-white shadow-sm shadow-sky-500/50":"text-slate-200 hover:bg-slate-800/80 hover:text-white"),children:[e.jsx(Ye,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"About"})]})]}),e.jsx("button",{className:"p-2 rounded-md text-sky-700 hover:text-sky-900 hover:bg-sky-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition dark:text-sky-200 dark:hover:text-white dark:hover:bg-sky-400/10",onClick:()=>Te(t=>t==="dark"?"light":"dark"),"aria-label":"Toggle theme",title:"Toggle theme",children:T==="dark"?e.jsx(Ve,{className:"h-5 w-5"}):e.jsx(Je,{className:"h-5 w-5"})}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md text-sky-700 hover:text-sky-900 hover:bg-sky-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition dark:text-sky-200 dark:hover:text-white dark:hover:bg-sky-400/10",onClick:()=>{H(!0),k(!1)},title:"Edit profile",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Profile"})]}),it&&e.jsx("button",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/30 transition dark:text-emerald-200 dark:hover:text-white dark:hover:bg-emerald-400/10",onClick:async()=>{if(!me)return;me.prompt();const{outcome:t}=await me.userChoice;t&&De(!1),Re(null)},children:"Install App"}),s.role==="admin"&&e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-md ${u?"text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-400/10":"text-sky-700 dark:text-sky-200"} hover:text-sky-900 hover:bg-sky-100 dark:hover:text-white dark:hover:bg-sky-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition`,onClick:async()=>{v(!u)},"aria-expanded":u,children:"Stats"}),e.jsx("button",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md text-amber-700 hover:text-amber-900 hover:bg-amber-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/30 transition dark:text-amber-200 dark:hover:text-white dark:hover:bg-amber-400/10 ml-2",onClick:async()=>{te(!0),k(!1),await re()},title:"Overstay Alerts",children:"Overstay Alerts"}),u&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded shadow-xl p-2 text-sm animate-scale-in bg-white text-gray-900 border border-gray-200 dark:bg-gray-900/95 dark:text-gray-100 dark:border-white/10 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:t=>y(t.target.checked)}),"Approved only"]}),p&&e.jsx("span",{className:"text-xs text-gray-500",children:"auto"})]}),p?e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 rounded px-2 py-1",onClick:()=>F("student"),children:[e.jsx("span",{children:"Total Students"}),e.jsx("span",{className:"font-semibold",children:p.students})]})}),e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 rounded px-2 py-1",onClick:()=>F("security"),children:[e.jsx("span",{children:"Total Security"}),e.jsx("span",{className:"font-semibold",children:p.security})]})}),e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 rounded px-2 py-1",onClick:()=>F("admin"),children:[e.jsx("span",{children:"Total Admins"}),e.jsx("span",{className:"font-semibold",children:p.admins})]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading…"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-md ${l?"text-emerald-700 bg-emerald-100 dark:text-emerald-300 dark:bg-emerald-400/10":"text-sky-700 dark:text-sky-200"} hover:text-sky-900 hover:bg-sky-100 dark:hover:text-white dark:hover:bg-sky-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/30 transition`,onClick:()=>{c(!l),l===!1&&We()},"aria-expanded":l,"aria-haspopup":"menu",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Notifications"}),ae>0&&e.jsx("span",{className:"ml-1 bg-red-600 text-white rounded px-1 text-xs",children:ae})]}),l&&e.jsxs("div",{className:"absolute right-0 mt-2 w-72 rounded shadow-xl p-2 max-h-64 overflow-auto animate-scale-in bg-white text-gray-900 border border-gray-200 dark:bg-gray-900/95 dark:text-gray-100 dark:border-white/10 z-50",children:[x.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No notifications"}),x.map(t=>e.jsxs("div",{className:"text-sm border-b py-1",children:[t.message,e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(t.createdAt).toLocaleString()})]},t._id))]})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-md text-rose-700 hover:text-rose-900 hover:bg-rose-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400/30 transition dark:text-rose-200 dark:hover:text-white dark:hover:bg-rose-400/10",onClick:n,children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{to:"/login",children:"Login"}),e.jsx(A,{to:"/signup",children:"Signup"})]})})]}),Y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/30 dark:bg-gradient-to-b dark:from-gray-900/70 dark:to-black/70 backdrop-blur-sm animate-fade-in md:hidden",onClick:()=>k(!1)}),e.jsxs("div",{className:"md:hidden mt-2 space-y-3 rounded-lg p-4 shadow-2xl border border-gray-200 bg-white text-gray-900 animate-scale-in dark:border-white/10 dark:bg-gray-800/95 dark:text-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold text-sky-700 dark:text-sky-300",children:"Menu"}),e.jsx("button",{className:"p-2 rounded-md text-emerald-700 hover:text-emerald-900 hover:bg-emerald-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/30 transition dark:text-emerald-300 dark:hover:text-white dark:hover:bg-emerald-400/10",onClick:()=>k(!1),"aria-label":"Close menu",title:"Close",children:e.jsx(ie,{className:"h-6 w-6"})})]}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 -mt-1",children:[s.registrationNo," (",s.role,")"]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:()=>{H(!0),k(!1)},style:{animationDelay:"60ms"},children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx("span",{children:"Edit Profile"})]}),s.role==="student"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsxs(A,{className:"inline-flex items-center justify-center gap-1.5 rounded-md px-3 py-2 text-sm border transition-colors "+(se==="/student"?"bg-sky-500 text-white border-sky-400 shadow-sm shadow-sky-500/40":"bg-gray-50 text-gray-900 border-gray-200 hover:bg-gray-100 dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80"),to:"/student",onClick:()=>k(!1),style:{animationDelay:"80ms"},children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(A,{className:"inline-flex items-center justify-center gap-1.5 rounded-md px-3 py-2 text-sm border transition-colors "+(se==="/about"?"bg-sky-500 text-white border-sky-400 shadow-sm shadow-sky-500/40":"bg-gray-50 text-gray-900 border-gray-200 hover:bg-gray-100 dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80"),to:"/about",onClick:()=>k(!1),style:{animationDelay:"100ms"},children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{children:"About"})]})]}),s.role==="admin"&&e.jsxs("div",{children:[e.jsx("button",{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:()=>v(t=>!t),style:{animationDelay:"100ms"},children:"Stats"}),e.jsx("button",{className:"mt-2 w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-amber-50 text-amber-900 border border-amber-200 hover:bg-amber-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:async()=>{k(!1),te(!0),await re()},style:{animationDelay:"120ms"},children:"Overstay Alerts"}),u&&e.jsxs("div",{className:"mt-2 w-full bg-white rounded shadow-lg p-2 text-sm animate-scale-in text-gray-900 border border-gray-200 dark:bg-gray-900/90 dark:text-gray-100 dark:border-white/10 z-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:t=>y(t.target.checked)}),"Approved only"]}),p&&e.jsx("span",{className:"text-xs text-gray-500",children:"auto"})]}),p?e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-700 rounded px-2 py-1",onClick:()=>F("student"),children:[e.jsx("span",{children:"Total Students"}),e.jsx("span",{className:"font-semibold",children:p.students})]})}),e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-700 rounded px-2 py-1",onClick:()=>F("security"),children:[e.jsx("span",{children:"Total Security"}),e.jsx("span",{className:"font-semibold",children:p.security})]})}),e.jsx("li",{children:e.jsxs("button",{className:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-700 rounded px-2 py-1",onClick:()=>F("admin"),children:[e.jsx("span",{children:"Total Admins"}),e.jsx("span",{className:"font-semibold",children:p.admins})]})})]}):e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading…"})]})]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-rose-50 text-rose-900 border border-rose-200 hover:bg-rose-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:()=>{c(t=>!t),l||We()},style:{animationDelay:"140ms"},children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Notifications"}),ae>0&&e.jsx("span",{className:"ml-1 bg-red-600 text-white rounded px-1 text-xs",children:ae})]}),l&&e.jsxs("div",{className:"w-full bg-white rounded shadow-lg p-2 max-h-64 overflow-auto animate-scale-in text-gray-900 border border-gray-200 dark:bg-gray-900/90 dark:text-gray-100 dark:border-white/10 z-50",children:[x.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No notifications"}),x.map(t=>e.jsxs("div",{className:"text-sm border-b py-1",children:[t.message,e.jsx("div",{className:"text-xs text-gray-500",children:new Date(t.createdAt).toLocaleString()})]},t._id))]}),e.jsxs("button",{className:"w-full inline-flex items-center justify-center gap-2 rounded-md px-3 py-2 bg-rose-50 text-rose-900 border border-rose-200 hover:bg-rose-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-rose-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",onClick:n,style:{animationDelay:"180ms"},children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{children:"Logout"})]})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsx(A,{className:"flex-1 text-center rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",to:"/login",onClick:()=>k(!1),children:"Login"}),e.jsx(A,{className:"flex-1 text-center rounded-md px-3 py-2 bg-gray-50 text-gray-900 border border-gray-200 hover:bg-gray-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/40 transition dark:bg-gray-700/60 dark:text-gray-100 dark:border-white/10 dark:hover:bg-gray-700/80",to:"/signup",onClick:()=>k(!1),children:"Signup"})]})]})]}),s&&s.role==="admin"&&b&&oe.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md animate-fade-in",onClick:()=>w(!1)}),e.jsxs("div",{className:"relative glass rounded shadow-xl w-[90vw] max-w-3xl max-h-[80vh] p-4 overflow-auto animate-scale-in text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"text-lg font-semibold capitalize",children:[C," list ",r?"(approved)":""]}),e.jsx("button",{className:"btn",onClick:()=>w(!1),children:"Close"})]}),ot?e.jsx("div",{className:"text-gray-500",children:"Loading…"}):e.jsx(Rt,{columns:C==="student"?[{key:"registrationNo",title:"Reg No"},{key:"name",title:"Name"},{key:"branch",title:"Branch"},{key:"batchYear",title:"Batch"},{key:"isApproved",title:"Approved",render:t=>t?"Yes":"No"}]:[{key:"registrationNo",title:"Identifier"},{key:"name",title:"Name"},{key:"isApproved",title:"Approved",render:t=>t?"Yes":"No"}],data:nt})]})]}),document.body),s&&s.role==="admin"&&M&&oe.createPortal(e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:e.jsx("div",{className:"p-3 rounded bg-gray-900/80 text-white border border-white/10",children:"Loading…"})}),children:e.jsx(Ut,{charts:xt,overstays:mt,overstaysFilter:P,setOverstaysFilter:ht,overstayOpen:M,setOverstayOpen:te,exportOverstays:bt,loadOverstaysAndCharts:re,overstaysLoading:ut,resolveOverstay:ft})}),document.body),s&&R&&oe.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md animate-fade-in",onClick:()=>H(!1)}),e.jsxs("div",{className:"relative w-[92vw] max-w-md max-h-[85vh] overflow-y-auto overscroll-contain scrollbar-thin p-4 sm:p-5 rounded-lg shadow-2xl border border-white/10 bg-gray-800/95 text-gray-100 animate-scale-in text-[14px] sm:text-[15px] md:text-base transform-gpu origin-top max-[400px]:scale-[.94] max-[360px]:scale-[.9]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 text-base sm:text-lg font-semibold",children:[e.jsx(Se,{className:"h-5 w-5 text-sky-300"}),"Edit Profile"]}),e.jsx("button",{className:"p-2 rounded-md text-emerald-300 hover:text-white hover:bg-emerald-400/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/30 transition",onClick:()=>H(!1),"aria-label":"Close",children:e.jsx(ie,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Change Password"}),e.jsxs("form",{className:"flex flex-col gap-3",onSubmit:async t=>{var i,f;t.preventDefault(),he("");try{if(!j.current||!j.p1||!j.p2)throw new Error("All fields are required");if(j.p1.length<6)throw new Error("Password must be at least 6 characters");if(j.p1!==j.p2)throw new Error("Passwords do not match");await g.post("/auth/change-password",{currentPassword:j.current,newPassword:j.p1}),K({current:"",p1:"",p2:""}),he("Password changed successfully")}catch(h){he(((f=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:f.message)||h.message||"Failed to change password")}},children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",type:$.current?"text":"password",placeholder:"Current password",value:j.current,onChange:t=>K({...j,current:t.target.value})}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>Ne(t=>({...t,current:!t.current})),"aria-label":"Toggle password visibility",children:$.current?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",type:$.p1?"text":"password",placeholder:"New password",value:j.p1,onChange:t=>K({...j,p1:t.target.value})}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>Ne(t=>({...t,p1:!t.p1})),"aria-label":"Toggle password visibility",children:$.p1?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",type:$.p2?"text":"password",placeholder:"Confirm new password",value:j.p2,onChange:t=>K({...j,p2:t.target.value})}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>Ne(t=>({...t,p2:!t.p2})),"aria-label":"Toggle password visibility",children:$.p2?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-md bg-sky-600 px-4 py-2 text-sm text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/50 w-fit",children:[e.jsx(le,{className:"h-4 w-4"}),"Save"]}),ue&&e.jsx("div",{className:`text-sm ${ue.includes("success")?"text-green-400":"text-rose-400"}`,children:ue})]})]}),s&&s.role==="student"&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Identity (pre-approval)"}),m!=null&&m.isApproved?e.jsx("div",{className:"text-sm text-emerald-400 mb-2",children:"Identity is locked after approval. Contact admin for changes."}):e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"You can edit your name and registration number until your account is approved."}),e.jsxs("form",{className:"flex flex-col gap-3 mb-4",onSubmit:async t=>{var i,f;t.preventDefault(),X("");try{if(m!=null&&m.isApproved)throw new Error("Already approved");const h={};if(E.name&&E.name!==(m==null?void 0:m.name)&&(h.name=E.name),E.registrationNo&&E.registrationNo!==(m==null?void 0:m.registrationNo)&&(h.registrationNo=E.registrationNo),Object.keys(h).length===0){X("No changes to save");return}await g.patch("/students/draft",h);const{data:N}=await g.get("/students/me");W(N);try{await(o==null?void 0:o())}catch{}X("Saved")}catch(h){X(((f=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:f.message)||h.message||"Failed to save")}},children:[e.jsx("input",{className:"input",placeholder:"Full name",value:E.name,disabled:!!(m!=null&&m.isApproved),onChange:t=>Z({...E,name:t.target.value})}),e.jsx("input",{className:"input",placeholder:"Registration number",value:E.registrationNo,disabled:!!(m!=null&&m.isApproved),onChange:t=>Z({...E,registrationNo:t.target.value})}),!(m!=null&&m.isApproved)&&e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-md bg-sky-600 px-4 py-2 text-sm text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/50 w-fit",children:[e.jsx(le,{className:"h-4 w-4"}),"Save identity"]}),ye&&e.jsx("div",{className:`text-sm ${ye==="Saved"?"text-green-400":"text-rose-400"}`,children:ye})]}),e.jsx("div",{className:"font-semibold mb-1",children:"Profile Photo"}),e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"PNG/JPG up to 2 MB. You can update your photo until approval; after approval it is locked."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:(m==null?void 0:m.profilePhotoUrl)||"https://placehold.co/64x64?text=Avatar",alt:"Current",width:"48",height:"48",loading:"lazy",decoding:"async",className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full object-cover border border-white/10"}),!(m!=null&&m.isApproved)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"photo-input",type:"file",accept:"image/*",className:"hidden",onChange:t=>{var i;return fe(((i=t.target.files)==null?void 0:i[0])||null)}}),e.jsxs("label",{htmlFor:"photo-input",className:"inline-flex items-center gap-2 rounded-md px-3 py-2 bg-gray-700/60 text-gray-100 border border-white/10 hover:bg-gray-700/80 cursor-pointer",children:[e.jsx(Pt,{className:"h-4 w-4"})," Choose file"]}),e.jsx("span",{className:"text-xs text-gray-400 truncate max-w-[140px]",children:(U==null?void 0:U.name)||"No file chosen"}),e.jsxs("button",{type:"button",onClick:()=>gt(),className:"inline-flex items-center gap-2 rounded-md px-3 py-2 bg-gray-700/60 text-gray-100 border border-white/10 hover:bg-gray-700/80",children:[e.jsx(Ee,{className:"h-4 w-4"})," Capture"]})]})]}),!(m!=null&&m.isApproved)&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[e.jsx("button",{className:`btn inline-flex items-center gap-2 ${Q?"opacity-70 cursor-not-allowed":""}`,disabled:Q,onClick:async()=>{var t,i;V(""),ve(0),Fe(!0);try{if(!U)throw new Error("Select an image first");if(U.size>2*1024*1024)throw new Error("Max size 2 MB");const f=new FormData;f.append("photo",U),await g.post("/students/profile-photo",f,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:N=>{if(!N.total)return;const O=Math.round(N.loaded*100/N.total);ve(O)}});const{data:h}=await g.get("/students/me");W(h),fe(null),V("Profile photo set")}catch(f){V(((i=(t=f==null?void 0:f.response)==null?void 0:t.data)==null?void 0:i.message)||f.message||"Upload failed")}finally{Fe(!1),setTimeout(()=>ve(0),600)}},children:Q?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 3v3",strokeLinecap:"round"})}),"Uploading…"]}):e.jsxs(e.Fragment,{children:[e.jsx(At,{className:"h-4 w-4"}),"Upload"]})}),we&&oe.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[10000]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm animate-fade-in",onClick:q}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"relative w-full max-w-md bg-gray-900 text-gray-100 rounded-xl p-4 border border-white/10 shadow-2xl animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 font-semibold",children:[e.jsx(Ee,{className:"h-5 w-5"})," Capture Photo"]}),e.jsx("button",{onClick:q,className:"p-2 rounded-md hover:bg-white/10","aria-label":"Close camera",children:e.jsx(ie,{className:"h-5 w-5"})})]}),je&&e.jsx("div",{className:"text-sm text-rose-400 mb-2",children:je}),!z&&!je&&e.jsx("div",{className:"relative aspect-square w-full rounded-lg overflow-hidden bg-black",children:e.jsx("video",{id:"camera-video",autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",ref:t=>{t&&L&&t.srcObject!==L&&(t.srcObject=L)}})}),z&&e.jsx("div",{className:"relative aspect-square w-full rounded-lg overflow-hidden",children:e.jsx("img",{src:z,alt:"Captured preview",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2 justify-between",children:z?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ke(null),className:"px-4 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm",children:"Retake"}),e.jsxs("button",{onClick:yt,className:"btn inline-flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"})," Use Photo"]}),e.jsx("button",{onClick:q,className:"px-4 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm",children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:pt,className:"btn flex-1 inline-flex items-center justify-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"})," Capture"]}),e.jsx("button",{onClick:q,className:"px-4 py-2 rounded-md bg-gray-700 hover:bg-gray-600 text-sm",children:"Cancel"})]})}),e.jsx("div",{className:"mt-3 text-[11px] text-gray-400 leading-snug",children:"We capture a centered square and resize to 512x512 (compressed JPEG). Lighting and clarity help security identify you."})]})})]}),document.body),Q&&e.jsx("div",{className:"flex-1 h-2 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-violet-600 via-sky-600 to-emerald-500 transition-[width] duration-200",style:{width:`${lt}%`}})})]})}),(m==null?void 0:m.isApproved)&&e.jsx("div",{className:"mt-2 text-xs text-emerald-400",children:"Photo locked after approval."}),be&&e.jsx("div",{className:`text-sm mt-1 ${be.includes("set")?"text-green-400":"text-rose-400"}`,children:be})]}),s&&s.role==="student"&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Change PIN"}),e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"This 6-digit PIN is used at the gate when your mobile is unavailable."}),e.jsxs("form",{className:"flex flex-col gap-3",onSubmit:async t=>{var i,f;t.preventDefault(),pe("");try{if(!/^\d{6}$/.test(D.newPin))throw new Error("PIN must be exactly 6 digits");await g.patch("/students/pin",{oldPin:D.oldPin||void 0,newPin:D.newPin});try{const{data:h}=await g.get("/students/me");W(h)}catch{}xe({oldPin:"",newPin:""}),pe("PIN updated successfully")}catch(h){pe(((f=(i=h==null?void 0:h.response)==null?void 0:i.data)==null?void 0:f.message)||h.message||"Failed to update PIN")}},children:[(m==null?void 0:m.pinCode)&&e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{value:D.oldPin,onChange:t=>xe({...D,oldPin:t.target.value}),placeholder:"Current 6-digit PIN",className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",maxLength:6,inputMode:"numeric",type:ee?"text":"password"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>Me(t=>!t),"aria-label":"Toggle PIN visibility",children:ee?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-[18px] w-[18px] text-gray-300/90 drop-shadow-sm"}),e.jsx("input",{value:D.newPin,onChange:t=>xe({...D,newPin:t.target.value}),placeholder:"New 6-digit PIN",className:"input !pl-12 !pr-12 text-sm placeholder:text-gray-400",maxLength:6,inputMode:"numeric",type:ee?"text":"password"}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gray-300/90 hover:text-white",onClick:()=>Me(t=>!t),"aria-label":"Toggle PIN visibility",children:ee?e.jsx(J,{className:"h-5 w-5"}):e.jsx(G,{className:"h-5 w-5"})})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-md bg-sky-600 px-4 py-2 text-sm text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-400/50 w-fit",type:"submit",children:[e.jsx(le,{className:"h-4 w-4"}),"Save PIN"]}),ge&&e.jsx("div",{className:`text-sm ${ge.includes("success")?"text-green-400":"text-rose-400"}`,children:ge})]})]})]})]})]}),document.body)]})}function $t({onDone:s,duration:n=2e3}){const[o,x]=a.useState(!1),[d,l]=a.useState(!0),[c,u]=a.useState(!0);return a.useEffect(()=>{const v=setTimeout(()=>{x(!0);const p=setTimeout(()=>s==null?void 0:s(),200);return()=>clearTimeout(p)},n);return()=>clearTimeout(v)},[n,s]),e.jsxs("div",{className:`fixed inset-0 z-[99999] select-none ${o?"opacity-0 pointer-events-none":"opacity-100"} transition-opacity duration-200`,"aria-hidden":!0,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-900 to-black"}),e.jsx("div",{className:"absolute inset-0 backdrop-blur-sm"}),e.jsx("div",{className:"relative w-full h-full flex items-center justify-center p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[e.jsx("img",{src:"/icons/icon-192.png",width:96,height:96,alt:"LNJPIT Logo",className:"rounded-xl shadow-2xl border border-white/10",loading:"eager"}),e.jsx("div",{className:"text-2xl font-extrabold tracking-tight text-white drop-shadow-sm",children:"GatePass"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("div",{className:"flex -space-x-3",children:[d?e.jsx("img",{src:"/developer.jpg",alt:"Developer: MD RAIHAN",className:"w-12 h-12 rounded-full object-cover border border-white/10 shadow ring-2 ring-gray-900",onError:()=>l(!1)}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-indigo-500 to-rose-500 grid place-items-center text-white font-bold border border-white/10 shadow ring-2 ring-gray-900",children:"RA"}),c?e.jsx("img",{src:"/faizan.jpg",alt:"Developer: Faizan",className:"w-12 h-12 rounded-full object-cover border border-white/10 shadow ring-2 ring-gray-900",onError:()=>u(!1)}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-emerald-500 to-cyan-500 grid place-items-center text-white font-bold border border-white/10 shadow ring-2 ring-gray-900",children:"FZ"})]}),e.jsx("div",{className:"text-gray-200 text-sm font-semibold",children:"Developed by: MD RAIHAN & FAIZAN"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-400",children:"Loading experience…"})]})})]})}const Mt=a.lazy(()=>I(()=>import("./Login-CgBacOH_.js"),__vite__mapDeps([6,1,3,5,4]))),qt=a.lazy(()=>I(()=>import("./Signup-CUZB4G63.js"),__vite__mapDeps([7,1,3,4,5]))),Bt=a.lazy(()=>I(()=>import("./ForgotPassword-BlbDV6dd.js"),__vite__mapDeps([8,1,3,4,5]))),Ht=a.lazy(()=>I(()=>import("./StudentDashboard-DXGeqhFJ.js"),__vite__mapDeps([9,1,10,5,3,4]))),Wt=a.lazy(()=>I(()=>import("./AdminDashboard-StcCBFc-.js"),__vite__mapDeps([11,1,10,5,3,4]))),Vt=a.lazy(()=>I(()=>import("./SecurityDashboard-Czc3i0Vm.js"),__vite__mapDeps([12,1,10,5,3,4]))),Jt=a.lazy(()=>I(()=>import("./About-DCEI8zKV.js"),__vite__mapDeps([13,1,3])));function Gt(){const{user:s}=Ie();if(s){const n=s.role==="admin"?"/admin":s.role==="security"?"/security":"/student";return e.jsx(Le,{to:n,replace:!0})}return e.jsx(Le,{to:"/login",replace:!0})}function Yt(){const[s,n]=a.useState(()=>{try{return!sessionStorage.getItem("seen_splash")}catch{return!0}});return a.useEffect(()=>{if(s)try{sessionStorage.setItem("seen_splash","1")}catch{}},[s]),e.jsx(_t,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800 transition-colors pt-2",children:[s&&e.jsx($t,{onDone:()=>n(!1),duration:1200}),e.jsx(zt,{}),e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"p-6 text-sm text-gray-500",children:"Loading…"}),children:e.jsxs(St,{children:[e.jsx(_,{path:"/",element:e.jsx(Gt,{})}),e.jsx(_,{path:"/login",element:e.jsx(Mt,{})}),e.jsx(_,{path:"/signup",element:e.jsx(qt,{})}),e.jsx(_,{path:"/forgot-password",element:e.jsx(Bt,{})}),e.jsx(_,{path:"/student",element:e.jsx(de,{role:"student",children:e.jsx(Ht,{})})}),e.jsx(_,{path:"/about",element:e.jsx(de,{role:"student",children:e.jsx(Jt,{})})}),e.jsx(_,{path:"/admin",element:e.jsx(de,{role:"admin",children:e.jsx(Wt,{})})}),e.jsx(_,{path:"/security",element:e.jsx(de,{role:"security",children:e.jsx(Vt,{})})})]})})]})})}function Kt(s={}){const{immediate:n=!1,onNeedRefresh:o,onOfflineReady:x,onRegistered:d,onRegisteredSW:l,onRegisterError:c}=s;let u,v;const p=async(r=!0)=>{await v};async function S(){if("serviceWorker"in navigator){if(u=await I(async()=>{const{Workbox:r}=await import("./vendor-CFsy__N8.js").then(y=>y.at);return{Workbox:r}},[]).then(({Workbox:r})=>new r("/sw.js",{scope:"/",type:"classic"})).catch(r=>{c==null||c(r)}),!u)return;u.addEventListener("activated",r=>{(r.isUpdate||r.isExternal)&&window.location.reload()}),u.addEventListener("installed",r=>{r.isUpdate||x==null||x()}),u.register({immediate:n}).then(r=>{l?l("/sw.js",r):d==null||d(r)}).catch(r=>{c==null||c(r)})}}return v=S(),p}tt.Fragment;const et=()=>{Nt.createRoot(document.getElementById("root")).render(e.jsx(e.Fragment,{children:e.jsx(Ct,{children:e.jsx(Yt,{})})}))};"requestIdleCallback"in window?window.requestIdleCallback(et,{timeout:1200}):setTimeout(et,0);const Zt=Kt({immediate:!0,onNeedRefresh(){Zt(!0)},onOfflineReady(){}});window.addEventListener("online",()=>{});window.addEventListener("offline",()=>{});export{Rt as D,I as _,g as a,Ft as b,as as c,Ie as u};
